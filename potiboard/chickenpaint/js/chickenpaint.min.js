!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,e.ChickenPaint=t()}}(function(){return function t(e,a,n){function i(r,s){if(!a[r]){if(!e[r]){var l="function"==typeof require&&require;if(!s&&l)return l(r,!0);if(o)return o(r,!0);var d=new Error("Cannot find module '"+r+"'");throw d.code="MODULE_NOT_FOUND",d}var c=a[r]={exports:{}};e[r][0].call(c.exports,function(t){var a=e[r][1][t];return i(a?a:t)},c,c.exports,t,e,a,n)}return a[r].exports}for(var o="function"==typeof require&&require,r=0;r<n.length;r++)i(n[r]);return i}({1:[function(t,e,a){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function i(){return(0,R.isCanvasSupported)()&&"Uint8Array"in window}function o(){var t=new Array(r.T_MAX);return t[r.T_PENCIL]=new d.default({toolNb:r.T_PENCIL,size:16,alpha:255,isAA:!0,minSpacing:.5,spacing:.05,pressureSize:!1,pressureAlpha:!0,type:d.default.B_ROUND_AA,paintMode:d.default.M_PAINT}),t[r.T_ERASER]=new d.default({toolNb:r.T_ERASER,size:16,alpha:255,isAA:!0,minSpacing:.5,spacing:.05,pressureSize:!1,pressureAlpha:!1,type:d.default.B_ROUND_AA,paintMode:d.default.M_ERASE}),t[r.T_PEN]=new d.default({toolNb:r.T_PEN,size:2,alpha:128,isAA:!0,minSpacing:.5,spacing:.05,pressureSize:!0,pressureAlpha:!1,type:d.default.B_ROUND_AA,paintMode:d.default.M_PAINT}),t[r.T_SOFTERASER]=new d.default({toolNb:r.T_SOFTERASER,size:16,alpha:64,isAA:!1,isAirbrush:!0,minSpacing:.5,spacing:.05,pressureSize:!1,pressureAlpha:!0,type:d.default.B_ROUND_AIRBRUSH,paintMode:d.default.M_ERASE}),t[r.T_AIRBRUSH]=new d.default({toolNb:r.T_AIRBRUSH,size:50,alpha:32,isAA:!1,isAirbrush:!0,minSpacing:.5,spacing:.05,pressureSize:!1,pressureAlpha:!0,type:d.default.B_ROUND_AIRBRUSH,paintMode:d.default.M_PAINT}),t[r.T_DODGE]=new d.default({toolNb:r.T_DODGE,size:30,alpha:32,isAA:!1,isAirbrush:!0,minSpacing:.5,spacing:.05,pressureSize:!1,pressureAlpha:!0,type:d.default.B_ROUND_AIRBRUSH,paintMode:d.default.M_DODGE}),t[r.T_BURN]=new d.default({toolNb:r.T_BURN,size:30,alpha:32,isAA:!1,isAirbrush:!0,minSpacing:.5,spacing:.05,pressureSize:!1,pressureAlpha:!0,type:d.default.B_ROUND_AIRBRUSH,paintMode:d.default.M_BURN}),t[r.T_WATER]=new d.default({toolNb:r.T_WATER,size:30,alpha:70,isAA:!1,isAirbrush:!0,minSpacing:.5,spacing:.02,pressureSize:!1,pressureAlpha:!0,type:d.default.B_ROUND_AA,paintMode:d.default.M_WATER,resat:.3,bleed:.6}),t[r.T_BLUR]=new d.default({toolNb:r.T_BLUR,size:20,alpha:255,isAA:!1,isAirbrush:!0,minSpacing:.5,spacing:.05,pressureSize:!1,pressureAlpha:!0,type:d.default.B_ROUND_PIXEL,paintMode:d.default.M_BLUR}),t[r.T_SMUDGE]=new d.default({toolNb:r.T_SMUDGE,size:20,alpha:128,isAA:!1,isAirbrush:!0,minSpacing:.5,spacing:.01,pressureSize:!1,pressureAlpha:!0,type:d.default.B_ROUND_AIRBRUSH,paintMode:d.default.M_SMUDGE,resat:0,bleed:1}),t[r.T_BLENDER]=new d.default({toolNb:r.T_BLENDER,size:20,alpha:60,isAA:!1,isAirbrush:!0,minSpacing:.5,spacing:.1,pressureSize:!1,pressureAlpha:!0,type:d.default.B_ROUND_AIRBRUSH,paintMode:d.default.M_OIL,resat:0,bleed:.07}),t}function r(t){function e(t){this.palName=t}function a(t){this.toolNum=t}function n(t){this.modeNum=t}function l(){A||(A=new S.default(Y,N)),A.show()}function c(){I||(I=new k.default(Y,L)),I.show()}function h(){N.emitEvent("toolChange",[W,q[W]])}function p(){N.emitEvent("modeChange",[X])}function g(t){X!=t&&(t==r.M_TRANSFORM&&(z=X),X=t,p())}function y(t){g(r.M_DRAW),W=t,N.artwork.setBrush(q[t]),h()}function w(){var t=new m.default({artwork:N.getArtwork(),rotation:L.getRotation90(),swatches:M.getSwatches()});t.on("savingComplete",function(){N.artwork.setHasUnsavedChanges(!1)}),t.on("savingFailure",function(){alert("An error occured while trying to save your drawing! Please try again!")}),t.save()}function b(){if(N.isActionSupported("CPContinue")||confirm("Are you sure you want to send your drawing to the server and finish drawing now?")){var e=new m.default({artwork:N.getArtwork(),rotation:L.getRotation90(),swatches:M.getSwatches(),url:t.saveUrl}),a=new B.default(N,Y,e);e.on("savingComplete",function(){N.artwork.setHasUnsavedChanges(!1),!N.isActionSupported("CPContinue")&&N.isActionSupported("CPPost")&&N.actionPerformed({action:"CPPost"})}),a.on("shown",function(){e.save()}),a.show()}}function T(){(0,R.isEventSupported)("onbeforeunload")?window.addEventListener("beforeunload",function(t){if(N.artwork.getHasUnsavedChanges()){var e="Your drawing has unsaved changes!";return t.returnValue=e,e}}):$("a").click(function(t){if("#"!=this.getAttribute("href")&&N.artwork.getHasUnsavedChanges())return confirm("Your drawing has unsaved changes! Are you sure to want to navigate away?")})}function x(t,e){M=new E.default(N,Y),y(r.T_PEN),M.arrangePalettes(),t&&M.setSwatches(t),e&&M.setRotation(e*Math.PI/2),D.default.getRef().detectTablet(),T()}var L,M,A,I,N=this,Y=t.uiElem,H=new F.default(0),W=r.T_PENCIL,X=r.M_DRAW,z=X,j=[4278190080,4294967295],G=!1,q=o(),V={CPFullScreen:{action:function(){G=!G,$("body").toggleClass("chickenpaint-full-screen",G),$(Y).toggleClass("chickenpaint-full-screen",G),setTimeout(function(){M.setFullScreenMode(G)},200)},isSupported:function(){return t.allowFullScreen!==!1},modifies:{gui:!0}},CPZoomIn:{action:function(){L.zoomIn()},modifies:{gui:!0}},CPZoomOut:{action:function(){L.zoomOut()},modifies:{gui:!0}},CPZoom100:{action:function(){L.zoom100()},modifies:{gui:!0}},CPUndo:{action:function(){N.artwork.undo()},modifies:{document:!0}},CPRedo:{action:function(){N.artwork.redo()},modifies:{document:!0}},CPClearHistory:{action:function(){confirm("You're about to clear the current Undo/Redo history.\nThis operation cannot be undone, are you sure you want to do that?")&&N.artwork.clearHistory()},modifies:{document:!0}},CPPencil:new a(r.T_PENCIL),CPPen:new a(r.T_PEN),CPEraser:new a(r.T_ERASER),CPSoftEraser:new a(r.T_SOFTERASER),CPAirbrush:new a(r.T_AIRBRUSH),CPDodge:new a(r.T_DODGE),CPBurn:new a(r.T_BURN),CPWater:new a(r.T_WATER),CPBlur:new a(r.T_BLUR),CPSmudge:new a(r.T_SMUDGE),CPBlender:new a(r.T_BLENDER),CPFloodFill:new n(r.M_FLOODFILL),CPGradientFill:new n(r.M_GRADIENTFILL),CPRectSelection:new n(r.M_RECT_SELECTION),CPMoveTool:new n(r.M_MOVE_TOOL),CPRotateCanvas:new n(r.M_ROTATE_CANVAS),CPColorPicker:new n(r.M_COLOR_PICKER),CPTransform:{action:function(){var t=N.artwork.getActiveLayer(),e=N.artwork.getActiveLayerIndex();t.visible?0==t.alpha?N.showLayerNotification(e,"Whoops! This layer's opacity is currently 0%","opacity"):null==N.artwork.transformAffineBegin()?N.showLayerNotification(e,"Whoops! All of the selected pixels are transparent!","layer"):g(r.M_TRANSFORM):N.showLayerNotification(e,"Whoops! This layer is currently hidden","layer")},modifies:{mode:!0}},CPTransformAccept:{action:function(){X==r.M_TRANSFORM&&(N.artwork.transformAffineFinish(),g(z))},modifies:{mode:!0}},CPTransformReject:{action:function(){X==r.M_TRANSFORM&&(N.artwork.transformAffineAbort(),g(z))},modifies:{document:!0,mode:!0}},CPFreeHand:{action:function(){q[W].strokeMode=d.default.SM_FREEHAND,h()},modifies:{tool:!0}},CPLine:{action:function(){q[W].strokeMode=d.default.SM_LINE,h()},modifies:{tool:!0}},CPBezier:{action:function(){q[W].strokeMode=d.default.SM_BEZIER,h()},modifies:{tool:!0}},CPAbout:{action:function(){new P.default(Y).show()},modifies:{}},CPShortcuts:{action:function(){new _.default(Y).show()},modifies:{}},CPTabletSupport:{action:function(){new O.default(Y).show()},modifies:{}},CPLayerDuplicate:{action:function(){N.artwork.duplicateLayer()},modifies:{document:!0}},CPLayerMergeDown:{action:function(){N.artwork.mergeDown(!0)},modifies:{document:!0}},CPLayerMergeAll:{action:function(){N.artwork.mergeAllLayers(!0)},modifies:{document:!0}},CPFill:{action:function(){N.artwork.fill(4278190080|N.getCurColorRgb())},modifies:{document:!0}},CPClear:{action:function(){N.artwork.clear()},modifies:{document:!0}},CPSelectAll:{action:function(){N.artwork.rectangleSelection(N.artwork.getBounds()),L.repaintAll()},modifies:{document:!0}},CPDeselectAll:{action:function(){N.artwork.rectangleSelection(new U.default(0,0,0,0)),L.repaintAll()},modifies:{document:!0}},CPHFlip:{action:function(){N.artwork.hFlip()},modifies:{document:!0}},CPVFlip:{action:function(){N.artwork.vFlip()},modifies:{document:!0}},CPMNoise:{action:function(){N.artwork.monochromaticNoise()},modifies:{document:!0}},CPCNoise:{action:function(){N.artwork.colorNoise()},modifies:{document:!0}},CPFXBoxBlur:{action:function(){l()},modifies:{document:!0}},CPFXInvert:{action:function(){N.artwork.invert()},modifies:{document:!0}},CPCut:{action:function(){N.artwork.cutSelection(!0)},modifies:{document:!0}},CPCopy:{action:function(){N.artwork.copySelection()},modifies:{document:!0}},CPCopyMerged:{action:function(){N.artwork.copySelectionMerged()},modifies:{document:!0}},CPPaste:{action:function(){N.artwork.pasteClipboard(!0)},modifies:{document:!0}},CPToggleGrid:{action:function(t){L.showGrid(t.selected)},modifies:{gui:!0}},CPGridOptions:{action:function(){c()},modifies:{gui:!0}},CPLinearInterpolation:{action:function(t){L.setInterpolation(t.selected)},modifies:{gui:!0},isSupported:function(){return(0,R.isCanvasInterpolationSupported)()}},CPResetCanvasRotation:{action:function(){L.resetRotation()},modifies:{gui:!0}},CPAddLayer:{action:function(){N.artwork.addLayer()},modifies:{document:!0}},CPRemoveLayer:{action:function(){N.artwork.removeLayer()||alert("Sorry, you can't remove the last remaining layer in the drawing.")},modifies:{document:!0}},CPMoveLayer:{action:function(t){N.artwork.moveLayer(t.fromIndex,t.toIndex)},modifies:{document:!0}},CPSetActiveLayerIndex:{action:function(t){N.artwork.setActiveLayerIndex(t.layerIndex),N.artwork.performIdleTasks()},modifies:{document:!0}},CPSetLayerVisibility:{action:function(t){N.artwork.setLayerVisibility(t.layerIndex,t.visible)},modifies:{layerProp:!0}},CPSetLayerName:{action:function(t){N.artwork.setLayerName(t.layerIndex,t.name)},modifies:{layerProp:!0}},CPSetLayerBlendMode:{action:function(t){N.artwork.setLayerBlendMode(t.layerIndex,t.blendMode)},modifies:{layerProp:!0}},CPSetLayerAlpha:{action:function(t){N.artwork.setLayerAlpha(t.layerIndex,t.alpha)},modifies:{layerProp:!0}},CPPalColor:new e("color"),CPPalBrush:new e("brush"),CPPalLayers:new e("layers"),CPPalStroke:new e("stroke"),CPPalSwatches:new e("swatches"),CPPalTool:new e("tool"),CPPalMisc:new e("misc"),CPPalTextures:new e("textures"),CPTogglePalettes:{action:function(){M.togglePalettes()},modifies:{gui:!0}},CPArrangePalettes:{action:function(){M.arrangePalettes()},modifies:{gui:!0}},CPSave:{action:function(){w()},isSupported:function(){return t.allowDownload!==!1},modifies:{document:!0}},CPSend:{action:function(){b()},isSupported:function(){return!!t.saveUrl},modifies:{document:!0}},CPPost:{action:function(){window.location=t.postUrl},isSupported:function(){return!!t.postUrl},modifies:{document:!0}},CPContinue:{action:function(){},isSupported:function(){return!!t.allowMultipleSends}},CPExit:{action:function(){window.location=t.exitUrl},isSupported:function(){return!!t.exitUrl},modifies:{}}};if(e.prototype.action=function(t){M.showPalette(this.palName,t.selected)},e.prototype.modifies={gui:!0},a.prototype.action=function(){y(this.toolNum)},a.prototype.modifies={mode:!0,tool:!0},n.prototype.action=function(){g(this.modeNum)},n.prototype.modifies={mode:!0},this.callToolListeners=function(){h()},this.getMainGUI=function(){return M},this.getArtwork=function(){return this.artwork},this.setCanvas=function(t){L=t},this.setTransformInterpolation=function(t){this.artwork.setTransformInterpolation(t)},this.setCurColor=function(t){H.isEqual(t)||(this.artwork.setForegroundColor(t.getRgb()),H.copyFrom(t),this.emitEvent("colorChange",[t]))},this.getCurColor=function(){return H.clone()},this.getCurColorRgb=function(){return H.getRgb()},this.setCurColorRgb=function(t){this.setCurColor(new F.default(t))},this.setCurGradient=function(t){j=t.slice(0),this.emitEvent("gradientChange",[j])},this.getCurGradient=function(){return j.slice(0)},this.setBrushSize=function(t){q[W].size=Math.max(1,Math.min(200,t)),h()},this.getBrushSize=function(){return q[W].size},this.setAlpha=function(t){q[W].alpha=t,h()},this.getAlpha=function(){return q[W].alpha},this.getCurMode=function(){return X},this.getCurTool=function(){return W},this.getBrushInfo=function(){return q[W]},this.isActionSupported=function(t){if(V[t]){var e=s(V[t].isSupported);return"function"==e?V[t].isSupported():"undefined"==e||V[t].isSupported}return!1},this.showLayerNotification=function(t,e,a){this.emitEvent("layerNotification",[t,e,a])},this.actionPerformed=function(t){if(null!=this.artwork&&null!=L){var e=V[t.action];if(e)if(X==r.M_TRANSFORM&&(e.modifies.document||e.modifies.mode)&&["CPTransformAccept","CPTransformReject"].indexOf(t.action)==-1)if("CPUndo"==t.action)V.CPTransformReject.action();else if("CPTransform"==t.action);else{var a=new C.default(Y,this);a.on("accept",this.actionPerformed.bind(this,t)),a.on("reject",this.actionPerformed.bind(this,t)),a.show()}else e.action(t)}},this.getResourcesRoot=function(){return t.resourcesRoot},!i())throw new r.UnsupportedBrowserException;if(("string"!=typeof document.body.style.flexBasis&&"string"!=typeof document.body.style.msFlexDirection||/Presto/.test(navigator.userAgent))&&(Y.className+=" no-flexbox"),Y.className+=" chickenpaint",t.resourcesRoot=t.resourcesRoot||"chickenpaint/",t.disableBootstrapAPI&&$(document).off(".data-api"),t.loadImageUrl||t.loadChibiFileUrl){var Z=new f.default(t);new v.default(Y,Z,t.resourcesRoot),Z.on("loadingComplete",function(e){N.artwork=e.layers||e.flat,x(e.swatches,t.rotation)}),Z.load()}else this.artwork=new u.default(t.canvasWidth||800,t.canvasHeight||600),this.artwork.addBackgroundLayer(),x()}Object.defineProperty(a,"__esModule",{value:!0});var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};a.default=r;var l=t("./engine/CPBrushInfo"),d=n(l),c=t("./engine/CPArtwork"),u=n(c),h=t("./engine/CPResourceLoader"),f=n(h),p=t("./engine/CPResourceSaver"),m=n(p),g=t("./gui/CPSplashScreen.js"),v=n(g),y=t("./gui/CPMainGUI"),E=n(y),w=t("./gui/CPAboutDialog"),P=n(w),b=t("./gui/CPConfirmTransformDialog"),C=n(b),T=t("./gui/CPShortcutsDialog"),_=n(T),x=t("./gui/CPBoxBlurDialog"),S=n(x),L=t("./gui/CPTabletDialog"),O=n(L),M=t("./gui/CPGridDialog"),k=n(M),A=t("./gui/CPSendDialog"),B=n(A),R=t("./util/CPPolyfill"),I=t("./util/CPColor"),F=n(I),N=t("./util/CPWacomTablet"),D=n(N),Y=t("./util/CPRect"),U=n(Y);r.prototype=Object.create(EventEmitter.prototype),r.prototype.constructor=r,r.UnsupportedBrowserException=function(){},r.UnsupportedBrowserException.prototype.toString=function(){return"Sorry, your web browser does not support ChickenPaint. Please try a modern browser like Chrome, Safari, Firefox, or Edge"},r.M_DRAW=0,r.M_FLOODFILL=1,r.M_RECT_SELECTION=2,r.M_MOVE_TOOL=3,r.M_ROTATE_CANVAS=4,r.M_COLOR_PICKER=5,r.M_GRADIENTFILL=6,r.M_TRANSFORM=7,r.T_PENCIL=0,r.T_ERASER=1,r.T_PEN=2,r.T_SOFTERASER=3,r.T_AIRBRUSH=4,r.T_DODGE=5,r.T_BURN=6,r.T_WATER=7,r.T_BLUR=8,r.T_SMUDGE=9,r.T_BLENDER=10,r.T_MAX=11,e.exports=a.default},{"./engine/CPArtwork":2,"./engine/CPBrushInfo":5,"./engine/CPResourceLoader":13,"./engine/CPResourceSaver":14,"./gui/CPAboutDialog":16,"./gui/CPBoxBlurDialog":17,"./gui/CPConfirmTransformDialog":25,"./gui/CPGridDialog":27,"./gui/CPMainGUI":29,"./gui/CPSendDialog":35,"./gui/CPShortcutsDialog":36,"./gui/CPSplashScreen.js":38,"./gui/CPTabletDialog":41,"./util/CPColor":47,"./util/CPPolyfill":49,"./util/CPRect":52,"./util/CPWacomTablet":55}],2:[function(t,e,a){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function i(t,e){function a(t,e){e.right=e.left+t.getWidth(),e.right>Nt.width&&(t.right-=e.right-Nt.width,e.right=Nt.width),e.bottom=e.top+t.getHeight(),e.bottom>Nt.height&&(t.bottom-=e.bottom-Nt.height,e.bottom=Nt.height),e.left<0&&(t.left-=e.left,e.left=0),e.top<0&&(t.top-=e.top,e.top=0)}function n(t){Nt.emitEvent("updateRegion",[t])}function i(t){Nt.emitEvent("changeLayer",[t])}function o(){Nt.emitEvent("changeSelection",[])}function s(t){wt.union(t),vt.union(t),n(t)}function d(){s(new T.default(0,0,Nt.width,Nt.height))}function u(t,e){var a=ut.splice(t,1)[0];e<=t?(ut.splice(e,0,a),Nt.setActiveLayerIndex(e)):(ut.splice(e-1,0,a),Nt.setActiveLayerIndex(e-1)),d(),i()}function f(){}function m(){}function v(){}function E(){}function P(){}function C(){}function _(){}function S(){function t(t,e,a,n){var i=[],o=Bt?mt:Nt.getActiveLayer();t=0|t,e=0|e,i.push(b.default.createFromInt(o.getPixel(t,e)));for(var r=.25;r<1.001;r+=.25)i.push(b.default.createFromInt(o.getPixel(~~(t+r*a),e))),i.push(b.default.createFromInt(o.getPixel(~~(t-r*a),e))),i.push(b.default.createFromInt(o.getPixel(t,~~(e+r*n)))),i.push(b.default.createFromInt(o.getPixel(t,~~(e-r*n)))),i.push(b.default.createFromInt(o.getPixel(~~(t+.7*r*a),~~(e+.7*r*n)))),i.push(b.default.createFromInt(o.getPixel(~~(t+.7*r*a),~~(e-.7*r*n)))),i.push(b.default.createFromInt(o.getPixel(~~(t-.7*r*a),~~(e+.7*r*n)))),i.push(b.default.createFromInt(o.getPixel(~~(t-.7*r*a),~~(e-.7*r*n))));for(var s=new b.default(0,0,0),l=0;l<i.length;l++){var d=i[l];s.r+=d.r,s.g+=d.g,s.b+=d.b}return s.r/=i.length,s.g/=i.length,s.b/=i.length,s}function e(t,e,a,n,i,o){for(var r=yt.data,s=t.top,l=e.top;l<e.bottom;l++,s++)for(var d=t.left+s*n,c=yt.offsetOfPixel(e.left,l),u=e.left;u<e.right;u++,d++,c++){var h=(255&a[d])*i/255|0;if(!(h<=0)){var f=r[c],p=f>>>24,m=h+p-h*p/255|0;if(m>0){var g=255*h/m|0,v=255-g,y=m<<24|(o>>>16&255)+((f>>>16&255)*v-(o>>>16&255)*v)/255<<16|(o>>>8&255)+((f>>>8&255)*v-(o>>>8&255)*v)/255<<8|(255&o)+((255&f)*v-(255&o)*v)/255;r[c]=y}}}}var a=50,n=64,i=[];this.beginStroke=function(t,e,a){i=null,_.prototype.beginStroke.call(this,t,e,a)},this.paintDabImplementation=function(o,r,s){if(null==i){var l=t(~~((r.left+r.right)/2),~~((r.top+r.bottom)/2),Math.max(1,Math.min(n,2*r.getWidth()/6)),Math.max(1,Math.min(n,2*r.getHeight()/6)));i=[];for(var d=0;d<a;d++)i.push(l)}for(var c=new b.default(0,0,0),d=0;d<i.length;d++){var u=i[d];c.r+=u.r,c.g+=u.g,c.b+=u.b}c.r/=i.length,c.g/=i.length,c.b/=i.length,c.mixWith(b.default.createFromInt(It),St.resat*St.resat);var h=c.toInt();c.mixWith(t((r.left+r.right)/2,(r.top+r.bottom)/2,Math.max(1,Math.min(n,2*r.getWidth()/6)),Math.max(1,Math.min(n,2*r.getHeight()/6))),St.bleed),i.push(c),i.shift(),e(o,r,s.brush,s.width,Math.max(1,s.alpha/4),h),B(0,!1),Bt&&Nt.fusionLayers()}}function M(){function t(t,e,a,n,i){for(var o=Bt?mt:Nt.getActiveLayer(),r=t.top,s=e.top;s<e.bottom;s++,r++)for(var l=t.left+r*n,d=o.offsetOfPixel(e.left,s),c=e.left;c<e.right;c++,l++,d+=h.default.BYTES_PER_PIXEL){var u=o.data[d+h.default.ALPHA_BYTE_OFFSET]*i/255|0;if(!(u<=0)){var f=a[l],p=f>>>24,m=u+p-u*p/255|0;if(m>0){var g=255*u/m|0,v=255-g,y=o.data[d+h.default.RED_BYTE_OFFSET],E=o.data[d+h.default.GREEN_BYTE_OFFSET],w=o.data[d+h.default.BLUE_BYTE_OFFSET],P=m<<24|y+((f>>>16&255)*v-y*v)/255<<16|E+((f>>>8&255)*v-E*v)/255<<8|w+((255&f)*v-w*v)/255;a[l]=P}}}}function e(t,e,a,n,i,o){var r=t.top;if(!(i<=0))for(var s=e.top;s<e.bottom;s++,r++)for(var l=t.left+r*n,d=e.left;d<e.right;d++,l++){var c=a[l],u=c>>>24,h=i+u-i*u/255|0;if(h>0){var f=255*i/h|0,p=255-f,m=h<<24|(o>>>16&255)+((c>>>16&255)*p-(o>>>16&255)*p)/255<<16|(o>>>8&255)+((c>>>8&255)*p-(o>>>8&255)*p)/255<<8|(255&o)+((255&c)*p-(255&o)*p)/255;a[l]=m}}}function a(t,e,a,n,i,o){for(var r=yt.data,s=t.top,l=e.top;l<e.bottom;l++,s++)for(var d=t.left+s*i,c=e.left+l*Nt.width,u=it.offsetOfPixel(e.left,l),f=e.left;f<e.right;f++,d++,u+=h.default.BYTES_PER_PIXEL,c++){var p=a[d],m=(p>>>24)*(255&n[d])*o/65025|0;if(!(m<=0)){var g=it.data[u+h.default.ALPHA_BYTE_OFFSET],v=m+g-m*g/255|0;if(v>0){var y=it.data[u+h.default.RED_BYTE_OFFSET],E=it.data[u+h.default.GREEN_BYTE_OFFSET],w=it.data[u+h.default.BLUE_BYTE_OFFSET],P=255*m/v|0,b=255-P,C=v<<24|(p>>>16&255)+(y*b-(p>>>16&255)*b)/255<<16|(p>>>8&255)+(E*b-(p>>>8&255)*b)/255<<8|(255&p)+(w*b-(255&p)*b)/255;r[c]=C}}}}this.paintDabImplementation=function(n,i,o){null==At?(At=new Uint32Array(o.width*o.height),t(n,i,At,o.width,255)):(e(n,i,At,o.width,~~(St.resat<=0?0:Math.max(1,St.resat*St.resat*255)),16777215&It),a(n,i,At,o.brush,o.width,o.alpha),t(n,i,At,o.width,~~(255*St.bleed))),B(0,!1),Bt&&Nt.fusionLayers()}}function k(){function t(t,e,a,n,i){for(var o=Bt?mt:Nt.getActiveLayer(),r=t.top,s=e.top;s<e.bottom;s++,r++)for(var l=t.left+r*n,d=o.offsetOfPixel(e.left,s),c=e.left;c<e.right;c++,l++,d+=h.default.BYTES_PER_PIXEL){var u=o.data[d+h.default.RED_BYTE_OFFSET],f=o.data[d+h.default.GREEN_BYTE_OFFSET],p=o.data[d+h.default.BLUE_BYTE_OFFSET],m=o.data[d+h.default.ALPHA_BYTE_OFFSET],g=255-i;if(g>0){var v=a[l],y=255,E=g+y*(255-g)/255|0,w=255*g/E|0,P=255-w,b=(m*w+(v>>>24&255)*P)/255<<24&4278190080|(u*w+(v>>>16&255)*P)/255<<16&16711680|(f*w+(v>>>8&255)*P)/255<<8&65280|(p*w+(255&v)*P)/255&255;b==v&&(u>(16711680&v)?b+=65536:u<(16711680&v)&&(b-=65536),f>(65280&v)?b+=256:f<(65280&v)&&(b-=256),p>(255&v)?b+=1:p<(255&v)&&(b-=1)),a[l]=b}}if(t.left>0)for(var C=t.left,s=t.top;s<t.bottom;s++)for(var T=s*n,_=a[T+t.left],c=0;c<C;c++)a[T++]=_;if(t.right<n)for(var C=n-t.right,s=t.top;s<t.bottom;s++)for(var T=s*n+t.right,_=a[T-1],c=0;c<C;c++)a[T++]=_;for(var s=0;s<t.top;s++)for(var l=t.top*n,d=s*n,c=0;c<n;c++,l++,d++)a[d]=a[l];for(var s=t.bottom;s<n;s++)for(var l=(t.bottom-1)*n,d=s*n,c=0;c<n;c++,l++,d++)a[d]=a[l]}function e(t,e,a,n,i,o){for(var r=t.top,s=e.top;s<e.bottom;s++,r++)for(var l=t.left+r*i,d=it.offsetOfPixel(e.left,s),c=e.left;c<e.right;c++,l++,d+=h.default.BYTES_PER_PIXEL){var u=a[l],f=(u>>>24)*(255&n[l])/255;f>0&&(it.data[d+h.default.RED_BYTE_OFFSET]=u>>16&255,it.data[d+h.default.GREEN_BYTE_OFFSET]=u>>8&255,it.data[d+h.default.BLUE_BYTE_OFFSET]=255&u,it.data[d+h.default.ALPHA_BYTE_OFFSET]=u>>24&255)}}this.paintDabImplementation=function(a,n,i){null==At?(At=new Uint32Array(i.width*i.height),t(a,n,At,i.width,0)):(t(a,n,At,i.width,i.alpha),e(a,n,At,i.brush,i.width,i.alpha),Rt&&A(n)),Et.makeEmpty(),Bt&&Nt.fusionLayers()}}function A(t){Nt.getActiveLayer().copyAlphaFrom(gt,t)}function B(t,e){Et.isEmpty()||(St.paintMode==g.default.M_ERASE&&Rt?Dt[g.default.M_PAINT].mergeOpacityBuf(Et,st):Dt[St.paintMode].mergeOpacityBuf(Et,t),Rt&&A(Et),e&&yt.clearRect(Et,0),Et.makeEmpty())}function R(){return _t.length>0}function I(){return xt.length>0}function F(){vt.isEmpty()||(gt.copyBitmapRect(it,vt.left,vt.top,vt),vt.makeEmpty())}function N(){vt=Nt.getBounds()}function D(t){ht=!0,xt.length>0&&(xt=[]),0!=_t.length&&_t[_t.length-1].merge(t)?_t[_t.length-1].noChange()&&_t.pop():(_t.length>=ot&&_t.unshift(),_t.length>0&&_t[_t.length-1].compact(),_t.push(t))}function Y(){return _t.length>0?_t[_t.length-1]:null}function U(t,e){var a=Nt.getActiveLayerIndex();t&&D(new nt(e,a,Nt.getSelection()));var n,o,s=new r.default(Nt.width,Nt.height,Nt.getDefaultLayerName()),l=e.bmp.getBounds();ut.splice(a+1,0,s),Nt.setActiveLayerIndex(a+1),l.isInside(Nt.getBounds())?(n=e.x,o=e.y):(n=(Nt.width-e.bmp.width)/2|0,o=(Nt.height-e.bmp.height)/2|0),it.copyBitmapRect(e.bmp,n,o,l),Nt.emptySelection(),d(),i()}function H(){var t=Pt.clone(),e=gt.copyRectXOR(it,t);this.layer=Nt.getActiveLayerIndex(),Pt.makeEmpty(),this.undo=function(){Nt.getLayer(this.layer).setRectXOR(e,t),s(t)},this.redo=function(){Nt.getLayer(this.layer).setRectXOR(e,t),s(t)},this.getMemoryUsed=function(t,a){return e.length}}function W(t,e,a){this.layerIndex=t,this.oldVis=e,this.newVis=a}function X(t){this.undo=function(){ut.splice(t+1,1),Nt.setActiveLayerIndex(t),d(),i()},this.redo=function(){var e=new r.default(Nt.width,Nt.height,Nt.getDefaultLayerName());e.clearAll(st),ut.splice(t+1,0,e),Nt.setActiveLayerIndex(t+1),d(),i()}}function z(t){this.undo=function(){ut.splice(t+1,1),Nt.setActiveLayerIndex(t),d(),i()},this.redo=function(){var e=" Copy",a=ut[t],n=new r.default(Nt.width,Nt.height),o=a.name;o.endsWith(e)||(o+=e),n.copyFrom(a),n.name=o,ut.splice(t+1,0,n),Nt.setActiveLayerIndex(t+1),d(),i()}}function j(t,e){this.undo=function(){ut.splice(t,0,e),Nt.setActiveLayerIndex(t),d(),i()},this.redo=function(){ut.splice(t,1),Nt.setActiveLayerIndex(t<ut.length?t:t-1),d(),i()},this.getMemoryUsed=function(t){return t?0:e.width*e.height*h.default.BYTES_PER_PIXEL}}function $(t){var e,a=new r.default(Nt.width,Nt.height);a.copyFrom(ut[t-1]),e=ut[t],this.undo=function(){ut[t-1].copyFrom(a),ut.splice(t,0,e),Nt.setActiveLayerIndex(t),a=e=null,d(),i()},this.redo=function(){a=new r.default(Nt.width,Nt.height),a.copyFrom(ut[t-1]),e=ut[t],Nt.setActiveLayerIndex(t),Nt.mergeDown(!1)},this.getMemoryUsed=function(t,e){return t?0:Nt.width*Nt.height*h.default.BYTES_PER_PIXEL*2}}function G(){var t=Nt.getActiveLayerIndex(),e=ut.slice(0);this.undo=function(){ut=e.slice(0),Nt.setActiveLayerIndex(t),d(),i()},this.redo=function(){Nt.mergeAllLayers(!1)},this.getMemoryUsed=function(t,a){return t?0:e.length*width*height*h.default.BYTES_PER_PIXEL}}function q(t,e){this.undo=function(){e<=t?u(e,t+1):u(e-1,t)},this.redo=function(){u(t,e)}}function V(t,e){this.from=Nt.getLayer(t).getAlpha(),this.to=e,this.layerIndex=t}function Z(t,e){this.layerIndex=t,this.from=Nt.getLayer(t).getBlendMode(),this.to=e}function K(t,e){this.layerIndex=t,this.to=e,this.from=Nt.getLayer(t).name}function Q(t,e){t=t.clone(),e=e.clone(),this.undo=function(){Nt.setSelection(t),n(Nt.getBounds())},this.redo=function(){Nt.setSelection(e),n(Nt.getBounds())},this.noChange=function(){return t.equals(e)}}function J(t,e,a){var n,i,r=Nt.getSelection(),l=null,d=document.createElement("canvas"),c=d.getContext("2d"),u=document.createElement("canvas"),h=u.getContext("2d");e=e.clone(),a=a||"smooth",this.undo=function(){var e,a=Nt.getLayer(this.layerIndex),d=l.clone();d.union(t),e=d.clone(),e.translate(-i.left,-i.top),a.copyBitmapRect(n,d.left,d.top,e),Nt.setSelection(r),Nt.setActiveLayerIndex(this.layerIndex),s(d),o()},this.redo=function(){var n=Nt.getLayer(this.layerIndex);h.putImageData(n.getImageData(),0,0),h.clearRect(t.left,t.top,t.getWidth(),t.getHeight()),(0,O.setCanvasInterpolation)(h,"smooth"==a),h.save(),h.setTransform(e.m[0],e.m[1],e.m[2],e.m[3],e.m[4],e.m[5]),h.drawImage(d,t.left,t.top),h.restore(),n.setImageData(h.getImageData(0,0,n.width,n.height));var i=t.clone(),c=t.toPoints();if(e.transformPoints(c),l=T.default.createBoundingBox(c),l.roundContain(),n.getBounds().clip(l),i.union(l),s(i),!r.isEmpty()){var u,f=r.toPoints();e.transformPoints(f),u=T.default.createBoundingBox(f),u.roundNearest(),n.getBounds().clip(u),Nt.setSelection(u),o()}},this.amend=function(t){var a=Nt.getLayer(this.layerIndex);this.undo(),(i.getWidth()<a.width||i.getHeight()<a.height)&&(n=a.clone(),i=a.getBounds()),e=t.clone(),this.redo()},this.setInterpolation=function(t){t!=a&&(a=t,this.undo(),this.redo())},this.compact=function(){var e=Nt.getLayer(this.layerIndex);if(i.getWidth()==e.width&&i.getHeight()==e.height){var a=t.getUnion(l);2*a.getArea()<e.width*e.height&&(i=a,n=n.cloneRect(i))}},this.getMemoryUsed=function(t,e){return n.getMemorySize()},this.getTransform=function(){return e.clone()},this.getInitialTransformRect=function(){return t.clone()},this.getInitialSelectionRect=function(){return r.clone()},this.layerIndex=Nt.getActiveLayerIndex();var f=Nt.getLayer(this.layerIndex);n=f.clone(),i=f.getBounds(),u.width=f.width,u.height=f.height,d.width=t.getWidth(),d.height=t.getHeight(),c.putImageData(n.getImageData(),-t.left,-t.top,t.left,t.top,t.getWidth(),t.getHeight()),this.redo()}function tt(t,e,a,n){var i,r=Nt.getSelection(),l=null,d=null,c=null;this.undo=function(){var e=Nt.getLayer(this.layerIndex),a=l.clone();n||a.union(t),i?e.copyBitmapRect(i,a.left,a.top,a):(e.copyBitmapRect(d,t.left,t.top,d.getBounds()),c&&e.copyBitmapRect(c,l.left,l.top,c.getBounds())),Nt.setSelection(r),Nt.setActiveLayerIndex(this.layerIndex),s(a),o()},this.redo=function(){var c=Nt.getLayer(this.layerIndex),u=new T.default(0,0,0,0);if(n||(c.clearRect(t,0),u.set(t)),l=t.clone(),l.translate(e,a),c.getBounds().clip(l),i?c.pasteAlphaRect(i,t,l.left,l.top):c.pasteAlphaRect(d,d.getBounds(),l.left,l.top),u.union(l),s(u),!r.isEmpty()){var h=r.clone();h.translate(e,a),Nt.setSelection(h),o()}},this.amend=function(t,o){var r=Nt.getLayer(this.layerIndex);i?n?this.undo():(r.copyBitmapRect(i,l.left,l.top,l),s(l)):(this.undo(),i=r.clone(),d=null,c=null),e+=t,a+=o,this.redo()},this.compact=function(){i&&2*t.getArea()<Nt.width*Nt.height&&(d=i.cloneRect(t),c=!n&&l.isInside(t)?null:i.cloneRect(l),i=null)},this.getMemoryUsed=function(){var t=0;return i&&(t+=i.getMemorySize()),d&&(t+=d.getMemorySize()),c&&(t+=c.getMemorySize()),t},this.layerIndex=Nt.getActiveLayerIndex(),i=Nt.getLayer(this.layerIndex).clone(),this.redo()}function et(t){this.undoes=t}function at(t,e,a){a=a.clone(),this.undo=function(){Nt.setActiveLayerIndex(e),it.copyBitmapRect(t,a.left,a.top,t.getBounds()),Nt.setSelection(a),s(a)},this.redo=function(){Nt.setActiveLayerIndex(e),it.clearRect(a,st),Nt.emptySelection(),s(a)},this.getMemoryUsed=function(e,a){return t==a?0:t.width*t.height*h.default.BYTES_PER_PIXEL}}function nt(t,e,a){a=a.clone(),this.undo=function(){ut.splice(e+1,1),Nt.setActiveLayerIndex(e),Nt.setSelection(a),s(a),i()},this.redo=function(){Nt.setActiveLayerIndex(e),U(!1,t)},this.getMemoryUsed=function(e,a){return t.bmp==a?0:t.bmp.width*t.bmp.height*4}}t=0|t,e=0|e;var it,ot=30,rt=4294967295,st=16777215,lt=260,dt=64,ct=1,ut=[],ht=!1,ft=new T.default(0,0,0,0),pt=new r.default(t,e),mt=pt,gt=new r.default(t,e),vt=new T.default(0,0,t,e),yt=new c.default(t,e,32),Et=new T.default(0,0,0,0),wt=new T.default(0,0,t,e),Pt=new T.default(0,0,0,0),bt=new x.default,Ct=null,Tt=null,_t=[],xt=[],St=null,Lt=new p.default,Ot=0,Mt=0,kt=0,At=null,Bt=!1,Rt=!1,It=0,Ft="smooth",Nt=this;this.getLayers=function(){return ut},this.getLayerCount=function(){return ut.length},this.getSelectionAutoSelect=function(){var t;return t=ft.isEmpty()?this.getBounds():ft.clone()},this.getSelection=function(){return ft.clone()},this.setHasUnsavedChanges=function(t){ht=t},this.getHasUnsavedChanges=function(){return ht},this.setLayerVisibility=function(t,e){var a=this.getLayer(t);D(new W(t,a.visible,e)),a.visible=e,d(),i(t)},this.addLayer=function(){var t=new r.default(this.width,this.height,this.getDefaultLayerName()),e=this.getActiveLayerIndex();t.clearAll(st),D(new X(e)),ut.splice(e+1,0,t),this.setActiveLayerIndex(e+1),d(),i()},this.addLayerObject=function(t){ut.push(t),1==ut.length&&(it=ut[0]),d(),i()},this.removeLayer=function(){if(ut.length>1){var t=this.getActiveLayerIndex();return D(new j(t,it)),ut.splice(t,1),this.setActiveLayerIndex(t<ut.length?t:t-1),d(),i(),!0}return!1},this.duplicateLayer=function(){var t=" Copy",e=new r.default(this.width,this.height),a=this.getActiveLayerIndex();D(new z(a)),e.copyFrom(ut[a]),e.name.endsWith(t)||(e.name+=t),ut.splice(a+1,0,e),this.setActiveLayerIndex(a+1),d(),i()},this.mergeDown=function(t){var e=this.getActiveLayerIndex();ut.length>1&&e>0&&(t&&D(new $(e)),l.default.fuseLayer(ut[e-1],!0,ut[e],this.getBounds()),ut.splice(e,1),this.setActiveLayerIndex(e-1),d(),i())},this.mergeAllLayers=function(t){if(ut.length>1){t&&D(new G),Nt.fusionLayers(),ut=[];var e=new r.default(Nt.width,Nt.height,this.getDefaultLayerName());e.copyDataFrom(mt),ut.push(e),this.setActiveLayerIndex(0),d(),i()}},this.moveLayer=function(t,e){t<0||t>=this.getLayerCount()||e<0||e>this.getLayerCount()||t==e||(D(new q(t,e)),u(t,e))},this.setLayerAlpha=function(t,e){var a=this.getLayer(t);a.getAlpha()!=e&&(D(new V(t,e)),a.setAlpha(e),d(),i(t))},this.setLayerBlendMode=function(t,e){var a=this.getLayer(t);a.getBlendMode()!=e&&(D(new Z(t,e)),a.setBlendMode(e),d(),i(t))},this.setLayerName=function(t,e){var a=this.getLayer(t);a&&a.name!=e&&(D(new K(t,e)),a.name=e,i(t))},f.prototype.beginStroke=function(t,e,a){F(),Pt.makeEmpty(),yt.clearAll(0),Et.makeEmpty(),Ot=t,Mt=e,kt=a,this.createAndPaintDab(t,e,a)},f.prototype.continueStroke=function(t,e,a){
var n=Math.sqrt((Ot-t)*(Ot-t)+(Mt-e)*(Mt-e)),i=Math.max(St.minSpacing,St.curSize*St.spacing);if(n>i){for(var o=Ot,r=Mt,s=kt,l=(i-.001)/n,d=l;d<=1;d+=l)o=d*t+(1-d)*Ot,r=d*e+(1-d)*Mt,s=d*a+(1-d)*kt,this.createAndPaintDab(o,r,s);Ot=o,Mt=r,kt=s}},f.prototype.endStroke=function(){Pt.clip(Nt.getBounds()),Pt.isEmpty()||(B(It,!1),D(new H),F()),At=null},f.prototype.createAndPaintDab=function(t,e,a){St.applyPressure(a),St.scattering>0&&(t+=bt.nextGaussian()*St.curScattering/4,e+=bt.nextGaussian()*St.curScattering/4);var n=Lt.getDab(t,e,St);this.paintDab(n)},f.prototype.paintDab=function(t){var e=new T.default(0,0,t.width,t.height),n=new T.default(0,0,t.width,t.height);n.translate(t.x,t.y),a(e,n),n.isEmpty()||(Pt.union(n),Et.union(n),this.paintDabImplementation(e,n,t),s(n))},m.prototype=Object.create(f.prototype),m.prototype.constructor=m,m.prototype.paintDabImplementation=function(t,e,a){St.isAirbrush?this.paintFlow(t,e,a.brush,a.width,Math.max(1,a.alpha/8)):St.toolNb==ChickenPaint.T_PEN?this.paintFlow(t,e,a.brush,a.width,Math.max(1,a.alpha/2)):this.paintOpacity(t,e,a.brush,a.width,a.alpha)},m.prototype.mergeOpacityBuf=function(t,e){for(var a=yt.data,n=gt.data,i=e>>16&255,o=e>>8&255,r=255&e,s=0|t.getWidth(),l=0|t.getHeight(),d=it.offsetOfPixel(t.left,t.top),c=yt.offsetOfPixel(t.left,t.top),u=yt.width-s|0,f=(it.width-s)*h.default.BYTES_PER_PIXEL|0,p=0;p<l;p++,c+=u,d+=f)for(var m=0;m<s;m++,c++,d+=h.default.BYTES_PER_PIXEL){var g=a[c]/255|0;if(g>0){var v=n[d+h.default.ALPHA_BYTE_OFFSET],y=g+v*(255-g)/255|0,E=255*g/y|0,w=255-E;it.data[d]=(i*E+n[d]*w)/255&255,it.data[d+1]=(o*E+n[d+1]*w)/255&255,it.data[d+2]=(r*E+n[d+2]*w)/255&255,it.data[d+3]=y}}},m.prototype.paintOpacity=function(t,e,a,n,i){var o=yt.data,r=t.left+t.top*n,s=yt.offsetOfPixel(e.left,e.top),l=e.getWidth(),d=n-l,c=Nt.width-l;i=Math.min(255,i);for(var u=e.top;u<e.bottom;u++,r+=d,s+=c)for(var h=0;h<l;h++,r++,s++)o[s]=Math.max(a[r]*i,o[s])},m.prototype.paintFlow=function(t,e,a,n,i){for(var o=yt.data,r=t.left+t.top*n,s=yt.offsetOfPixel(e.left,e.top),l=e.getWidth(),d=n-l,c=Nt.width-l,u=e.top;u<e.bottom;u++,r+=d,s+=c)for(var h=0;h<l;h++,r++,s++){var f=a[r]*i;if(0!=f){var p=Math.min(65025,o[s]+(255-o[s]/255)*f/255);o[s]=p}}},v.prototype=Object.create(m.prototype),v.prototype.constructor=v,v.prototype.mergeOpacityBuf=function(t,e){for(var a=yt.data,n=gt.data,i=t.top;i<t.bottom;i++)for(var o=it.offsetOfPixel(t.left,i)+h.default.ALPHA_BYTE_OFFSET,r=yt.offsetOfPixel(t.left,i),s=t.left;s<t.right;s++,o+=h.default.BYTES_PER_PIXEL){var l=a[r++]/255|0;if(l>0){var d=n[o],c=d*(255-l)/255;it.data[o]=c}}},E.prototype=Object.create(m.prototype),E.prototype.constructor=E,E.prototype.mergeOpacityBuf=function(t,e){for(var a=yt.data,n=gt.data,i=t.top;i<t.bottom;i++)for(var o=it.offsetOfPixel(t.left,i),r=yt.offsetOfPixel(t.left,i),s=t.left;s<t.right;s++,r++,o+=h.default.BYTES_PER_PIXEL){var l=a[r]/255|0;if(l>0&&0!=n[o+h.default.ALPHA_BYTE_OFFSET]){l+=255;for(var d=0;d<3;d++){var c=n[o+d]*l/255|0;c>255&&(c=255),it.data[o+d]=c}}}},P.prototype=Object.create(m.prototype),P.prototype.constructor=P,P.prototype.mergeOpacityBuf=function(t,e){for(var a=yt.data,n=gt.data,i=t.top;i<t.bottom;i++)for(var o=it.offsetOfPixel(t.left,i),r=yt.offsetOfPixel(t.left,i),s=t.left;s<t.right;s++,r++,o+=h.default.BYTES_PER_PIXEL){var l=a[r]/255|0;if(l>0&&0!=n[o+h.default.ALPHA_BYTE_OFFSET])for(var d=0;d<3;d++){var c=n[o+d];c=c-(lt-c)*l/255|0,c<0&&(c=0),it.data[o+d]=c}}},C.prototype=Object.create(m.prototype),C.prototype.constructor=C,C.prototype.mergeOpacityBuf=function(t,e){function a(t){n+=l[t+h.default.RED_BYTE_OFFSET],i+=l[t+h.default.GREEN_BYTE_OFFSET],o+=l[t+h.default.BLUE_BYTE_OFFSET],r+=l[t+h.default.ALPHA_BYTE_OFFSET]}for(var n,i,o,r,s=yt.data,l=gt.data,d=gt.width*h.default.BYTES_PER_PIXEL,c=t.top;c<t.bottom;c++)for(var u=gt.offsetOfPixel(t.left,c),f=yt.offsetOfPixel(t.left,c),p=t.left;p<t.right;p++,u+=h.default.BYTES_PER_PIXEL,f++){var m=s[f]/255|0;if(m>0){var g=dt+(ct-dt)*m/255|0,v=g+4;n=g*l[u+h.default.RED_BYTE_OFFSET],i=g*l[u+h.default.GREEN_BYTE_OFFSET],o=g*l[u+h.default.BLUE_BYTE_OFFSET],r=g*l[u+h.default.ALPHA_BYTE_OFFSET],a(c>0?u-d:u),a(c<gt.height-1?u+d:u),a(p>0?u-h.default.BYTES_PER_PIXEL:u),a(p<gt.width-1?u+h.default.BYTES_PER_PIXEL:u),r/=v,n/=v,i/=v,o/=v,it.data[u+h.default.RED_BYTE_OFFSET]=0|n,it.data[u+h.default.GREEN_BYTE_OFFSET]=0|i,it.data[u+h.default.BLUE_BYTE_OFFSET]=0|o,it.data[u+h.default.ALPHA_BYTE_OFFSET]=0|r}}},_.prototype=Object.create(m.prototype),_.prototype.constructor=_,_.prototype.mergeOpacityBuf=function(t,e){for(var a=yt.data,n=gt.data,i=yt.offsetOfPixel(t.left,t.top),o=it.offsetOfPixel(t.left,t.top),r=0|t.getWidth(),s=0|t.getHeight(),l=yt.width-r|0,d=(it.width-r)*h.default.BYTES_PER_PIXEL|0,c=0;c<s;c++,i+=l,o+=d)for(var u=0;u<r;u++,i++,o+=h.default.BYTES_PER_PIXEL){var f=a[i],p=f>>>24;if(0!=p){var m=n[o+h.default.ALPHA_BYTE_OFFSET],g=p+m-p*m/255|0;if(g>0){var v=255*p/g|0,y=255-v;it.data[o]=((f>>16&255)*v+n[o]*y)/255|0,it.data[o+1]=((f>>8&255)*v+n[o+1]*y)/255|0,it.data[o+2]=((255&f)*v+n[o+2]*y)/255|0,it.data[o+3]=g}}}},S.prototype=Object.create(_.prototype),S.prototype.constructor=S,M.prototype=Object.create(_.prototype),M.prototype.constructor=M,k.prototype=Object.create(_.prototype),k.prototype.constructor=k,k.prototype.mergeOpacityBuf=function(t,e){};var Dt=[new m,new v,new E,new P,new S,new C,new k,new M];this.width=t,this.height=e,this.getDefaultLayerName=function(){for(var t="Layer ",e=0,a=0;a<ut.length;a++){var n=ut[a];/^Layer [0-9]+$/.test(n.name)&&(e=Math.max(e,parseInt(n.name.substring(t.length),10)))}return t+(e+1)},this.addBackgroundLayer=function(){var t=new r.default(Nt.width,Nt.height,this.getDefaultLayerName());t.clearAll(rt),this.addLayerObject(t)},this.fusionLayers=function(){if(!wt.isEmpty()){if(B(It,!1),1==ut.length&&ut[0].alpha>=100&&ut[0].visible)mt=ut[0];else{mt=pt;var t=!0,e=!0;ut.forEach(function(a){if(e||(t=t&&mt.hasAlphaInRect(wt)),a.visible&&a.alpha>0){if(e){if(e=!1,100==a.alpha)return void mt.copyBitmapRect(a,wt.left,wt.top,wt);mt.clearRect(wt,16777215)}l.default.fuseLayer(mt,t,a,wt)}}),e&&mt.clearRect(wt,16777215)}wt.makeEmpty()}return mt.getImageData()},this.setActiveLayerIndex=function(t){if(!(t<0||t>=ut.length)&&it!=ut[t]){var e=this.getActiveLayerIndex();it=ut[t],e==-1?i():(i(e),i(t)),N()}},this.getActiveLayerIndex=function(){for(var t=0;t<ut.length;t++)if(ut[t]==it)return t;return-1},this.getTopmostVisibleLayer=function(){for(var t=ut.length-1;t>=0;t--)if(ut[t].visible)return t;return 0},this.getLayer=function(t){return ut[t]},this.getActiveLayer=function(){return it},this.getDocMemoryUsed=function(){var t=pt.getMemorySize()*(3+ut.length);return null!=Tt&&(t+=Tt.bmp.getMemorySize()),t},this.getUndoMemoryUsed=function(){for(var t=0,e=0;e<xt.length;e++){var a=xt[e];t+=a.getMemoryUsed(!0,null)}for(var e=0;e<_t.length;e++){var a=_t[e];t+=a.getMemoryUsed(!1,null)}return t},this.undo=function(){if(R()){ht=!0;var t=_t.pop();t.undo(),xt.push(t)}},this.redo=function(){if(I()){ht=!0;var t=xt.pop();t.redo(),_t.push(t)}},this.performIdleTasks=function(){F()},this.clearHistory=function(){_t=[],xt=[]},this.colorPicker=function(t,e){return 16777215&mt.getPixel(~~t,~~e)},this.setSelection=function(t){ft.set(t),ft.clip(this.getBounds())},this.emptySelection=function(){ft.makeEmpty()},this.floodFill=function(t,e){F(),Pt=this.getBounds(),it.floodFill(~~t,~~e,4278190080|It),D(new H),d()},this.gradientFill=function(t,e,a,n,i){var o=this.getSelectionAutoSelect();F(),Pt=o,it.gradient(o,t,e,a,n,i),Rt&&A(o),D(new H),d()},this.fill=function(t){var e=this.getSelectionAutoSelect();F(),Pt=e,it.clearRect(e,t),D(new H),d()},this.clear=function(){this.fill(16777215)},this.hFlip=function(){var t=this.getSelectionAutoSelect();F(),Pt=t,it.copyRegionHFlip(t,gt),D(new H),d()},this.vFlip=function(){var t=this.getSelectionAutoSelect();F(),Pt=t,it.copyRegionVFlip(t,gt),D(new H),d()},this.monochromaticNoise=function(){var t=this.getSelectionAutoSelect();F(),Pt=t,it.fillWithNoise(t),D(new H),d()},this.colorNoise=function(){var t=this.getSelectionAutoSelect();F(),Pt=t,it.fillWithColorNoise(t),D(new H),d()},this.invert=function(){var t=this.getSelectionAutoSelect();F(),Pt=t,it.invert(t),D(new H),d()},this.boxBlur=function(t,e,a){var n=this.getSelectionAutoSelect();F(),Pt=n;for(var i=0;i<a;i++)it.boxBlur(n,t,e);D(new H),d()},this.rectangleSelection=function(t){var e=t.clone();e.clip(this.getBounds()),D(new Q(this.getSelection(),e)),this.setSelection(e)},this.move=function(t,e,a){if(t|=0,e|=0,0!=t||0!=e){Et.makeEmpty();var n=Y();!a&&n instanceof tt&&n.layerIndex==this.getActiveLayerIndex()?(n.amend(t,e),xt=[],ht=!0):(n=new tt(this.getSelectionAutoSelect(),t,e,a),D(n))}},this.setTransformInterpolation=function(t){Ft=t,Ct instanceof J&&Ct.setInterpolation(t)},this.transformAffineAbort=function(){Ct instanceof J&&(Ct.undo(),Ct=null)},this.transformAffineBegin=function(){if(Ct instanceof J)return{transform:Ct.getTransform(),rect:Ct.getInitialTransformRect(),selection:Ct.getInitialSelectionRect()};var t=this.getActiveLayer(),e=this.getSelectionAutoSelect(),a=t.getNonTransparentBounds(e),n=new L.default;return a.isEmpty()?null:(Ct=new J(a,n,Ft),Et.makeEmpty(),{transform:n,rect:a,selection:e})},this.transformAffineFinish=function(){Ct instanceof J&&(D(Ct),Ct=null)},this.transformAffineAmend=function(t){Ct instanceof J&&Ct.amend(t)},this.cutSelection=function(t){var e=this.getSelection();e.isEmpty()||(Tt=new w.default(it.cloneRect(e),e.left,e.top),t&&D(new at(Tt.bmp,this.getActiveLayerIndex(),e)),it.clearRect(e,st),s(e))},this.copySelection=function(){var t=Nt.getSelection();t.isEmpty()||(Tt=new w.default(it.cloneRect(t),t.left,t.top))},this.copySelectionMerged=function(){var t=Nt.getSelection();t.isEmpty()||(this.fusionLayers(),Tt=new w.default(mt.cloneRect(t),t.left,t.top))},this.pasteClipboard=function(t){null!=Tt&&U(t,Tt)},this.setSampleAllLayers=function(t){Bt=t},this.setLockAlpha=function(t){Rt=t},this.setForegroundColor=function(t){It=t},this.setBrush=function(t){St=t},this.setBrushTexture=function(t){Lt.setTexture(t)},this.beginStroke=function(t,e,a){null!=St&&Dt[St.paintMode].beginStroke(t,e,a)},this.continueStroke=function(t,e,a){null!=St&&Dt[St.paintMode].continueStroke(t,e,a)},this.endStroke=function(){null!=St&&Dt[St.paintMode].endStroke()},this.hasAlpha=function(){return mt.hasAlpha()},this.getFlatPNG=function(t){return this.fusionLayers(),mt.getAsPNG(t)},this.isSimpleDrawing=function(){return 1==this.getLayerCount()&&100==this.getLayer(0).getAlpha()},H.prototype=Object.create(y.default.prototype),H.prototype.constructor=H,W.prototype=Object.create(y.default.prototype),W.prototype.constructor=W,W.prototype.redo=function(){Nt.getLayer(this.layerIndex).visible=this.newVis,d(),i(this.layerIndex)},W.prototype.undo=function(){Nt.getLayer(this.layerIndex).visible=this.oldVis,d(),i(this.layerIndex)},W.prototype.merge=function(t){return t instanceof W&&this.layerIndex==t.layerIndex&&(this.newVis=t.newVis,!0)},W.prototype.noChange=function(){return this.oldVis==this.newVis},X.prototype=Object.create(y.default.prototype),X.prototype.constructor=X,z.prototype=Object.create(y.default.prototype),z.prototype.constructor=z,j.prototype=Object.create(y.default.prototype),j.prototype.constructor=j,$.prototype=Object.create(y.default.prototype),$.prototype.constructor=$,G.prototype=Object.create(y.default.prototype),G.prototype.constructor=G,q.prototype=Object.create(y.default.prototype),q.prototype.constructor=q,V.prototype=Object.create(y.default.prototype),V.prototype.constructor=V,V.prototype.undo=function(){Nt.getLayer(this.layerIndex).setAlpha(this.from),d(),i(this.layerIndex)},V.prototype.redo=function(){Nt.getLayer(this.layerIndex).setAlpha(this.to),d(),i(this.layerIndex)},V.prototype.merge=function(t){return t instanceof V&&this.layerIndex==t.layerIndex&&(this.to=t.to,!0)},V.prototype.noChange=function(){return this.from==this.to},Z.prototype=Object.create(y.default.prototype),Z.prototype.constructor=Z,Z.prototype.undo=function(){Nt.getLayer(this.layerIndex).setBlendMode(this.from),d(),i()},Z.prototype.redo=function(){Nt.getLayer(this.layerIndex).setBlendMode(this.to),d(),i()},Z.prototype.merge=function(t){return t instanceof Z&&this.layerIndex==t.layerIndex&&(this.to=t.to,!0)},Z.prototype.noChange=function(){return this.from==this.to},K.prototype=Object.create(y.default.prototype),K.prototype.constructor=K,K.prototype.undo=function(){Nt.getLayer(this.layerIndex).name=this.from,i(this.layerIndex)},K.prototype.redo=function(){Nt.getLayer(this.layerIndex).name=this.to,i(this.layerIndex)},K.prototype.merge=function(t){return t instanceof K&&this.layerIndex==t.layerIndex&&(this.to=t.to,!0)},K.prototype.noChange=function(){return this.from==this.to},Q.prototype=Object.create(y.default.prototype),Q.prototype.constructor=Q,J.prototype=Object.create(y.default.prototype),J.prototype.constructor=J,tt.prototype=Object.create(y.default.prototype),tt.prototype.constructor=tt,et.prototype=Object.create(y.default.prototype),et.prototype.constructor=et,et.prototype.undo=function(){for(var t=this.undoes.length-1;t>=0;t--)this.undoes[t].undo()},et.prototype.redo=function(){for(var t=0;t<this.undoes.length;t++)this.undoes[t].redo()},et.prototype.noChange=function(){for(var t=0;t<undoes.length;t++)if(!undoes[t].noChange())return!1;return!0},et.prototype.getMemoryUsed=function(t,e){for(var a=0,n=0;n<undoes.length;n++)a+=undoes[n].getMemoryUsed(t,e);return a},at.prototype=Object.create(y.default.prototype),at.prototype.constructor=at,nt.prototype=Object.create(y.default.prototype),nt.prototype.constructor=nt}Object.defineProperty(a,"__esModule",{value:!0}),a.default=i;var o=t("./CPLayer"),r=n(o),s=t("./CPBlend"),l=n(s),d=t("./CPGreyBmp"),c=n(d),u=t("./CPColorBmp"),h=n(u),f=t("./CPBrushManager"),p=n(f),m=t("./CPBrushInfo"),g=n(m),v=t("./CPUndo"),y=n(v),E=t("./CPClip"),w=n(E),P=t("../util/CPColorFloat"),b=n(P),C=t("../util/CPRect"),T=n(C),_=t("../util/CPRandom"),x=n(_),S=t("../util/CPTransform"),L=n(S),O=t("../util/CPPolyfill");String.prototype.endsWith||(String.prototype.endsWith=function(t,e){var a=this.toString();("number"!=typeof e||!isFinite(e)||Math.floor(e)!==e||e>a.length)&&(e=a.length),e-=t.length;var n=a.indexOf(t,e);return n!==-1&&n===e}),i.prototype=Object.create(EventEmitter.prototype),i.prototype.constructor=i,i.prototype.getBounds=function(){return new T.default(0,0,this.width,this.height)},i.prototype.isPointWithin=function(t,e){return t>=0&&e>=0&&t<this.width&&e<this.height},e.exports=a.default},{"../util/CPColorFloat":48,"../util/CPPolyfill":49,"../util/CPRandom":51,"../util/CPRect":52,"../util/CPTransform":53,"./CPBlend":4,"./CPBrushInfo":5,"./CPBrushManager":6,"./CPClip":8,"./CPColorBmp":9,"./CPGreyBmp":10,"./CPLayer":11,"./CPUndo":15}],3:[function(t,e,a){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function i(t,e){this.width=0|t,this.height=0|e}Object.defineProperty(a,"__esModule",{value:!0}),a.default=i;var o=t("../util/CPRect"),r=n(o);i.prototype.getBounds=function(){return new r.default(0,0,this.width,this.height)},i.prototype.isInside=function(t,e){return t>=0&&e>=0&&t<this.width&&e<this.height},e.exports=a.default},{"../util/CPRect":52}],4:[function(t,e,a){"use strict";function n(){}function i(){for(var t=0;t<256;t++){var e=t/255;l[t]=255*(e-e*e)|0}for(var t=0;t<256;t++){var e=t/255;d[t]=255*(Math.sqrt(e)-e)|0}}Object.defineProperty(a,"__esModule",{value:!0}),a.default=n;var o=4,r=3,s=["normal","multiply","add","screen","lighten","darken","subtract","dodge","burn","overlay","hardLight","softLight","vividLight","linearLight","pinLight"],l=new Array(256),d=new Array(256);n.multiplyOntoOpaqueFusionWithOpaqueLayer=function(t,e,a){for(var n=0|a.getHeight(),i=0|a.getWidth(),s=(t.width-i)*o|0,l=0|t.offsetOfPixel(a.left,a.top),d=0;d<n;d++,l+=s)for(var c=0;c<i;c++,l+=o){var u,h;u=t.data[l+r],u&&(h=e.data[l],e.data[l]=h-(255^t.data[l])*h*u/65025|0,h=e.data[l+1],e.data[l+1]=h-(255^t.data[l+1])*h*u/65025|0,h=e.data[l+2],e.data[l+2]=h-(255^t.data[l+2])*h*u/65025|0)}},n.multiplyOntoOpaqueFusionWithTransparentLayer=function(t,e,a){for(var n=0|a.getHeight(),i=0|a.getWidth(),s=(t.width-i)*o|0,l=0|t.offsetOfPixel(a.left,a.top),d=0;d<n;d++,l+=s)for(var c=0;c<i;c++,l+=o){var u,h;u=t.data[l+r]*t.alpha/100|0,u&&(h=e.data[l],e.data[l]=h-(255^t.data[l])*h*u/65025|0,h=e.data[l+1],e.data[l+1]=h-(255^t.data[l+1])*h*u/65025|0,h=e.data[l+2],e.data[l+2]=h-(255^t.data[l+2])*h*u/65025|0)}},n.multiplyOntoTransparentFusionWithOpaqueLayer=function(t,e,a){for(var n=0|a.getHeight(),i=0|a.getWidth(),s=(t.width-i)*o|0,l=0|t.offsetOfPixel(a.left,a.top),d=0;d<n;d++,l+=s)for(var c=0;c<i;c++,l+=o){var u,h,f,p;if(u=t.data[l+r]){h=e.data[l+r];var m=u+h-u*h/255|0,g=u*h/255|0,v=u*(255^h)/255|0,y=(255^u)*h/255|0;f=t.data[l],p=e.data[l],e.data[l]=(f*v+p*y+f*p*g/255)/m|0,f=t.data[l+1],p=e.data[l+1],e.data[l+1]=(f*v+p*y+f*p*g/255)/m|0,f=t.data[l+2],p=e.data[l+2],e.data[l+2]=(f*v+p*y+f*p*g/255)/m|0,e.data[l+r]=m}}},n.multiplyOntoTransparentFusionWithTransparentLayer=function(t,e,a){for(var n=0|a.getHeight(),i=0|a.getWidth(),s=(t.width-i)*o|0,l=0|t.offsetOfPixel(a.left,a.top),d=0;d<n;d++,l+=s)for(var c=0;c<i;c++,l+=o){var u,h,f,p;if(u=t.data[l+r]*t.alpha/100|0){h=e.data[l+r];var m=u+h-u*h/255|0,g=u*h/255|0,v=u*(255^h)/255|0,y=(255^u)*h/255|0;f=t.data[l],p=e.data[l],e.data[l]=(f*v+p*y+f*p*g/255)/m|0,f=t.data[l+1],p=e.data[l+1],e.data[l+1]=(f*v+p*y+f*p*g/255)/m|0,f=t.data[l+2],p=e.data[l+2],e.data[l+2]=(f*v+p*y+f*p*g/255)/m|0,e.data[l+r]=m}}},n.normalOntoOpaqueFusionWithOpaqueLayer=function(t,e,a){for(var n=0|a.getHeight(),i=0|a.getWidth(),s=(t.width-i)*o|0,l=0|t.offsetOfPixel(a.left,a.top),d=0;d<n;d++,l+=s)for(var c=0;c<i;c++,l+=o){var u,h;if(u=t.data[l+r])if(255==u)e.data[l]=t.data[l],e.data[l+1]=t.data[l+1],e.data[l+2]=t.data[l+2];else{var f=255-u;h=t.data[l],e.data[l]=(h*u+e.data[l]*f)/255|0,h=t.data[l+1],e.data[l+1]=(h*u+e.data[l+1]*f)/255|0,h=t.data[l+2],e.data[l+2]=(h*u+e.data[l+2]*f)/255|0}}},n.normalOntoOpaqueFusionWithTransparentLayer=function(t,e,a){for(var n=0|a.getHeight(),i=0|a.getWidth(),s=(t.width-i)*o|0,l=0|t.offsetOfPixel(a.left,a.top),d=0;d<n;d++,l+=s)for(var c=0;c<i;c++,l+=o){var u,h;if(u=t.data[l+r]*t.alpha/100|0)if(255==u)e.data[l]=t.data[l],e.data[l+1]=t.data[l+1],e.data[l+2]=t.data[l+2];else{var f=255-u;h=t.data[l],e.data[l]=(h*u+e.data[l]*f)/255|0,h=t.data[l+1],e.data[l+1]=(h*u+e.data[l+1]*f)/255|0,h=t.data[l+2],e.data[l+2]=(h*u+e.data[l+2]*f)/255|0}}},n.normalOntoTransparentFusionWithOpaqueLayer=function(t,e,a){for(var n=0|a.getHeight(),i=0|a.getWidth(),s=(t.width-i)*o|0,l=0|t.offsetOfPixel(a.left,a.top),d=0;d<n;d++,l+=s)for(var c=0;c<i;c++,l+=o){var u,h;if(u=t.data[l+r]){h=e.data[l+r];var f=u+h-u*h/255|0,p=255*u/f|0,m=255-p;e.data[l]=(t.data[l]*p+e.data[l]*m)/255,e.data[l+1]=(t.data[l+1]*p+e.data[l+1]*m)/255,e.data[l+2]=(t.data[l+2]*p+e.data[l+2]*m)/255,e.data[l+r]=f}}},n.normalOntoTransparentFusionWithTransparentLayer=function(t,e,a){for(var n=0|a.getHeight(),i=0|a.getWidth(),s=(t.width-i)*o|0,l=0|t.offsetOfPixel(a.left,a.top),d=0;d<n;d++,l+=s)for(var c=0;c<i;c++,l+=o){var u,h;if(u=t.data[l+r]*t.alpha/100|0){h=e.data[l+r];var f=u+h-u*h/255|0,p=255*u/f|0,m=255-p;e.data[l]=(t.data[l]*p+e.data[l]*m)/255,e.data[l+1]=(t.data[l+1]*p+e.data[l+1]*m)/255,e.data[l+2]=(t.data[l+2]*p+e.data[l+2]*m)/255,e.data[l+r]=f}}},n.addOntoOpaqueFusionWithOpaqueLayer=function(t,e,a){for(var n=0|a.getHeight(),i=0|a.getWidth(),s=(t.width-i)*o|0,l=0|t.offsetOfPixel(a.left,a.top),d=0;d<n;d++,l+=s)for(var c=0;c<i;c++,l+=o){var u;u=t.data[l+r],u&&(e.data[l]=e.data[l]+u*t.data[l]/255|0,e.data[l+1]=e.data[l+1]+u*t.data[l+1]/255|0,e.data[l+2]=e.data[l+2]+u*t.data[l+2]/255|0)}},n.addOntoOpaqueFusionWithTransparentLayer=function(t,e,a){for(var n=0|a.getHeight(),i=0|a.getWidth(),s=(t.width-i)*o|0,l=0|t.offsetOfPixel(a.left,a.top),d=0;d<n;d++,l+=s)for(var c=0;c<i;c++,l+=o){var u;u=t.data[l+r]*t.alpha/100|0,u&&(e.data[l]=e.data[l]+u*t.data[l]/255|0,e.data[l+1]=e.data[l+1]+u*t.data[l+1]/255|0,e.data[l+2]=e.data[l+2]+u*t.data[l+2]/255|0)}},n.addOntoTransparentFusionWithOpaqueLayer=function(t,e,a){for(var n=0|a.getHeight(),i=0|a.getWidth(),s=(t.width-i)*o|0,l=0|t.offsetOfPixel(a.left,a.top),d=0;d<n;d++,l+=s)for(var c=0;c<i;c++,l+=o){var u,h;if(u=t.data[l+r]){h=e.data[l+r];var f=u+h-u*h/255|0;e.data[l]=(h*e.data[l]+u*t.data[l])/f|0,e.data[l+1]=(h*e.data[l+1]+u*t.data[l+1])/f|0,e.data[l+2]=(h*e.data[l+2]+u*t.data[l+2])/f|0,e.data[l+r]=f}}},n.addOntoTransparentFusionWithTransparentLayer=function(t,e,a){for(var n=0|a.getHeight(),i=0|a.getWidth(),s=(t.width-i)*o|0,l=0|t.offsetOfPixel(a.left,a.top),d=0;d<n;d++,l+=s)for(var c=0;c<i;c++,l+=o){var u,h;if(u=t.data[l+r]*t.alpha/100|0){h=e.data[l+r];var f=u+h-u*h/255|0;e.data[l]=(h*e.data[l]+u*t.data[l])/f|0,e.data[l+1]=(h*e.data[l+1]+u*t.data[l+1])/f|0,e.data[l+2]=(h*e.data[l+2]+u*t.data[l+2])/f|0,e.data[l+r]=f}}},n.subtractOntoOpaqueFusionWithOpaqueLayer=function(t,e,a){for(var n=0|a.getHeight(),i=0|a.getWidth(),s=(t.width-i)*o|0,l=0|t.offsetOfPixel(a.left,a.top),d=0;d<n;d++,l+=s)for(var c=0;c<i;c++,l+=o){var u;u=t.data[l+r],u&&(e.data[l]=e.data[l]+u*t.data[l]/255-u|0,e.data[l+1]=e.data[l+1]+u*t.data[l+1]/255-u|0,e.data[l+2]=e.data[l+2]+u*t.data[l+2]/255-u|0)}},n.subtractOntoOpaqueFusionWithTransparentLayer=function(t,e,a){for(var n=0|a.getHeight(),i=0|a.getWidth(),s=(t.width-i)*o|0,l=0|t.offsetOfPixel(a.left,a.top),d=0;d<n;d++,l+=s)for(var c=0;c<i;c++,l+=o){var u;u=t.data[l+r]*t.alpha/100|0,u&&(e.data[l]=e.data[l]+u*t.data[l]/255-u|0,e.data[l+1]=e.data[l+1]+u*t.data[l+1]/255-u|0,e.data[l+2]=e.data[l+2]+u*t.data[l+2]/255-u|0)}},n.subtractOntoTransparentFusionWithOpaqueLayer=function(t,e,a){for(var n=0|a.getHeight(),i=0|a.getWidth(),s=(t.width-i)*o|0,l=0|t.offsetOfPixel(a.left,a.top),d=0;d<n;d++,l+=s)for(var c=0;c<i;c++,l+=o){var u,h;if(u=t.data[l+r]){h=e.data[l+r];var f=u+h-u*h/255|0,p=u*h;e.data[l]=(h*e.data[l]+u*t.data[l]-p)/f|0,e.data[l+1]=(h*e.data[l+1]+u*t.data[l+1]-p)/f|0,e.data[l+2]=(h*e.data[l+2]+u*t.data[l+2]-p)/f|0,e.data[l+r]=f}}},n.subtractOntoTransparentFusionWithTransparentLayer=function(t,e,a){for(var n=0|a.getHeight(),i=0|a.getWidth(),s=(t.width-i)*o|0,l=0|t.offsetOfPixel(a.left,a.top),d=0;d<n;d++,l+=s)for(var c=0;c<i;c++,l+=o){var u,h;if(u=t.data[l+r]*t.alpha/100|0){h=e.data[l+r];var f=u+h-u*h/255|0,p=u*h;e.data[l]=(h*e.data[l]+u*t.data[l]-p)/f|0,e.data[l+1]=(h*e.data[l+1]+u*t.data[l+1]-p)/f|0,e.data[l+2]=(h*e.data[l+2]+u*t.data[l+2]-p)/f|0,e.data[l+r]=f}}},n.screenOntoOpaqueFusionWithOpaqueLayer=function(t,e,a){for(var n=0|a.getHeight(),i=0|a.getWidth(),s=(t.width-i)*o|0,l=0|t.offsetOfPixel(a.left,a.top),d=0;d<n;d++,l+=s)for(var c=0;c<i;c++,l+=o){var u,h;if(u=t.data[l+r]){var f=255^u;h=e.data[l],e.data[l]=255^((255^h)*f+(255^t.data[l])*(255^h)*u/255)/255,h=e.data[l+1],e.data[l+1]=255^((255^h)*f+(255^t.data[l+1])*(255^h)*u/255)/255,h=e.data[l+2],e.data[l+2]=255^((255^h)*f+(255^t.data[l+2])*(255^h)*u/255)/255}}},n.screenOntoOpaqueFusionWithTransparentLayer=function(t,e,a){for(var n=0|a.getHeight(),i=0|a.getWidth(),s=(t.width-i)*o|0,l=0|t.offsetOfPixel(a.left,a.top),d=0;d<n;d++,l+=s)for(var c=0;c<i;c++,l+=o){var u,h;if(u=t.data[l+r]*t.alpha/100|0){var f=255^u;h=e.data[l],e.data[l]=255^((255^h)*f+(255^t.data[l])*(255^h)*u/255)/255,h=e.data[l+1],e.data[l+1]=255^((255^h)*f+(255^t.data[l+1])*(255^h)*u/255)/255,h=e.data[l+2],e.data[l+2]=255^((255^h)*f+(255^t.data[l+2])*(255^h)*u/255)/255}}},n.screenOntoTransparentFusionWithOpaqueLayer=function(t,e,a){for(var n=0|a.getHeight(),i=0|a.getWidth(),s=(t.width-i)*o|0,l=0|t.offsetOfPixel(a.left,a.top),d=0;d<n;d++,l+=s)for(var c=0;c<i;c++,l+=o){var u,h,f,p;if(u=t.data[l+r]){h=e.data[l+r];var m=u+h-u*h/255|0,g=u*h/255|0,v=u*(255^h)/255|0,y=(255^u)*h/255|0;f=t.data[l],p=e.data[l],e.data[l]=255^((255^f)*v+(255^p)*y+(255^f)*(255^p)*g/255)/m,f=t.data[l+1],p=e.data[l+1],e.data[l+1]=255^((255^f)*v+(255^p)*y+(255^f)*(255^p)*g/255)/m,f=t.data[l+2],p=e.data[l+2],e.data[l+2]=255^((255^f)*v+(255^p)*y+(255^f)*(255^p)*g/255)/m,e.data[l+r]=m}}},n.screenOntoTransparentFusionWithTransparentLayer=function(t,e,a){for(var n=0|a.getHeight(),i=0|a.getWidth(),s=(t.width-i)*o|0,l=0|t.offsetOfPixel(a.left,a.top),d=0;d<n;d++,l+=s)for(var c=0;c<i;c++,l+=o){var u,h,f,p;if(u=t.data[l+r]*t.alpha/100|0){h=e.data[l+r];var m=u+h-u*h/255|0,g=u*h/255|0,v=u*(255^h)/255|0,y=(255^u)*h/255|0;f=t.data[l],p=e.data[l],e.data[l]=255^((255^f)*v+(255^p)*y+(255^f)*(255^p)*g/255)/m,f=t.data[l+1],p=e.data[l+1],e.data[l+1]=255^((255^f)*v+(255^p)*y+(255^f)*(255^p)*g/255)/m,f=t.data[l+2],p=e.data[l+2],e.data[l+2]=255^((255^f)*v+(255^p)*y+(255^f)*(255^p)*g/255)/m,e.data[l+r]=m}}},n.lightenOntoOpaqueFusionWithOpaqueLayer=function(t,e,a){for(var n=0|a.getHeight(),i=0|a.getWidth(),s=(t.width-i)*o|0,l=0|t.offsetOfPixel(a.left,a.top),d=0;d<n;d++,l+=s)for(var c=0;c<i;c++,l+=o){var u,h,f;if(u=t.data[l+r]){var p=255^u;h=t.data[l],f=e.data[l],e.data[l]=f>=h?f:(f*p+h*u)/255,h=t.data[l+1],f=e.data[l+1],e.data[l+1]=f>=h?f:(f*p+h*u)/255,h=t.data[l+2],f=e.data[l+2],e.data[l+2]=f>=h?f:(f*p+h*u)/255}}},n.lightenOntoOpaqueFusionWithTransparentLayer=function(t,e,a){for(var n=0|a.getHeight(),i=0|a.getWidth(),s=(t.width-i)*o|0,l=0|t.offsetOfPixel(a.left,a.top),d=0;d<n;d++,l+=s)for(var c=0;c<i;c++,l+=o){var u,h,f;if(u=t.data[l+r]*t.alpha/100|0){var p=255^u;h=t.data[l],f=e.data[l],e.data[l]=f>=h?f:(f*p+h*u)/255,h=t.data[l+1],f=e.data[l+1],e.data[l+1]=f>=h?f:(f*p+h*u)/255,h=t.data[l+2],f=e.data[l+2],e.data[l+2]=f>=h?f:(f*p+h*u)/255}}},n.lightenOntoTransparentFusionWithOpaqueLayer=function(t,e,a){for(var n=0|a.getHeight(),i=0|a.getWidth(),s=(t.width-i)*o|0,l=0|t.offsetOfPixel(a.left,a.top),d=0;d<n;d++,l+=s)for(var c=0;c<i;c++,l+=o){var u,h,f,p;if(u=t.data[l+r]){h=e.data[l+r];var m=u+h-u*h/255|0,g=h*(255^u)/m|0,v=255^g|0,y=u*(255^h)/m|0,E=255^y|0;f=t.data[l],p=e.data[l],e.data[l]=(p>=f?f*y+p*E:p*g+f*v)/255|0,f=t.data[l+1],p=e.data[l+1],e.data[l+1]=(p>=f?f*y+p*E:p*g+f*v)/255|0,f=t.data[l+2],p=e.data[l+2],e.data[l+2]=(p>=f?f*y+p*E:p*g+f*v)/255|0,e.data[l+r]=m}}},n.lightenOntoTransparentFusionWithTransparentLayer=function(t,e,a){for(var n=0|a.getHeight(),i=0|a.getWidth(),s=(t.width-i)*o|0,l=0|t.offsetOfPixel(a.left,a.top),d=0;d<n;d++,l+=s)for(var c=0;c<i;c++,l+=o){var u,h,f,p;if(u=t.data[l+r]*t.alpha/100|0){h=e.data[l+r];var m=u+h-u*h/255|0,g=h*(255^u)/m|0,v=255^g|0,y=u*(255^h)/m|0,E=255^y|0;f=t.data[l],p=e.data[l],e.data[l]=(p>=f?f*y+p*E:p*g+f*v)/255|0,f=t.data[l+1],p=e.data[l+1],e.data[l+1]=(p>=f?f*y+p*E:p*g+f*v)/255|0,f=t.data[l+2],p=e.data[l+2],e.data[l+2]=(p>=f?f*y+p*E:p*g+f*v)/255|0,e.data[l+r]=m}}},n.darkenOntoOpaqueFusionWithOpaqueLayer=function(t,e,a){for(var n=0|a.getHeight(),i=0|a.getWidth(),s=(t.width-i)*o|0,l=0|t.offsetOfPixel(a.left,a.top),d=0;d<n;d++,l+=s)for(var c=0;c<i;c++,l+=o){var u,h,f;if(u=t.data[l+r]){var p=255^u;h=t.data[l],f=e.data[l],e.data[l]=f>=h?(f*p+h*u)/255:f,h=t.data[l+1],f=e.data[l+1],e.data[l+1]=f>=h?(f*p+h*u)/255:f,h=t.data[l+2],f=e.data[l+2],e.data[l+2]=f>=h?(f*p+h*u)/255:f}}},n.darkenOntoOpaqueFusionWithTransparentLayer=function(t,e,a){for(var n=0|a.getHeight(),i=0|a.getWidth(),s=(t.width-i)*o|0,l=0|t.offsetOfPixel(a.left,a.top),d=0;d<n;d++,l+=s)for(var c=0;c<i;c++,l+=o){var u,h,f;if(u=t.data[l+r]*t.alpha/100|0){var p=255^u;h=t.data[l],f=e.data[l],e.data[l]=f>=h?(f*p+h*u)/255:f,h=t.data[l+1],f=e.data[l+1],e.data[l+1]=f>=h?(f*p+h*u)/255:f,h=t.data[l+2],f=e.data[l+2],e.data[l+2]=f>=h?(f*p+h*u)/255:f}}},n.darkenOntoTransparentFusionWithOpaqueLayer=function(t,e,a){for(var n=0|a.getHeight(),i=0|a.getWidth(),s=(t.width-i)*o|0,l=0|t.offsetOfPixel(a.left,a.top),d=0;d<n;d++,l+=s)for(var c=0;c<i;c++,l+=o){var u,h,f,p;if(u=t.data[l+r]){h=e.data[l+r];var m=u+h-u*h/255|0,g=u*(255^h)/m|0,v=255^g|0,y=h*(255^u)/m|0,E=255^y|0;f=t.data[l],p=e.data[l],e.data[l]=(p>=f?p*y+f*E:f*g+p*v)/255|0,f=t.data[l+1],p=e.data[l+1],e.data[l+1]=(p>=f?p*y+f*E:f*g+p*v)/255|0,f=t.data[l+2],p=e.data[l+2],e.data[l+2]=(p>=f?p*y+f*E:f*g+p*v)/255|0,e.data[l+r]=m}}},n.darkenOntoTransparentFusionWithTransparentLayer=function(t,e,a){for(var n=0|a.getHeight(),i=0|a.getWidth(),s=(t.width-i)*o|0,l=0|t.offsetOfPixel(a.left,a.top),d=0;d<n;d++,l+=s)for(var c=0;c<i;c++,l+=o){var u,h,f,p;if(u=t.data[l+r]*t.alpha/100|0){h=e.data[l+r];var m=u+h-u*h/255|0,g=u*(255^h)/m|0,v=255^g|0,y=h*(255^u)/m|0,E=255^y|0;f=t.data[l],p=e.data[l],e.data[l]=(p>=f?p*y+f*E:f*g+p*v)/255|0,f=t.data[l+1],p=e.data[l+1],e.data[l+1]=(p>=f?p*y+f*E:f*g+p*v)/255|0,f=t.data[l+2],p=e.data[l+2],e.data[l+2]=(p>=f?p*y+f*E:f*g+p*v)/255|0,e.data[l+r]=m}}},n.dodgeOntoOpaqueFusionWithOpaqueLayer=function(t,e,a){for(var n=0|a.getHeight(),i=0|a.getWidth(),s=(t.width-i)*o|0,l=0|t.offsetOfPixel(a.left,a.top),d=0;d<n;d++,l+=s)for(var c=0;c<i;c++,l+=o){var u,h,f;if(u=t.data[l+r]){var p=255^u;h=t.data[l],f=e.data[l],e.data[l]=(f*p+u*(255==h?255:Math.min(255,255*f/(255^h)|0)))/255|0,h=t.data[l+1],f=e.data[l+1],e.data[l+1]=(f*p+u*(255==h?255:Math.min(255,255*f/(255^h)|0)))/255|0,h=t.data[l+2],f=e.data[l+2],e.data[l+2]=(f*p+u*(255==h?255:Math.min(255,255*f/(255^h)|0)))/255|0}}},n.dodgeOntoOpaqueFusionWithTransparentLayer=function(t,e,a){for(var n=0|a.getHeight(),i=0|a.getWidth(),s=(t.width-i)*o|0,l=0|t.offsetOfPixel(a.left,a.top),d=0;d<n;d++,l+=s)for(var c=0;c<i;c++,l+=o){var u,h,f;if(u=t.data[l+r]*t.alpha/100|0){var p=255^u;h=t.data[l],f=e.data[l],e.data[l]=(f*p+u*(255==h?255:Math.min(255,255*f/(255^h)|0)))/255|0,h=t.data[l+1],f=e.data[l+1],e.data[l+1]=(f*p+u*(255==h?255:Math.min(255,255*f/(255^h)|0)))/255|0,h=t.data[l+2],f=e.data[l+2],e.data[l+2]=(f*p+u*(255==h?255:Math.min(255,255*f/(255^h)|0)))/255|0}}},n.dodgeOntoTransparentFusionWithOpaqueLayer=function(t,e,a){for(var n=0|a.getHeight(),i=0|a.getWidth(),s=(t.width-i)*o|0,l=0|t.offsetOfPixel(a.left,a.top),d=0;d<n;d++,l+=s)for(var c=0;c<i;c++,l+=o){var u,h,f,p;if(u=t.data[l+r]){h=e.data[l+r];var m=u+h-u*h/255|0,g=u*h/255|0,v=u*(255^h)/255|0,y=(255^u)*h/255|0;f=t.data[l],p=e.data[l],e.data[l]=(f*v+p*y+g*(255==f?255:Math.min(255,255*p/(255^f)|0)))/m|0,f=t.data[l+1],p=e.data[l+1],e.data[l+1]=(f*v+p*y+g*(255==f?255:Math.min(255,255*p/(255^f)|0)))/m|0,f=t.data[l+2],p=e.data[l+2],e.data[l+2]=(f*v+p*y+g*(255==f?255:Math.min(255,255*p/(255^f)|0)))/m|0,e.data[l+r]=m}}},n.dodgeOntoTransparentFusionWithTransparentLayer=function(t,e,a){for(var n=0|a.getHeight(),i=0|a.getWidth(),s=(t.width-i)*o|0,l=0|t.offsetOfPixel(a.left,a.top),d=0;d<n;d++,l+=s)for(var c=0;c<i;c++,l+=o){var u,h,f,p;if(u=t.data[l+r]*t.alpha/100|0){h=e.data[l+r];var m=u+h-u*h/255|0,g=u*h/255|0,v=u*(255^h)/255|0,y=(255^u)*h/255|0;f=t.data[l],p=e.data[l],e.data[l]=(f*v+p*y+g*(255==f?255:Math.min(255,255*p/(255^f)|0)))/m|0,f=t.data[l+1],p=e.data[l+1],e.data[l+1]=(f*v+p*y+g*(255==f?255:Math.min(255,255*p/(255^f)|0)))/m|0,f=t.data[l+2],p=e.data[l+2],e.data[l+2]=(f*v+p*y+g*(255==f?255:Math.min(255,255*p/(255^f)|0)))/m|0,e.data[l+r]=m}}},n.burnOntoOpaqueFusionWithOpaqueLayer=function(t,e,a){for(var n=0|a.getHeight(),i=0|a.getWidth(),s=(t.width-i)*o|0,l=0|t.offsetOfPixel(a.left,a.top),d=0;d<n;d++,l+=s)for(var c=0;c<i;c++,l+=o){var u,h,f;if(u=t.data[l+r]){var p=255^u;h=t.data[l],f=e.data[l],e.data[l]=(f*p+u*(0==h?0:255^Math.min(255,255*(255^f)/h)))/255|0,h=t.data[l+1],f=e.data[l+1],e.data[l+1]=(f*p+u*(0==h?0:255^Math.min(255,255*(255^f)/h)))/255|0,h=t.data[l+2],f=e.data[l+2],e.data[l+2]=(f*p+u*(0==h?0:255^Math.min(255,255*(255^f)/h)))/255|0}}},n.burnOntoOpaqueFusionWithTransparentLayer=function(t,e,a){for(var n=0|a.getHeight(),i=0|a.getWidth(),s=(t.width-i)*o|0,l=0|t.offsetOfPixel(a.left,a.top),d=0;d<n;d++,l+=s)for(var c=0;c<i;c++,l+=o){var u,h,f;if(u=t.data[l+r]*t.alpha/100|0){var p=255^u;h=t.data[l],f=e.data[l],e.data[l]=(f*p+u*(0==h?0:255^Math.min(255,255*(255^f)/h)))/255|0,h=t.data[l+1],f=e.data[l+1],e.data[l+1]=(f*p+u*(0==h?0:255^Math.min(255,255*(255^f)/h)))/255|0,h=t.data[l+2],f=e.data[l+2],e.data[l+2]=(f*p+u*(0==h?0:255^Math.min(255,255*(255^f)/h)))/255|0}}},n.burnOntoTransparentFusionWithOpaqueLayer=function(t,e,a){for(var n=0|a.getHeight(),i=0|a.getWidth(),s=(t.width-i)*o|0,l=0|t.offsetOfPixel(a.left,a.top),d=0;d<n;d++,l+=s)for(var c=0;c<i;c++,l+=o){
var u,h,f,p;if(u=t.data[l+r]){h=e.data[l+r];var m=u+h-u*h/255|0,g=u*h/255|0,v=u*(255^h)/255|0,y=(255^u)*h/255|0;f=t.data[l],p=e.data[l],e.data[l]=(f*v+p*y+g*(0==f?0:255^Math.min(255,255*(255^p)/f)))/m|0,f=t.data[l+1],p=e.data[l+1],e.data[l+1]=(f*v+p*y+g*(0==f?0:255^Math.min(255,255*(255^p)/f)))/m|0,f=t.data[l+2],p=e.data[l+2],e.data[l+2]=(f*v+p*y+g*(0==f?0:255^Math.min(255,255*(255^p)/f)))/m|0,e.data[l+r]=m}}},n.burnOntoTransparentFusionWithTransparentLayer=function(t,e,a){for(var n=0|a.getHeight(),i=0|a.getWidth(),s=(t.width-i)*o|0,l=0|t.offsetOfPixel(a.left,a.top),d=0;d<n;d++,l+=s)for(var c=0;c<i;c++,l+=o){var u,h,f,p;if(u=t.data[l+r]*t.alpha/100|0){h=e.data[l+r];var m=u+h-u*h/255|0,g=u*h/255|0,v=u*(255^h)/255|0,y=(255^u)*h/255|0;f=t.data[l],p=e.data[l],e.data[l]=(f*v+p*y+g*(0==f?0:255^Math.min(255,255*(255^p)/f)))/m|0,f=t.data[l+1],p=e.data[l+1],e.data[l+1]=(f*v+p*y+g*(0==f?0:255^Math.min(255,255*(255^p)/f)))/m|0,f=t.data[l+2],p=e.data[l+2],e.data[l+2]=(f*v+p*y+g*(0==f?0:255^Math.min(255,255*(255^p)/f)))/m|0,e.data[l+r]=m}}},n.overlayOntoOpaqueFusionWithOpaqueLayer=function(t,e,a){for(var n=0|a.getHeight(),i=0|a.getWidth(),s=(t.width-i)*o|0,l=0|t.offsetOfPixel(a.left,a.top),d=0;d<n;d++,l+=s)for(var c=0;c<i;c++,l+=o){var u,h,f;if(u=t.data[l+r]){var p=255^u;h=t.data[l],f=e.data[l],e.data[l]=(p*f+(f<=127?2*u*h*f/255:u*(2*(255^h)*(255^f)/255^255)))/255|0,h=t.data[l+1],f=e.data[l+1],e.data[l+1]=(p*f+(f<=127?2*u*h*f/255:u*(2*(255^h)*(255^f)/255^255)))/255|0,h=t.data[l+2],f=e.data[l+2],e.data[l+2]=(p*f+(f<=127?2*u*h*f/255:u*(2*(255^h)*(255^f)/255^255)))/255|0}}},n.overlayOntoOpaqueFusionWithTransparentLayer=function(t,e,a){for(var n=0|a.getHeight(),i=0|a.getWidth(),s=(t.width-i)*o|0,l=0|t.offsetOfPixel(a.left,a.top),d=0;d<n;d++,l+=s)for(var c=0;c<i;c++,l+=o){var u,h,f;if(u=t.data[l+r]*t.alpha/100|0){var p=255^u;h=t.data[l],f=e.data[l],e.data[l]=(p*f+(f<=127?2*u*h*f/255:u*(2*(255^h)*(255^f)/255^255)))/255|0,h=t.data[l+1],f=e.data[l+1],e.data[l+1]=(p*f+(f<=127?2*u*h*f/255:u*(2*(255^h)*(255^f)/255^255)))/255|0,h=t.data[l+2],f=e.data[l+2],e.data[l+2]=(p*f+(f<=127?2*u*h*f/255:u*(2*(255^h)*(255^f)/255^255)))/255|0}}},n.overlayOntoTransparentFusionWithOpaqueLayer=function(t,e,a){for(var n=0|a.getHeight(),i=0|a.getWidth(),s=(t.width-i)*o|0,l=0|t.offsetOfPixel(a.left,a.top),d=0;d<n;d++,l+=s)for(var c=0;c<i;c++,l+=o){var u,h,f,p;if(u=t.data[l+r]){h=e.data[l+r];var m=u+h-u*h/255|0,g=u*h/255|0,v=u*(255^h)/255|0,y=(255^u)*h/255|0;f=t.data[l],p=e.data[l],e.data[l]=(v*f+y*p+(p<=127?2*g*f*p/255:g*(2*(255^f)*(255^p)/255^255)))/m|0,f=t.data[l+1],p=e.data[l+1],e.data[l+1]=(v*f+y*p+(p<=127?2*g*f*p/255:g*(2*(255^f)*(255^p)/255^255)))/m|0,f=t.data[l+2],p=e.data[l+2],e.data[l+2]=(v*f+y*p+(p<=127?2*g*f*p/255:g*(2*(255^f)*(255^p)/255^255)))/m|0,e.data[l+r]=m}}},n.overlayOntoTransparentFusionWithTransparentLayer=function(t,e,a){for(var n=0|a.getHeight(),i=0|a.getWidth(),s=(t.width-i)*o|0,l=0|t.offsetOfPixel(a.left,a.top),d=0;d<n;d++,l+=s)for(var c=0;c<i;c++,l+=o){var u,h,f,p;if(u=t.data[l+r]*t.alpha/100|0){h=e.data[l+r];var m=u+h-u*h/255|0,g=u*h/255|0,v=u*(255^h)/255|0,y=(255^u)*h/255|0;f=t.data[l],p=e.data[l],e.data[l]=(v*f+y*p+(p<=127?2*g*f*p/255:g*(2*(255^f)*(255^p)/255^255)))/m|0,f=t.data[l+1],p=e.data[l+1],e.data[l+1]=(v*f+y*p+(p<=127?2*g*f*p/255:g*(2*(255^f)*(255^p)/255^255)))/m|0,f=t.data[l+2],p=e.data[l+2],e.data[l+2]=(v*f+y*p+(p<=127?2*g*f*p/255:g*(2*(255^f)*(255^p)/255^255)))/m|0,e.data[l+r]=m}}},n.hardLightOntoOpaqueFusionWithOpaqueLayer=function(t,e,a){for(var n=0|a.getHeight(),i=0|a.getWidth(),s=(t.width-i)*o|0,l=0|t.offsetOfPixel(a.left,a.top),d=0;d<n;d++,l+=s)for(var c=0;c<i;c++,l+=o){var u,h,f;if(u=t.data[l+r]){var p=255^u;h=t.data[l],f=e.data[l],e.data[l]=(p*f+(h<=127?2*u*h*f/255:u*(2*(255^h)*(255^f)/255^255)))/255|0,h=t.data[l+1],f=e.data[l+1],e.data[l+1]=(p*f+(h<=127?2*u*h*f/255:u*(2*(255^h)*(255^f)/255^255)))/255|0,h=t.data[l+2],f=e.data[l+2],e.data[l+2]=(p*f+(h<=127?2*u*h*f/255:u*(2*(255^h)*(255^f)/255^255)))/255|0}}},n.hardLightOntoOpaqueFusionWithTransparentLayer=function(t,e,a){for(var n=0|a.getHeight(),i=0|a.getWidth(),s=(t.width-i)*o|0,l=0|t.offsetOfPixel(a.left,a.top),d=0;d<n;d++,l+=s)for(var c=0;c<i;c++,l+=o){var u,h,f;if(u=t.data[l+r]*t.alpha/100|0){var p=255^u;h=t.data[l],f=e.data[l],e.data[l]=(p*f+(h<=127?2*u*h*f/255:u*(2*(255^h)*(255^f)/255^255)))/255|0,h=t.data[l+1],f=e.data[l+1],e.data[l+1]=(p*f+(h<=127?2*u*h*f/255:u*(2*(255^h)*(255^f)/255^255)))/255|0,h=t.data[l+2],f=e.data[l+2],e.data[l+2]=(p*f+(h<=127?2*u*h*f/255:u*(2*(255^h)*(255^f)/255^255)))/255|0}}},n.hardLightOntoTransparentFusionWithOpaqueLayer=function(t,e,a){for(var n=0|a.getHeight(),i=0|a.getWidth(),s=(t.width-i)*o|0,l=0|t.offsetOfPixel(a.left,a.top),d=0;d<n;d++,l+=s)for(var c=0;c<i;c++,l+=o){var u,h,f,p;if(u=t.data[l+r]){h=e.data[l+r];var m=u+h-u*h/255|0,g=u*h/255|0,v=u*(255^h)/255|0,y=(255^u)*h/255|0;f=t.data[l],p=e.data[l],e.data[l]=(v*f+y*p+(f<=127?2*g*f*p/255:g*(2*(255^f)*(255^p)/255^255)))/m|0,f=t.data[l+1],p=e.data[l+1],e.data[l+1]=(v*f+y*p+(f<=127?2*g*f*p/255:g*(2*(255^f)*(255^p)/255^255)))/m|0,f=t.data[l+2],p=e.data[l+2],e.data[l+2]=(v*f+y*p+(f<=127?2*g*f*p/255:g*(2*(255^f)*(255^p)/255^255)))/m|0,e.data[l+r]=m}}},n.hardLightOntoTransparentFusionWithTransparentLayer=function(t,e,a){for(var n=0|a.getHeight(),i=0|a.getWidth(),s=(t.width-i)*o|0,l=0|t.offsetOfPixel(a.left,a.top),d=0;d<n;d++,l+=s)for(var c=0;c<i;c++,l+=o){var u,h,f,p;if(u=t.data[l+r]*t.alpha/100|0){h=e.data[l+r];var m=u+h-u*h/255|0,g=u*h/255|0,v=u*(255^h)/255|0,y=(255^u)*h/255|0;f=t.data[l],p=e.data[l],e.data[l]=(v*f+y*p+(f<=127?2*g*f*p/255:g*(2*(255^f)*(255^p)/255^255)))/m|0,f=t.data[l+1],p=e.data[l+1],e.data[l+1]=(v*f+y*p+(f<=127?2*g*f*p/255:g*(2*(255^f)*(255^p)/255^255)))/m|0,f=t.data[l+2],p=e.data[l+2],e.data[l+2]=(v*f+y*p+(f<=127?2*g*f*p/255:g*(2*(255^f)*(255^p)/255^255)))/m|0,e.data[l+r]=m}}},n.softLightOntoOpaqueFusionWithOpaqueLayer=function(t,e,a){for(var n=0|a.getHeight(),i=0|a.getWidth(),s=(t.width-i)*o|0,c=0|t.offsetOfPixel(a.left,a.top),u=0;u<n;u++,c+=s)for(var h=0;h<i;h++,c+=o){var f,p,m;if(f=t.data[c+r]){var g=255^f;p=t.data[c],m=e.data[c],e.data[c]=(g*m+f*(p<=127?(2*p-255)*l[m]/255+m:(2*p-255)*d[m]/255+m))/255|0,p=t.data[c+1],m=e.data[c+1],e.data[c+1]=(g*m+f*(p<=127?(2*p-255)*l[m]/255+m:(2*p-255)*d[m]/255+m))/255|0,p=t.data[c+2],m=e.data[c+2],e.data[c+2]=(g*m+f*(p<=127?(2*p-255)*l[m]/255+m:(2*p-255)*d[m]/255+m))/255|0}}},n.softLightOntoOpaqueFusionWithTransparentLayer=function(t,e,a){for(var n=0|a.getHeight(),i=0|a.getWidth(),s=(t.width-i)*o|0,c=0|t.offsetOfPixel(a.left,a.top),u=0;u<n;u++,c+=s)for(var h=0;h<i;h++,c+=o){var f,p,m;if(f=t.data[c+r]*t.alpha/100|0){var g=255^f;p=t.data[c],m=e.data[c],e.data[c]=(g*m+f*(p<=127?(2*p-255)*l[m]/255+m:(2*p-255)*d[m]/255+m))/255|0,p=t.data[c+1],m=e.data[c+1],e.data[c+1]=(g*m+f*(p<=127?(2*p-255)*l[m]/255+m:(2*p-255)*d[m]/255+m))/255|0,p=t.data[c+2],m=e.data[c+2],e.data[c+2]=(g*m+f*(p<=127?(2*p-255)*l[m]/255+m:(2*p-255)*d[m]/255+m))/255|0}}},n.softLightOntoTransparentFusionWithOpaqueLayer=function(t,e,a){for(var n=0|a.getHeight(),i=0|a.getWidth(),s=(t.width-i)*o|0,c=0|t.offsetOfPixel(a.left,a.top),u=0;u<n;u++,c+=s)for(var h=0;h<i;h++,c+=o){var f,p,m,g;if(f=t.data[c+r]){p=e.data[c+r];var v=f+p-f*p/255|0,y=f*p/255|0,E=f*(255^p)/255|0,w=(255^f)*p/255|0;m=t.data[c],g=e.data[c],e.data[c]=(E*m+w*g+(m<=127?y*((2*m-255)*l[g]/255+g):y*((2*m-255)*d[g]/255+g)))/v|0,m=t.data[c+1],g=e.data[c+1],e.data[c+1]=(E*m+w*g+(m<=127?y*((2*m-255)*l[g]/255+g):y*((2*m-255)*d[g]/255+g)))/v|0,m=t.data[c+2],g=e.data[c+2],e.data[c+2]=(E*m+w*g+(m<=127?y*((2*m-255)*l[g]/255+g):y*((2*m-255)*d[g]/255+g)))/v|0,e.data[c+r]=v}}},n.softLightOntoTransparentFusionWithTransparentLayer=function(t,e,a){for(var n=0|a.getHeight(),i=0|a.getWidth(),s=(t.width-i)*o|0,c=0|t.offsetOfPixel(a.left,a.top),u=0;u<n;u++,c+=s)for(var h=0;h<i;h++,c+=o){var f,p,m,g;if(f=t.data[c+r]*t.alpha/100|0){p=e.data[c+r];var v=f+p-f*p/255|0,y=f*p/255|0,E=f*(255^p)/255|0,w=(255^f)*p/255|0;m=t.data[c],g=e.data[c],e.data[c]=(E*m+w*g+(m<=127?y*((2*m-255)*l[g]/255+g):y*((2*m-255)*d[g]/255+g)))/v|0,m=t.data[c+1],g=e.data[c+1],e.data[c+1]=(E*m+w*g+(m<=127?y*((2*m-255)*l[g]/255+g):y*((2*m-255)*d[g]/255+g)))/v|0,m=t.data[c+2],g=e.data[c+2],e.data[c+2]=(E*m+w*g+(m<=127?y*((2*m-255)*l[g]/255+g):y*((2*m-255)*d[g]/255+g)))/v|0,e.data[c+r]=v}}},n.vividLightOntoOpaqueFusionWithOpaqueLayer=function(t,e,a){for(var n=0|a.getHeight(),i=0|a.getWidth(),s=(t.width-i)*o|0,l=0|t.offsetOfPixel(a.left,a.top),d=0;d<n;d++,l+=s)for(var c=0;c<i;c++,l+=o){var u,h,f;if(u=t.data[l+r]){var p=255^u;h=t.data[l],f=e.data[l],e.data[l]=(p*f+(h<=127?u*(0==h?0:255-Math.min(255,255*(255-f)/(2*h))):u*(255==h?255:Math.min(255,255*f/(2*(255-h))))))/255|0,h=t.data[l+1],f=e.data[l+1],e.data[l+1]=(p*f+(h<=127?u*(0==h?0:255-Math.min(255,255*(255-f)/(2*h))):u*(255==h?255:Math.min(255,255*f/(2*(255-h))))))/255|0,h=t.data[l+2],f=e.data[l+2],e.data[l+2]=(p*f+(h<=127?u*(0==h?0:255-Math.min(255,255*(255-f)/(2*h))):u*(255==h?255:Math.min(255,255*f/(2*(255-h))))))/255|0}}},n.vividLightOntoOpaqueFusionWithTransparentLayer=function(t,e,a){for(var n=0|a.getHeight(),i=0|a.getWidth(),s=(t.width-i)*o|0,l=0|t.offsetOfPixel(a.left,a.top),d=0;d<n;d++,l+=s)for(var c=0;c<i;c++,l+=o){var u,h,f;if(u=t.data[l+r]*t.alpha/100|0){var p=255^u;h=t.data[l],f=e.data[l],e.data[l]=(p*f+(h<=127?u*(0==h?0:255-Math.min(255,255*(255-f)/(2*h))):u*(255==h?255:Math.min(255,255*f/(2*(255-h))))))/255|0,h=t.data[l+1],f=e.data[l+1],e.data[l+1]=(p*f+(h<=127?u*(0==h?0:255-Math.min(255,255*(255-f)/(2*h))):u*(255==h?255:Math.min(255,255*f/(2*(255-h))))))/255|0,h=t.data[l+2],f=e.data[l+2],e.data[l+2]=(p*f+(h<=127?u*(0==h?0:255-Math.min(255,255*(255-f)/(2*h))):u*(255==h?255:Math.min(255,255*f/(2*(255-h))))))/255|0}}},n.vividLightOntoTransparentFusionWithOpaqueLayer=function(t,e,a){for(var n=0|a.getHeight(),i=0|a.getWidth(),s=(t.width-i)*o|0,l=0|t.offsetOfPixel(a.left,a.top),d=0;d<n;d++,l+=s)for(var c=0;c<i;c++,l+=o){var u,h,f,p;if(u=t.data[l+r]){h=e.data[l+r];var m=u+h-u*h/255|0,g=u*h/255|0,v=u*(255^h)/255|0,y=(255^u)*h/255|0;f=t.data[l],p=e.data[l],e.data[l]=(v*f+y*p+(f<=127?g*(0==f?0:255-Math.min(255,255*(255-p)/(2*f))):g*(255==f?255:Math.min(255,255*p/(2*(255-f))))))/m|0,f=t.data[l+1],p=e.data[l+1],e.data[l+1]=(v*f+y*p+(f<=127?g*(0==f?0:255-Math.min(255,255*(255-p)/(2*f))):g*(255==f?255:Math.min(255,255*p/(2*(255-f))))))/m|0,f=t.data[l+2],p=e.data[l+2],e.data[l+2]=(v*f+y*p+(f<=127?g*(0==f?0:255-Math.min(255,255*(255-p)/(2*f))):g*(255==f?255:Math.min(255,255*p/(2*(255-f))))))/m|0,e.data[l+r]=m}}},n.vividLightOntoTransparentFusionWithTransparentLayer=function(t,e,a){for(var n=0|a.getHeight(),i=0|a.getWidth(),s=(t.width-i)*o|0,l=0|t.offsetOfPixel(a.left,a.top),d=0;d<n;d++,l+=s)for(var c=0;c<i;c++,l+=o){var u,h,f,p;if(u=t.data[l+r]*t.alpha/100|0){h=e.data[l+r];var m=u+h-u*h/255|0,g=u*h/255|0,v=u*(255^h)/255|0,y=(255^u)*h/255|0;f=t.data[l],p=e.data[l],e.data[l]=(v*f+y*p+(f<=127?g*(0==f?0:255-Math.min(255,255*(255-p)/(2*f))):g*(255==f?255:Math.min(255,255*p/(2*(255-f))))))/m|0,f=t.data[l+1],p=e.data[l+1],e.data[l+1]=(v*f+y*p+(f<=127?g*(0==f?0:255-Math.min(255,255*(255-p)/(2*f))):g*(255==f?255:Math.min(255,255*p/(2*(255-f))))))/m|0,f=t.data[l+2],p=e.data[l+2],e.data[l+2]=(v*f+y*p+(f<=127?g*(0==f?0:255-Math.min(255,255*(255-p)/(2*f))):g*(255==f?255:Math.min(255,255*p/(2*(255-f))))))/m|0,e.data[l+r]=m}}},n.linearLightOntoOpaqueFusionWithOpaqueLayer=function(t,e,a){for(var n=0|a.getHeight(),i=0|a.getWidth(),s=(t.width-i)*o|0,l=0|t.offsetOfPixel(a.left,a.top),d=0;d<n;d++,l+=s)for(var c=0;c<i;c++,l+=o){var u,h;if(u=t.data[l+r]){var f=255^u;h=e.data[l],e.data[l]=(f*h+u*Math.min(255,Math.max(0,h+2*t.data[l]-255)))/255|0,h=e.data[l+1],e.data[l+1]=(f*h+u*Math.min(255,Math.max(0,h+2*t.data[l+1]-255)))/255|0,h=e.data[l+2],e.data[l+2]=(f*h+u*Math.min(255,Math.max(0,h+2*t.data[l+2]-255)))/255|0}}},n.linearLightOntoOpaqueFusionWithTransparentLayer=function(t,e,a){for(var n=0|a.getHeight(),i=0|a.getWidth(),s=(t.width-i)*o|0,l=0|t.offsetOfPixel(a.left,a.top),d=0;d<n;d++,l+=s)for(var c=0;c<i;c++,l+=o){var u,h;if(u=t.data[l+r]*t.alpha/100|0){var f=255^u;h=e.data[l],e.data[l]=(f*h+u*Math.min(255,Math.max(0,h+2*t.data[l]-255)))/255|0,h=e.data[l+1],e.data[l+1]=(f*h+u*Math.min(255,Math.max(0,h+2*t.data[l+1]-255)))/255|0,h=e.data[l+2],e.data[l+2]=(f*h+u*Math.min(255,Math.max(0,h+2*t.data[l+2]-255)))/255|0}}},n.linearLightOntoTransparentFusionWithOpaqueLayer=function(t,e,a){for(var n=0|a.getHeight(),i=0|a.getWidth(),s=(t.width-i)*o|0,l=0|t.offsetOfPixel(a.left,a.top),d=0;d<n;d++,l+=s)for(var c=0;c<i;c++,l+=o){var u,h,f,p;if(u=t.data[l+r]){h=e.data[l+r];var m=u+h-u*h/255|0,g=u*h/255|0,v=u*(255^h)/255|0,y=(255^u)*h/255|0;f=t.data[l],p=e.data[l],e.data[l]=(v*f+y*p+g*Math.min(255,Math.max(0,p+2*f-255)))/m|0,f=t.data[l+1],p=e.data[l+1],e.data[l+1]=(v*f+y*p+g*Math.min(255,Math.max(0,p+2*f-255)))/m|0,f=t.data[l+2],p=e.data[l+2],e.data[l+2]=(v*f+y*p+g*Math.min(255,Math.max(0,p+2*f-255)))/m|0,e.data[l+r]=m}}},n.linearLightOntoTransparentFusionWithTransparentLayer=function(t,e,a){for(var n=0|a.getHeight(),i=0|a.getWidth(),s=(t.width-i)*o|0,l=0|t.offsetOfPixel(a.left,a.top),d=0;d<n;d++,l+=s)for(var c=0;c<i;c++,l+=o){var u,h,f,p;if(u=t.data[l+r]*t.alpha/100|0){h=e.data[l+r];var m=u+h-u*h/255|0,g=u*h/255|0,v=u*(255^h)/255|0,y=(255^u)*h/255|0;f=t.data[l],p=e.data[l],e.data[l]=(v*f+y*p+g*Math.min(255,Math.max(0,p+2*f-255)))/m|0,f=t.data[l+1],p=e.data[l+1],e.data[l+1]=(v*f+y*p+g*Math.min(255,Math.max(0,p+2*f-255)))/m|0,f=t.data[l+2],p=e.data[l+2],e.data[l+2]=(v*f+y*p+g*Math.min(255,Math.max(0,p+2*f-255)))/m|0,e.data[l+r]=m}}},n.pinLightOntoOpaqueFusionWithOpaqueLayer=function(t,e,a){for(var n=0|a.getHeight(),i=0|a.getWidth(),s=(t.width-i)*o|0,l=0|t.offsetOfPixel(a.left,a.top),d=0;d<n;d++,l+=s)for(var c=0;c<i;c++,l+=o){var u,h,f;if(u=t.data[l+r]){var p=255^u;h=t.data[l],f=e.data[l],e.data[l]=(p*f+u*(f>=2*h?2*h:f<=2*h-255?2*h-255:f))/255|0,h=t.data[l+1],f=e.data[l+1],e.data[l+1]=(p*f+u*(f>=2*h?2*h:f<=2*h-255?2*h-255:f))/255|0,h=t.data[l+2],f=e.data[l+2],e.data[l+2]=(p*f+u*(f>=2*h?2*h:f<=2*h-255?2*h-255:f))/255|0}}},n.pinLightOntoOpaqueFusionWithTransparentLayer=function(t,e,a){for(var n=0|a.getHeight(),i=0|a.getWidth(),s=(t.width-i)*o|0,l=0|t.offsetOfPixel(a.left,a.top),d=0;d<n;d++,l+=s)for(var c=0;c<i;c++,l+=o){var u,h,f;if(u=t.data[l+r]*t.alpha/100|0){var p=255^u;h=t.data[l],f=e.data[l],e.data[l]=(p*f+u*(f>=2*h?2*h:f<=2*h-255?2*h-255:f))/255|0,h=t.data[l+1],f=e.data[l+1],e.data[l+1]=(p*f+u*(f>=2*h?2*h:f<=2*h-255?2*h-255:f))/255|0,h=t.data[l+2],f=e.data[l+2],e.data[l+2]=(p*f+u*(f>=2*h?2*h:f<=2*h-255?2*h-255:f))/255|0}}},n.pinLightOntoTransparentFusionWithOpaqueLayer=function(t,e,a){for(var n=0|a.getHeight(),i=0|a.getWidth(),s=(t.width-i)*o|0,l=0|t.offsetOfPixel(a.left,a.top),d=0;d<n;d++,l+=s)for(var c=0;c<i;c++,l+=o){var u,h,f,p;if(u=t.data[l+r]){h=e.data[l+r];var m=u+h-u*h/255|0,g=u*h/255|0,v=u*(255^h)/255|0,y=(255^u)*h/255|0;f=t.data[l],p=e.data[l],e.data[l]=(v*f+y*p+g*(p>=2*f?2*f:p<=2*f-255?2*f-255:p))/m|0,f=t.data[l+1],p=e.data[l+1],e.data[l+1]=(v*f+y*p+g*(p>=2*f?2*f:p<=2*f-255?2*f-255:p))/m|0,f=t.data[l+2],p=e.data[l+2],e.data[l+2]=(v*f+y*p+g*(p>=2*f?2*f:p<=2*f-255?2*f-255:p))/m|0,e.data[l+r]=m}}},n.pinLightOntoTransparentFusionWithTransparentLayer=function(t,e,a){for(var n=0|a.getHeight(),i=0|a.getWidth(),s=(t.width-i)*o|0,l=0|t.offsetOfPixel(a.left,a.top),d=0;d<n;d++,l+=s)for(var c=0;c<i;c++,l+=o){var u,h,f,p;if(u=t.data[l+r]*t.alpha/100|0){h=e.data[l+r];var m=u+h-u*h/255|0,g=u*h/255|0,v=u*(255^h)/255|0,y=(255^u)*h/255|0;f=t.data[l],p=e.data[l],e.data[l]=(v*f+y*p+g*(p>=2*f?2*f:p<=2*f-255?2*f-255:p))/m|0,f=t.data[l+1],p=e.data[l+1],e.data[l+1]=(v*f+y*p+g*(p>=2*f?2*f:p<=2*f-255?2*f-255:p))/m|0,f=t.data[l+2],p=e.data[l+2],e.data[l+2]=(v*f+y*p+g*(p>=2*f?2*f:p<=2*f-255?2*f-255:p))/m|0,e.data[l+r]=m}}},n.LM_NORMAL=0,n.LM_MULTIPLY=1,n.LM_ADD=2,n.LM_SCREEN=3,n.LM_LIGHTEN=4,n.LM_DARKEN=5,n.LM_SUBTRACT=6,n.LM_DODGE=7,n.LM_BURN=8,n.LM_OVERLAY=9,n.LM_HARDLIGHT=10,n.LM_SOFTLIGHT=11,n.LM_VIVIDLIGHT=12,n.LM_LINEARLIGHT=13,n.LM_PINLIGHT=14,n.fuseLayer=function(t,e,a,n){if(!(a.alpha<=0)){var i=s[a.blendMode]+"Onto";if(t.alpha<100)throw"Fusion layer alpha < 100 not supported.";i+=e?"TransparentFusion":"OpaqueFusion",i+=100==a.alpha?"WithOpaqueLayer":"WithTransparentLayer",t.getBounds().clip(n),this[i](a,t,n)}},i(),e.exports=a.default},{}],5:[function(t,e,a){"use strict";function n(t){for(var e in n.DEFAULTS)n.DEFAULTS.hasOwnProperty(e)&&(this[e]=n.DEFAULTS[e]);for(var e in t)t.hasOwnProperty(e)&&(this[e]=t[e])}Object.defineProperty(a,"__esModule",{value:!0}),a.default=n,n.SM_FREEHAND=0,n.SM_LINE=1,n.SM_BEZIER=2,n.B_ROUND_PIXEL=0,n.B_ROUND_AA=1,n.B_ROUND_AIRBRUSH=2,n.B_SQUARE_PIXEL=3,n.B_SQUARE_AA=4,n.M_PAINT=0,n.M_ERASE=1,n.M_DODGE=2,n.M_BURN=3,n.M_WATER=4,n.M_BLUR=5,n.M_SMUDGE=6,n.M_OIL=7,n.DEFAULTS={isAA:!1,isAirbrush:!1,minSpacing:0,spacing:0,pressureSize:!0,pressureAlpha:!1,pressureScattering:!1,type:0,paintMode:0,strokeMode:n.SM_FREEHAND,resat:1,bleed:0,texture:1,size:0,curSize:0,alpha:0,curAlpha:0,scattering:0,curScattering:0,squeeze:0,curSqueeze:0,angle:Math.PI,curAngle:0,smoothing:0},n.prototype.applyPressure=function(t){this.pressureSize&&this.paintMode!=n.M_SMUDGE&&this.paintMode!=n.M_OIL?this.curSize=Math.max(.1,this.size*t):this.curSize=Math.max(.1,this.size),this.curSize>16&&(this.curSize=Math.floor(this.curSize)),this.curAlpha=this.pressureAlpha?Math.floor(this.alpha*Math.min(t,1)):this.alpha,this.curSqueeze=this.squeeze,this.curAngle=this.angle,this.curScattering=this.scattering*this.curSize*(this.pressureScattering?t:1)},n.prototype.clone=function(){return new n(this)},e.exports=a.default},{}],6:[function(t,e,a){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function i(){function t(t,e,a){for(var n=s(t),i=Math.ceil(t.curSize),o=Math.ceil(t.curSize)+1,r=0;r<o*o;r++)v[r]=0;for(var l=(1-e)*(1-a),d=e*(1-a),c=e*a,u=(1-e)*a,h=0,f=0,p=0;p<i;p++){for(var r=0;r<i;r++){var m=n[h];v[f]+=~~(m*l),v[f+1]+=~~(m*d),v[f+1+o]+=~~(m*c),v[f+o]+=~~(m*u),h++,f++}f+=o-i}return v}function e(t,e){for(var a=Math.ceil(e.curSize),n=a/2,i=e.curSize/2*(e.curSize/2),o=1+e.curSqueeze*f,r=Math.cos(e.curAngle),s=Math.sin(e.curAngle),l=0,d=0;d<a;d++)for(var c=0;c<a;c++){var u=c+.5-n,h=d+.5-n,p=(u*r-h*s)*o,m=h*r+u*s,g=p*p+m*m;g<=i?t[l++]=255:t[l++]=0}return t}function a(t,e){for(var a=Math.ceil(e.curSize),n=a/2,i=e.curSize/2*(e.curSize/2),o=(e.curSize-2)/2*((e.curSize-2)/2),r=(e.curSize+2)/2*((e.curSize+2)/2),s=1+e.curSqueeze*f,l=Math.cos(e.curAngle),d=Math.sin(e.curAngle),c=0,u=0;u<a;u++)for(var h=0;h<a;h++){var p=h+.5-n,m=u+.5-n,g=(p*l-m*d)*s,v=m*l+p*d,y=g*g+v*v;if(y<=o)t[c++]=255;else if(y>r)t[c++]=0;else{for(var E=0,w=0;w<4;w++)for(var P=0;P<4;P++)p=h+.25*P-n,m=u+.25*w-n,g=(p*l-m*d)*s,v=m*l+p*d,y=g*g+v*v,y<=i&&(E+=1);t[c++]=Math.min(16*E,255)}}return t}function n(t,e){for(var a=Math.ceil(e.curSize),n=a/2,i=e.curSize*Math.sin(Math.PI/4),o=i/2/(1+e.curSqueeze*f),r=i/2,s=Math.cos(e.curAngle),l=Math.sin(e.curAngle),d=0,c=0;c<a;c++)for(var u=0;u<a;u++){var h=u+.5-n,p=c+.5-n,m=Math.abs(h*s-p*l),g=Math.abs(p*s+h*l);m<=o&&g<=r?t[d++]=255:t[d++]=0}return t}function i(t,e){for(var a=Math.ceil(e.curSize),n=a/2,i=e.curSize*Math.sin(Math.PI/4),o=i/2/(1+e.curSqueeze*f),r=i/2,s=o-1,l=r-1,d=o+1,c=r+1,u=Math.cos(e.curAngle),h=Math.sin(e.curAngle),p=0,m=0;m<a;m++)for(var g=0;g<a;g++){var v=g+.5-n,y=m+.5-n,E=Math.abs(v*u-y*h),w=Math.abs(y*u+v*h);if(E<=s&&w<=l)t[p++]=255;else if(E>d||w>c)t[p++]=0;else{for(var P=0,b=0;b<4;b++)for(var C=0;C<4;C++)v=g+.25*C-n,y=m+.25*b-n,E=Math.abs(v*u-y*h),w=Math.abs(y*u+v*h),E<=o&&w<=r&&P++;t[p++]=Math.min(16*P,255)}}return t}function o(t,e){for(var a=Math.ceil(e.curSize),n=a/2,i=e.curSize/2*(e.curSize/2),o=1+e.curSqueeze*f,r=Math.cos(e.curAngle),s=Math.sin(e.curAngle),l=0,d=0;d<a;d++)for(var c=0;c<a;c++){var u=c+.5-n,h=d+.5-n,p=(u*r-h*s)*o,m=h*r+u*s,g=p*p+m*m;g<=i?t[l++]=~~(255*(1-g/i)):t[l++]=0}return t}function s(t){if(null!=y&&t.curSize==d&&t.curSqueeze==c&&t.curAngle==u&&t.type==h)return y;switch(t.type){case r.default.B_ROUND_AIRBRUSH:g=o(g,t);break;case r.default.B_ROUND_AA:g=a(g,t);break;case r.default.B_ROUND_PIXEL:g=e(g,t);break;case r.default.B_SQUARE_AA:g=i(g,t);break;case r.default.B_SQUARE_PIXEL:g=n(g,t)}return y=g,d=t.curSize,h=t.type,c=t.curSqueeze,u=t.curAngle,g}function l(t,e){var a,n,i=Math.floor(255*e),o=E.texture,r=t.x%o.width,s=t.y%o.height,l=0;r<0&&(r+=o.width),s<0&&(s+=o.height);for(var d=0;d<t.height;d++){a=s*o.width+r,n=s*o.width+o.width;for(var c=0;c<t.width;c++){var u=t.brush[l],h=o.data[a];t.brush[l]=~~(u*(h*i/255^255)/255),l++,a++,a==n&&(a-=o.width)}s++,s==o.height&&(s=0)}}var d,c,u,h,f=10,p=201,m=202,g=new Uint8Array(p*p),v=new Uint8Array(m*m),y=null,E=this;this.getDab=function(e,a,n){var i={alpha:n.curAlpha,width:Math.ceil(n.curSize),height:Math.ceil(n.curSize)},o=n.isAA&&n.type!=r.default.B_ROUND_PIXEL;o&&(i.width++,i.height++);var d=e-i.width/2+.5,c=a-i.height/2+.5;if(d<0&&(d-=1),c<0&&(c-=1),o){var u=Math.abs(d-~~d),h=Math.abs(c-~~c);i.brush=t(n,u,h)}else i.brush=s(n);return i.x=~~d,i.y=~~c,n.texture>0&&null!=this.texture&&(i.brush==g&&(v.set(g),i.brush=v),l(i,n.texture)),i},this.setTexture=function(t){this.texture=t}}Object.defineProperty(a,"__esModule",{value:!0}),a.default=i;var o=t("./CPBrushInfo"),r=n(o);e.exports=a.default},{"./CPBrushInfo":5}],7:[function(t,e,a){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function i(){function t(t,e){this.version=t.readU32BE(),this.width=t.readU32BE(),this.height=t.readU32BE(),this.layersNb=t.readU32BE()}function e(t){for(var e=new Array(4),a=0;a<e.length;a++)e[a]=String.fromCharCode(t.readByte());if(this.chunkType=e.join(""),this.chunkSize=t.readU32BE(),t.eof)throw"Truncated chunk"}function a(){var t,e;this.readFixedHeader=function(a){t=a.readU32BE(),this.blendMode=a.readU32BE(),this.alpha=a.readU32BE(),this.visible=0!=(1&a.readU32BE()),e=a.readU32BE()},this.getVariableHeaderLen=function(){return t-a.FIXED_HEADER_LENGTH},this.getTotalHeaderLen=function(){return a.FIXED_HEADER_LENGTH+this.getVariableHeaderLen()},this.readVariableHeader=function(n){this.name=n.readString(e),n.skip(t-e-a.FIXED_HEADER_LENGTH)}}function n(){var t=new Uint8Array(m.length+4),e=new h.default(t);return e.writeString(m),e.writeU32BE(0),e.getAsDataArray()}function i(t){var e=new Uint8Array(f.length+20),a=new h.default(e);return a.writeString(f),a.writeU32BE(16),a.writeU32BE(0),a.writeU32BE(t.width),a.writeU32BE(t.height),a.writeU32BE(t.getLayerCount()),a.getAsDataArray()}function o(t){var e,a=20+t.name.length+t.data.length,n=new Uint8Array(p.length+4+a),i=new h.default(n);i.writeString(p),i.writeU32BE(a),i.writeU32BE(20+t.name.length),i.writeU32BE(t.blendMode),i.writeU32BE(t.alpha),i.writeU32BE(t.visible?1:0),i.writeU32BE(t.name.length),i.writeString(t.name),e=i.pos;for(var o=0;o<t.data.length;o+=g)n[e++]=t.data[o+v],n[e++]=t.data[o+y],n[e++]=t.data[o+E],n[e++]=t.data[o+w];return n}function s(t){for(var e=0;e<u.length;e++)if(t[e]!=u.charCodeAt(e))return!1;return!0}function d(t,e){if(null==t||0==t.length)return e;if(null==e||0==e.length)return t;var a=new Uint8Array(t.length+e.length);return a.set(t,0),a.set(e,t.length),a}t.FIXED_HEADER_LENGTH=16,a.FIXED_HEADER_LENGTH=20;var u="CHIBIOEK",f="HEAD",p="LAYR",m="ZEND",g=c.default.BYTES_PER_PIXEL,v=c.default.ALPHA_BYTE_OFFSET,y=c.default.RED_BYTE_OFFSET,E=c.default.GREEN_BYTE_OFFSET,w=c.default.BLUE_BYTE_OFFSET;this.serialize=function(t){return new Promise(function(e,a){function r(){c==h.length?(s.push(n(t),!0),l.push(s.result),e(new Blob(l,{type:"application/octet-stream"}))):(s.push(o(h[c++]),!1),setTimeout(r,10))}for(var s=new window.pako.Deflate({level:7}),l=[],d=new Uint8Array(u.length),c=0;c<u.length;c++)d[c]=u.charCodeAt(c);l.push(d),s.push(i(t),!1);var h=t.getLayers(),c=0;setTimeout(r,10)})},this.read=function(n){function i(t,e){for(var a=b%g,n=b-a,i=0,o=[v,y,E,w];a<g&&i<t.length;a++)e[n+o[a]]=t[i],b++,i++;for(var r=0|Math.min(t.length-i,C-b),s=r/g|0,l=r%g,d=0;d<s;d++)e[b+v]=t[i],e[b+y]=t[i+1],e[b+E]=t[i+2],e[b+w]=t[i+3],b+=g,i+=g;for(n=b,a=0;a<l;a++)e[n+o[a]]=t[i],b++,i++;return i<t.length?t.subarray(i):null}function o(n){for(var o;;){switch(R){case _:if(Y=d(Y,n),n=null,!Y||Y.length<8)break;if(o=new h.default(Y),D=new e(o),Y=Y.subarray(o.pos),F){if(D.chunkType==m){R=k;break}D.chunkType==p?R=S:(console.log("Unknown chunk type '"+D.chunkType+"', attempting to skip..."),n=Y,Y=null,T=D.chunkSize,R=M);continue}if(D.chunkType==f){F=D,R=x;continue}R=A;break;case x:if(Y=d(Y,n),n=null,!Y||Y.length<F.chunkSize)break;if(o=new h.default(Y),N=new t(o,F),N.version>>>16>0){R=A;break}I=new r.default(N.width,N.height),n=Y,Y=null,T=F.chunkSize,R=M;continue;case S:if(Y=d(Y,n),n=null,!Y||Y.length<a.FIXED_HEADER_LENGTH)break;c=new a,o=new h.default(Y),c.readFixedHeader(o),Y=Y.subarray(o.pos),R=L;continue;case L:if(Y=d(Y,n),n=null,!Y||Y.length<c.getVariableHeaderLen())break;o=new h.default(Y),c.readVariableHeader(o),Y=Y.subarray(o.pos),P=new l.default(N.width,N.height,c.name),P.blendMode=c.blendMode,P.alpha=c.alpha,P.visible=c.visible,b=0,C=N.width*N.height*g,n=Y,Y=null,R=O;continue;case O:if(null!=n&&(n=i(n,P.data),b>=C)){I.addLayerObject(P),T=D.chunkSize-c.getTotalHeaderLen()-C,R=M;continue}break;case M:if(n&&(T<n.length?(n=n.subarray(T),T=0):(T-=n.length,n=null)),0==T){R=_;continue}}break}}var c,P,b,C,T,_=0,x=1,S=2,L=3,O=4,M=5,k=6,A=10,B=new window.pako.Inflate({}),R=_,I=null,F=null,N=null,D=null,Y=null;return n=new Uint8Array(n),s(n)?(n=n.subarray(u.length),B.onData=o,B.onEnd=function(t){0===t&&R==k?(I.setActiveLayerIndex(I.getTopmostVisibleLayer()),this.result=I):(console.log("Fatal error decoding ChibiFile"),this.result=null)},B.push(n),B.result):null}}Object.defineProperty(a,"__esModule",{value:!0}),a.default=i;var o=t("./CPArtwork"),r=n(o),s=t("./CPLayer"),l=n(s),d=t("./CPColorBmp"),c=n(d),u=t("../util/ArrayDataStream"),h=n(u);e.exports=a.default},{"../util/ArrayDataStream":45,"./CPArtwork":2,"./CPColorBmp":9,"./CPLayer":11}],8:[function(t,e,a){"use strict";function n(t,e,a){this.bmp=t,this.x=e,this.y=a}Object.defineProperty(a,"__esModule",{value:!0}),a.default=n,e.exports=a.default},{}],9:[function(t,e,a){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function i(t,e){var a=document.createElement("canvas"),n=a.getContext("2d");return n.createImageData(t,e)}function o(t,e){c.default.call(this,t,e),this.imageData=i(this.width,this.height),this.data=this.imageData.data}function r(t,e){for(var a=0,n=0;n<e;n++){for(var i=t[a+o.ALPHA_BYTE_OFFSET],r=0;r<3;r++,a++)t[a]=Math.round(t[a]*i/255);a++}}function s(t,e){for(var a=0,n=0;n<e;n++){var i=t[a+o.ALPHA_BYTE_OFFSET];if(0!=i){for(var r=255/i,s=0;s<3;s++,a++)t[a]=Math.min(Math.round(t[a]*r),255);a++}else a+=o.BYTES_PER_PIXEL}}function l(t,e,a,n){var i,r,s=0,l=[0,0,0,0];i=0;for(var d=0;d<n&&d<a;d++){for(var c=0;c<o.BYTES_PER_PIXEL;c++)l[c]+=t[i++];s++}r=0;for(var d=0;d<a;d++){if(d+n<a){i=(d+n)*o.BYTES_PER_PIXEL;for(var c=0;c<o.BYTES_PER_PIXEL;c++)l[c]+=t[i++];s++}for(var c=0;c<o.BYTES_PER_PIXEL;c++)e[r++]=Math.round(l[c]/s);if(d-n>=0){i=(d-n)*o.BYTES_PER_PIXEL;for(var c=0;c<o.BYTES_PER_PIXEL;c++)l[c]-=t[i++];s--}}}Object.defineProperty(a,"__esModule",{value:!0}),a.default=o;var d=t("./CPBitmap"),c=n(d),u=t("../util/CPRect"),h=n(u);o.prototype=Object.create(c.default.prototype),o.prototype.constructor=o,o.BYTES_PER_PIXEL=4,o.RED_BYTE_OFFSET=0,o.GREEN_BYTE_OFFSET=1,o.BLUE_BYTE_OFFSET=2,o.ALPHA_BYTE_OFFSET=3,o.prototype.cloneRect=function(t){var e=new o(t.getWidth(),t.getHeight());return e.copyBitmapRect(this,0,0,t),e},o.prototype.getPixel=function(t,e){t=Math.max(0,Math.min(this.width-1,t)),e=Math.max(0,Math.min(this.height-1,e));var a=this.offsetOfPixel(t,e);return this.data[a+o.ALPHA_BYTE_OFFSET]<<24|this.data[a+o.RED_BYTE_OFFSET]<<16|this.data[a+o.GREEN_BYTE_OFFSET]<<8|this.data[a+o.BLUE_BYTE_OFFSET]},o.prototype.copyRectXOR=function(t,e){e=this.getBounds().clip(e);for(var a=e.getWidth(),n=e.getHeight(),i=new Uint8Array(a*n*o.BYTES_PER_PIXEL),r=0,s=this.offsetOfPixel(e.left,e.top),l=t.offsetOfPixel(e.left,e.top),d=(this.width-a)*o.BYTES_PER_PIXEL,c=(t.width-a)*o.BYTES_PER_PIXEL,u=a*o.BYTES_PER_PIXEL,h=e.top;h<e.bottom;h++,s+=d,l+=c)for(var f=0;f<u;f++,r++,s++,l++)i[r]=this.data[s]^t.data[l];return i},o.prototype.setRectXOR=function(t,e){e=this.getBounds().clip(e);for(var a=e.getWidth(),n=e.getHeight(),i=this.offsetOfPixel(e.left,e.top),r=0,s=(this.width-a)*o.BYTES_PER_PIXEL,l=a*o.BYTES_PER_PIXEL,d=0;d<n;d++){for(var c=0;c<l;c++)this.data[i++]^=t[r++];i+=s}},o.prototype.pasteAlphaRect=function(t,e,a,n){var i=e.clone(),r=new h.default(a,n,0,0);this.getBounds().clipSourceDest(i,r);for(var s=(t.width-r.getWidth())*o.BYTES_PER_PIXEL,l=(this.width-r.getWidth())*o.BYTES_PER_PIXEL,d=t.offsetOfPixel(i.left,i.top),c=this.offsetOfPixel(r.left,r.top),n=r.top;n<r.bottom;n++,d+=s,c+=l)for(var a=r.left;a<r.right;a++){var u=t.data[d+o.ALPHA_BYTE_OFFSET];if(u<=0)c+=o.BYTES_PER_PIXEL,d+=o.BYTES_PER_PIXEL;else if(255!=u){var f=this.data[c+o.ALPHA_BYTE_OFFSET],p=u+f-u*f/255|0;if(p>0){for(var m=255*u/p|0,g=255-m,v=0;v<3;v++,c++,d++)this.data[c]=t.data[d]+(this.data[c]*g-t.data[d]*g)/255|0;this.data[c++]=p,d++}else c+=o.BYTES_PER_PIXEL,d+=o.BYTES_PER_PIXEL}else for(var v=0;v<o.BYTES_PER_PIXEL;v++)this.data[c++]=t.data[d++]}},o.prototype.copyBitmapRect=function(t,e,a,n){var n=n.clone(),i=new h.default(e,a,0,0);this.getBounds().clipSourceDest(n,i);var r=0|i.getWidth(),s=0|i.getHeight();if(0==i.left&&0==i.top&&r==this.width&&s==this.height&&r==t.width&&s==t.height)this.copyDataFrom(t);else for(var l=this.offsetOfPixel(i.left,i.top),d=t.offsetOfPixel(n.left,n.top),c=(this.width-r)*o.BYTES_PER_PIXEL,u=(t.width-r)*o.BYTES_PER_PIXEL,f=0;f<s;f++){for(var p=0;p<r;p++)this.data[l]=t.data[d],this.data[l+1]=t.data[d+1],this.data[l+2]=t.data[d+2],this.data[l+3]=t.data[d+3],l+=4,d+=4;d+=u,l+=c}},o.prototype.copyAlphaFrom=function(t,e){e=this.getBounds().clip(e);for(var a=e.getWidth(),n=e.getHeight(),i=this.offsetOfPixel(e.left,e.top)+o.ALPHA_BYTE_OFFSET,r=(this.width-a)*o.BYTES_PER_PIXEL,s=0;s<n;s++){for(var l=0;l<a;l++)this.data[i]=t.data[i],i+=o.BYTES_PER_PIXEL;i+=r}},o.prototype.copyDataFrom=function(t){if(t.width==this.width&&t.height==this.height||(this.width=t.width,this.height=t.height,this.imageData=i(this.width,this.height),this.data=this.imageData.data),"set"in this.data)this.data.set(t.data);else for(var e=0;e<this.data.length;e++)this.data[e]=t.data[e]},o.prototype.floodFill=function(t,e,a){if(this.isInside(t,e)){var n=this.getPixel(t,e),i=n>>24&255,r=n>>16&255,s=n>>8&255,l=255&n,d=a>>24&255,c=a>>16&255,u=a>>8&255,h=255&a,f=[],p=this.getBounds(),m=this.data;if(p.left*=o.BYTES_PER_PIXEL,p.right*=o.BYTES_PER_PIXEL,f.push({x1:t*o.BYTES_PER_PIXEL,x2:t*o.BYTES_PER_PIXEL,y:e,dy:-1}),f.push({x1:t*o.BYTES_PER_PIXEL,x2:t*o.BYTES_PER_PIXEL,y:e+1,dy:1}),0==i){if(0==d)return;for(;f.length>0;){var g=f.pop();if(!(g.y<p.top||g.y>=p.bottom)){for(var v,y=this.offsetOfPixel(0,g.y),E=g.x1;E>=p.left&&0==m[E+y+o.ALPHA_BYTE_OFFSET];)m[E+y+o.RED_BYTE_OFFSET]=c,m[E+y+o.GREEN_BYTE_OFFSET]=u,m[E+y+o.BLUE_BYTE_OFFSET]=h,m[E+y+o.ALPHA_BYTE_OFFSET]=d,E-=o.BYTES_PER_PIXEL;if(E>=g.x1){for(;E<=g.x2&&m[E+y+o.ALPHA_BYTE_OFFSET]!=i;)E+=o.BYTES_PER_PIXEL;if(v=E+o.BYTES_PER_PIXEL,E>g.x2)continue}else E+=o.BYTES_PER_PIXEL,E<g.x1&&f.push({x1:E,x2:g.x1-o.BYTES_PER_PIXEL,y:g.y-g.dy,dy:-g.dy}),v=g.x1+o.BYTES_PER_PIXEL;do{for(m[E+y+o.RED_BYTE_OFFSET]=c,m[E+y+o.GREEN_BYTE_OFFSET]=u,m[E+y+o.BLUE_BYTE_OFFSET]=h,m[E+y+o.ALPHA_BYTE_OFFSET]=d;v<p.right&&m[v+y+o.ALPHA_BYTE_OFFSET]==i;)m[v+y+o.RED_BYTE_OFFSET]=c,m[v+y+o.GREEN_BYTE_OFFSET]=u,m[v+y+o.BLUE_BYTE_OFFSET]=h,m[v+y+o.ALPHA_BYTE_OFFSET]=d,v+=o.BYTES_PER_PIXEL;for(f.push({x1:E,x2:v-o.BYTES_PER_PIXEL,y:g.y+g.dy,dy:g.dy}),v-o.BYTES_PER_PIXEL>g.x2&&f.push({x1:g.x2+o.BYTES_PER_PIXEL,x2:v-o.BYTES_PER_PIXEL,y:g.y-g.dy,dy:-g.dy}),E=v+o.BYTES_PER_PIXEL;E<=g.x2&&m[E+y+o.ALPHA_BYTE_OFFSET]!=i;)E+=o.BYTES_PER_PIXEL;v=E+o.BYTES_PER_PIXEL}while(E<=g.x2)}}}else{if(a==n)return;for(;f.length>0;){var g=f.pop();if(!(g.y<p.top||g.y>=p.bottom)){for(var v,y=this.offsetOfPixel(0,g.y),E=g.x1;E>=p.left&&m[E+y+o.RED_BYTE_OFFSET]==r&&m[E+y+o.GREEN_BYTE_OFFSET]==s&&m[E+y+o.BLUE_BYTE_OFFSET]==l&&m[E+y+o.ALPHA_BYTE_OFFSET]==i;)m[E+y+o.RED_BYTE_OFFSET]=c,
m[E+y+o.GREEN_BYTE_OFFSET]=u,m[E+y+o.BLUE_BYTE_OFFSET]=h,m[E+y+o.ALPHA_BYTE_OFFSET]=d,E-=o.BYTES_PER_PIXEL;if(E>=g.x1){for(;E<=g.x2&&(m[E+y+o.RED_BYTE_OFFSET]!=r||m[E+y+o.GREEN_BYTE_OFFSET]!=s||m[E+y+o.BLUE_BYTE_OFFSET]!=l||m[E+y+o.ALPHA_BYTE_OFFSET]!=i);)E+=o.BYTES_PER_PIXEL;if(v=E+o.BYTES_PER_PIXEL,E>g.x2)continue}else E+=o.BYTES_PER_PIXEL,E<g.x1&&f.push({x1:E,x2:g.x1-o.BYTES_PER_PIXEL,y:g.y-g.dy,dy:-g.dy}),v=g.x1+o.BYTES_PER_PIXEL;do{for(m[E+y+o.RED_BYTE_OFFSET]=c,m[E+y+o.GREEN_BYTE_OFFSET]=u,m[E+y+o.BLUE_BYTE_OFFSET]=h,m[E+y+o.ALPHA_BYTE_OFFSET]=d;v<p.right&&m[v+y+o.RED_BYTE_OFFSET]==r&&m[v+y+o.GREEN_BYTE_OFFSET]==s&&m[v+y+o.BLUE_BYTE_OFFSET]==l&&m[v+y+o.ALPHA_BYTE_OFFSET]==i;)m[v+y+o.RED_BYTE_OFFSET]=c,m[v+y+o.GREEN_BYTE_OFFSET]=u,m[v+y+o.BLUE_BYTE_OFFSET]=h,m[v+y+o.ALPHA_BYTE_OFFSET]=d,v+=o.BYTES_PER_PIXEL;for(f.push({x1:E,x2:v-o.BYTES_PER_PIXEL,y:g.y+g.dy,dy:g.dy}),v-o.BYTES_PER_PIXEL>g.x2&&f.push({x1:g.x2+o.BYTES_PER_PIXEL,x2:v-o.BYTES_PER_PIXEL,y:g.y-g.dy,dy:-g.dy}),E=v+o.BYTES_PER_PIXEL;E<=g.x2&&(m[E+y+o.RED_BYTE_OFFSET]!=r||m[E+y+o.GREEN_BYTE_OFFSET]!=s||m[E+y+o.BLUE_BYTE_OFFSET]!=l||m[E+y+o.ALPHA_BYTE_OFFSET]!=i);)E+=o.BYTES_PER_PIXEL;v=E+o.BYTES_PER_PIXEL}while(E<=g.x2)}}}}},o.prototype.copyPixelColumnToArray=function(t,e,a,n){for(var i=(this.width-1)*o.BYTES_PER_PIXEL,r=0,s=this.offsetOfPixel(t,e),l=0;l<a;l++){for(var d=0;d<o.BYTES_PER_PIXEL;d++)n[r++]=this.data[s++];s+=i}},o.prototype.copyArrayToPixelColumn=function(t,e,a,n){for(var i=(this.width-1)*o.BYTES_PER_PIXEL,r=0,s=this.offsetOfPixel(t,e),l=0;l<a;l++){for(var d=0;d<o.BYTES_PER_PIXEL;d++)this.data[s++]=n[r++];s+=i}},o.prototype.boxBlur=function(t,e,a){t=this.getBounds().clip(t);for(var n=t.getWidth(),i=n*o.BYTES_PER_PIXEL,d=t.getHeight(),c=Math.max(n,d),u=new Uint8Array(c*o.BYTES_PER_PIXEL),h=new Uint8Array(c*o.BYTES_PER_PIXEL),f=t.top;f<t.bottom;f++){for(var p=this.offsetOfPixel(t.left,f),m=0;m<i;m++)u[m]=this.data[p++];r(u,n),l(u,h,n,e),p=this.offsetOfPixel(t.left,f);for(var m=0;m<i;m++)this.data[p++]=h[m]}for(var m=t.left;m<t.right;m++)this.copyPixelColumnToArray(m,t.top,d,u),l(u,h,d,a),s(h,d),this.copyArrayToPixelColumn(m,t.top,d,h)},o.prototype.offsetOfPixel=function(t,e){return(e*this.width+t)*o.BYTES_PER_PIXEL|0},o.prototype.getMemorySize=function(){return this.data.length},o.prototype.loadFromImage=function(t){var e=document.createElement("canvas"),a=e.getContext("2d");e.width=t.width,e.height=t.height,a.globalCompositeOperation="copy",a.drawImage(t,0,0),this.imageData=a.getImageData(0,0,this.width,this.height),this.data=this.imageData.data},o.prototype.getImageData=function(){return this.imageData},o.prototype.setImageData=function(t){this.width=t.width,this.height=t.height,this.imageData=t,this.data=t.data},e.exports=a.default},{"../util/CPRect":52,"./CPBitmap":3}],10:[function(t,e,a){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function i(t,e,a){switch(r.default.call(this,t,e),this.bitDepth=a,a){case 32:this.data=new Uint32Array(t*e);break;case 16:this.data=new Uint16Array(t*e);break;case 8:default:this.data=new Uint8Array(t*e)}this.clone=function(){var t=new i(this.width,this.height,this.bitDepth);return t.data.set(this.data),t},this.clearAll=function(t){for(var e=0;e<this.data.length;e++)this.data[e]=t},this.clearRect=function(t,e){for(var t=this.getBounds().clip(t),a=this.width-t.getWidth(),n=this.offsetOfPixel(t.left,t.top),i=t.top;i<t.bottom;i++,n+=a)for(var o=t.left;o<t.right;o++,n++)this.data[n]=e},this.mirrorHorizontally=function(){for(var a=new Uint8Array(t*e),n=0;n<e;n++)for(var i=0;i<t;i++)a[n*t+i]=this.data[n*t+t-i-1];this.data=a},this.applyLUT=function(t){for(var e=0;e<this.data.length;e++)this.data[e]=t.table[this.data[e]]},this.toCanvas=function(){var t=this.toImageData(),e=document.createElement("canvas"),a=e.getContext("2d");return e.width=this.width,e.height=this.height,a.putImageData(t,0,0),e},this.toImageData=function(){for(var t=document.createElement("canvas"),e=t.getContext("2d"),a=e.createImageData(this.width,this.height),n=0,i=0,o=0;o<this.height;o++)for(var r=0;r<this.width;r++)a.data[i++]=this.data[n],a.data[i++]=this.data[n],a.data[i++]=this.data[n],a.data[i++]=255,n++;return a}}Object.defineProperty(a,"__esModule",{value:!0}),a.default=i;var o=t("./CPBitmap"),r=n(o);i.prototype.offsetOfPixel=function(t,e){return e*this.width+t},e.exports=a.default},{"./CPBitmap":3}],11:[function(t,e,a){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function i(t,e,a){l.default.call(this,t,e),this.name=a||"",this.alpha=100,this.visible=!0,this.blendMode=c.default.LM_NORMAL}function o(t,e){if(e%=4,0==e)return t;var a=document.createElement("canvas"),n=a.getContext("2d");switch(e%2==0?(a.width=t.width,a.height=t.height):(a.width=t.height,a.height=t.width),e){case 1:n.rotate(Math.PI/2),n.drawImage(t,0,-t.height);break;case 2:n.rotate(Math.PI),n.drawImage(t,-t.width,-t.height);break;case 3:n.rotate(-Math.PI/2),n.drawImage(t,-t.width,0);break;case 0:default:return t}return a}function r(t){return!("string"!=typeof t||!t.match(/^data:image\/png;base64,/i))&&window.atob(t.substring("data:image/png;base64,".length))}Object.defineProperty(a,"__esModule",{value:!0}),a.default=i;var s=t("./CPColorBmp"),l=n(s),d=t("./CPBlend"),c=n(d);i.prototype=Object.create(l.default.prototype),i.prototype.constructor=i;var u=4,h=3;i.prototype.clearAll=function(t){for(var e=t>>24&255,a=t>>16&255,n=t>>8&255,i=255&t,o=0;o<this.width*this.height*u;)this.data[o++]=a,this.data[o++]=n,this.data[o++]=i,this.data[o++]=e},i.prototype.clearRect=function(t,e){for(var a=e>>24&255,n=e>>16&255,i=e>>8&255,o=255&e,t=this.getBounds().clip(t),r=(this.width-t.getWidth())*u,s=this.offsetOfPixel(t.left,t.top),l=t.top;l<t.bottom;l++,s+=r)for(var d=t.left;d<t.right;d++)this.data[s++]=n,this.data[s++]=i,this.data[s++]=o,this.data[s++]=a},i.prototype.copyRegionHFlip=function(t,e){t=this.getBounds().clip(t);for(var a=t.top;a<t.bottom;a++)for(var n=this.offsetOfPixel(t.left,a),i=e.offsetOfPixel(t.right-1,a),o=t.left;o<t.right;o++,i-=2*l.default.BYTES_PER_PIXEL)for(var r=0;r<l.default.BYTES_PER_PIXEL;r++)this.data[n++]=e.data[i++]},i.prototype.copyRegionVFlip=function(t,e){t=this.getBounds().clip(t);for(var a=t.getWidth()*l.default.BYTES_PER_PIXEL,n=t.top;n<t.bottom;n++)for(var i=this.offsetOfPixel(t.left,n),o=e.offsetOfPixel(t.left,t.bottom-1-(n-t.top)),r=0;r<a;r++)this.data[i++]=e.data[o++]},i.prototype.fillWithNoise=function(t){t=this.getBounds().clip(t);for(var e,a=(this.width-t.getWidth())*l.default.BYTES_PER_PIXEL,n=this.offsetOfPixel(t.left,t.top),i=t.top;i<t.bottom;i++,n+=a)for(var o=t.left;o<t.right;o++,n+=l.default.BYTES_PER_PIXEL)e=256*Math.random()|0,this.data[n+l.default.RED_BYTE_OFFSET]=e,this.data[n+l.default.GREEN_BYTE_OFFSET]=e,this.data[n+l.default.BLUE_BYTE_OFFSET]=e,this.data[n+l.default.ALPHA_BYTE_OFFSET]=255},i.prototype.gradientHorzReplace=function(t,e,a,n){var i={r:n[0]>>16&255,g:n[0]>>8&255,b:255&n[0],a:n[0]>>24&255},o={r:n[1]>>16&255,g:n[1]>>8&255,b:255&n[1],a:n[1]>>24&255},r=(this.width-t.getWidth())*l.default.BYTES_PER_PIXEL,s=0|this.offsetOfPixel(t.left,t.top),d=t.bottom-t.top|0;if(a<e){var c=a;a=e,e=c,c=i,i=o,o=c}for(var u=a-e|0,h=(o.r-i.r)/u,f=(o.g-i.g)/u,p=(o.b-i.b)/u,m=(o.a-i.a)/u,g=Math.max(t.left-e,0),v=0;v<d;v++,s+=r){for(var y=t.left,E=0|Math.min(e,t.right);y<E;y++,s+=l.default.BYTES_PER_PIXEL)this.data[s+l.default.RED_BYTE_OFFSET]=i.r,this.data[s+l.default.GREEN_BYTE_OFFSET]=i.g,this.data[s+l.default.BLUE_BYTE_OFFSET]=i.b,this.data[s+l.default.ALPHA_BYTE_OFFSET]=i.a;var w=i.r+h*g,P=i.g+f*g,b=i.b+p*g,C=i.a+m*g;for(E=0|Math.min(a,t.right);y<E;y++,s+=l.default.BYTES_PER_PIXEL)this.data[s+l.default.RED_BYTE_OFFSET]=w,this.data[s+l.default.GREEN_BYTE_OFFSET]=P,this.data[s+l.default.BLUE_BYTE_OFFSET]=b,this.data[s+l.default.ALPHA_BYTE_OFFSET]=C,w+=h,P+=f,b+=p,C+=m;for(;y<t.right;y++,s+=l.default.BYTES_PER_PIXEL)this.data[s+l.default.RED_BYTE_OFFSET]=o.r,this.data[s+l.default.GREEN_BYTE_OFFSET]=o.g,this.data[s+l.default.BLUE_BYTE_OFFSET]=o.b,this.data[s+l.default.ALPHA_BYTE_OFFSET]=o.a}},i.prototype.gradientVertReplace=function(t,e,a,n){var i={r:n[0]>>16&255,g:n[0]>>8&255,b:255&n[0],a:n[0]>>24&255},o={r:n[1]>>16&255,g:n[1]>>8&255,b:255&n[1],a:n[1]>>24&255},r=(this.width-t.getWidth())*l.default.BYTES_PER_PIXEL,s=0|this.offsetOfPixel(t.left,t.top),d=t.right-t.left|0;if(a<e){var c=a;a=e,e=c,c=i,i=o,o=c}for(var u=t.top,h=0|Math.min(t.bottom,e);u<h;u++,s+=r)for(var f=0;f<d;f++,s+=l.default.BYTES_PER_PIXEL)this.data[s+l.default.RED_BYTE_OFFSET]=i.r,this.data[s+l.default.GREEN_BYTE_OFFSET]=i.g,this.data[s+l.default.BLUE_BYTE_OFFSET]=i.b,this.data[s+l.default.ALPHA_BYTE_OFFSET]=i.a;for(var p=a-e|0,m=(o.r-i.r)/p,g=(o.g-i.g)/p,v=(o.b-i.b)/p,y=(o.a-i.a)/p,E=Math.max(u-e,0),w=i.r+m*E,P=i.g+g*E,b=i.b+v*E,C=i.a+y*E,h=0|Math.min(t.bottom,a);u<h;u++,s+=r){for(var f=0;f<d;f++,s+=l.default.BYTES_PER_PIXEL)this.data[s+l.default.RED_BYTE_OFFSET]=w,this.data[s+l.default.GREEN_BYTE_OFFSET]=P,this.data[s+l.default.BLUE_BYTE_OFFSET]=b,this.data[s+l.default.ALPHA_BYTE_OFFSET]=C;w+=m,P+=g,b+=v,C+=y}for(;u<t.bottom;u++,s+=r)for(var f=0;f<d;f++,s+=l.default.BYTES_PER_PIXEL)this.data[s+l.default.RED_BYTE_OFFSET]=o.r,this.data[s+l.default.GREEN_BYTE_OFFSET]=o.g,this.data[s+l.default.BLUE_BYTE_OFFSET]=o.b,this.data[s+l.default.ALPHA_BYTE_OFFSET]=o.a},i.prototype.gradientReplace=function(t,e,a,n,i,o){for(var r=(this.width-t.getWidth())*l.default.BYTES_PER_PIXEL,s=0|this.offsetOfPixel(t.left,t.top),d=t.right-t.left|0,c={r:o[0]>>16&255,g:o[0]>>8&255,b:255&o[0],a:o[0]>>24&255},u={r:o[1]>>16&255,g:o[1]>>8&255,b:255&o[1],a:o[1]>>24&255},h=i-a+(n-e)*(n-e)/(i-a),f=n-e+(i-a)*(i-a)/(n-e),p=1/f,m=t.top;m<t.bottom;m++,s+=r)for(var g=(t.left-e)/f+(m-a)/h,v=0;v<d;v++,s+=l.default.BYTES_PER_PIXEL){var y=Math.min(Math.max(g,0),1),E=1-y;this.data[s+l.default.RED_BYTE_OFFSET]=c.r*E+u.r*y,this.data[s+l.default.GREEN_BYTE_OFFSET]=c.g*E+u.g*y,this.data[s+l.default.BLUE_BYTE_OFFSET]=c.b*E+u.b*y,this.data[s+l.default.ALPHA_BYTE_OFFSET]=c.a*E+u.a*y,g+=p}},i.prototype.gradientAlpha=function(t,e,a,n,i,o){for(var r=(this.width-t.getWidth())*l.default.BYTES_PER_PIXEL,s=0|this.offsetOfPixel(t.left,t.top),d=t.right-t.left|0,c={r:o[0]>>16&255,g:o[0]>>8&255,b:255&o[0],a:o[0]>>24&255},u={r:o[1]>>16&255,g:o[1]>>8&255,b:255&o[1],a:o[1]>>24&255},f=i-a+(n-e)*(n-e)/(i-a),p=n-e+(i-a)*(i-a)/(n-e),m=1/p,g=t.top;g<t.bottom;g++,s+=r)for(var v=(t.left-e)/p+(g-a)/f,y=0;y<d;y++,s+=l.default.BYTES_PER_PIXEL){var E=Math.min(Math.max(v,0),1),w=1-E,P=c.r*w+u.r*E,b=c.g*w+u.g*E,C=c.b*w+u.b*E,T=c.a*w+u.a*E,_=this.data[s+h],x=T+_-T*_/255|0;if(x>0){var S=255*T/x|0,L=255-S;this.data[s+l.default.RED_BYTE_OFFSET]=(P*S+this.data[s+l.default.RED_BYTE_OFFSET]*L)/255|0,this.data[s+l.default.GREEN_BYTE_OFFSET]=(b*S+this.data[s+l.default.GREEN_BYTE_OFFSET]*L)/255|0,this.data[s+l.default.BLUE_BYTE_OFFSET]=(C*S+this.data[s+l.default.BLUE_BYTE_OFFSET]*L)/255|0,this.data[s+l.default.ALPHA_BYTE_OFFSET]=x}v+=m}},i.prototype.gradient=function(t,e,a,n,i,o,r){t=this.getBounds().clip(t),e==n&&a==i||(r||o[0]>>>24==255&&o[1]>>>24==255?e==n?this.gradientVertReplace(t,a,i,o):a==i?this.gradientHorzReplace(t,e,n,o):this.gradientReplace(t,e,a,n,i,o):this.gradientAlpha(t,e,a,n,i,o))},i.prototype.fillWithColorNoise=function(t){t=this.getBounds().clip(t);for(var e,a=(this.width-t.getWidth())*l.default.BYTES_PER_PIXEL,n=this.offsetOfPixel(t.left,t.top),i=t.top;i<t.bottom;i++,n+=a)for(var o=t.left;o<t.right;o++,n+=l.default.BYTES_PER_PIXEL)e=16777216*Math.random()|0,this.data[n+l.default.RED_BYTE_OFFSET]=e>>16&255,this.data[n+l.default.GREEN_BYTE_OFFSET]=e>>8&255,this.data[n+l.default.BLUE_BYTE_OFFSET]=255&e,this.data[n+l.default.ALPHA_BYTE_OFFSET]=255},i.prototype.invert=function(t){t=this.getBounds().clip(t);for(var e=(this.width-t.getWidth())*l.default.BYTES_PER_PIXEL,a=this.offsetOfPixel(t.left,t.top),n=t.top;n<t.bottom;n++,a+=e)for(var i=t.left;i<t.right;i++,a+=l.default.BYTES_PER_PIXEL)this.data[a+l.default.RED_BYTE_OFFSET]^=255,this.data[a+l.default.GREEN_BYTE_OFFSET]^=255,this.data[a+l.default.BLUE_BYTE_OFFSET]^=255},i.prototype.getAlpha=function(){return this.alpha},i.prototype.getBlendMode=function(){return this.blendMode},i.prototype.clone=function(){var t=new i(this.width,this.height,"");return t.copyFrom(this),t},i.prototype.copyFrom=function(t){this.name=t.name,this.blendMode=t.blendMode,this.alpha=t.alpha,this.visible=t.visible,this.copyDataFrom(t)},i.prototype.hasAlpha=function(){if(100!=this.alpha)return!0;for(var t=h,e=0;e<height;e++){for(var a=255,n=0;n<this.width;n++,t+=u)a&=this.data[t];if(255!=a)return!0}return!1},i.prototype.hasAlphaInRect=function(t){if(100!=this.alpha)return!0;t=this.getBounds().clip(t);for(var e=(this.width-t.getWidth())*u,a=this.offsetOfPixel(t.left,t.top)+h,n=t.top;n<t.bottom;n++,a+=e){for(var i=255,o=t.left;o<t.right;o++,a+=u)i&=this.data[a];if(255!=i)return!0}return!1},i.prototype.getNonTransparentBounds=function(t){var e,a,n,i,o,r=t.clone();for(o=(this.width-r.getWidth())*u,e=this.offsetOfPixel(r.left,r.top)+h,n=r.top;n<r.bottom;n++,e+=o){i=0;for(var a=r.left;a<r.right;a++,e+=u)i|=this.data[e];if(0!=i)break}if(r.top=n,r.top==r.bottom)return r;for(e=this.offsetOfPixel(r.right-1,r.bottom-1)+h,n=r.bottom-1;n>=r.top;n--,e-=o){i=0;for(var a=r.right-1;a>=r.left;a--,e-=u)i|=this.data[e];if(0!=i)break}for(r.bottom=n+1,o=u*this.width,a=r.left;a<r.right;a++){for(e=this.offsetOfPixel(a,r.top)+h,i=0,n=r.top;n<r.bottom;n++,e+=o)i|=this.data[e];if(0!=i)break}for(r.left=a,a=r.right-1;a>=r.left;a--){for(e=this.offsetOfPixel(a,r.top)+h,i=0,n=r.top;n<r.bottom;n++,e+=o)i|=this.data[e];if(0!=i)break}return r.right=a+1,r},i.prototype.setAlpha=function(t){this.alpha=t},i.prototype.setBlendMode=function(t){this.blendMode=t},i.prototype.getAlpha=function(){return this.alpha},i.prototype.getBlendMode=function(){return this.blendMode},i.prototype.getAsPNG=function(t){var e=document.createElement("canvas"),a=e.getContext("2d");return e.width=this.imageData.width,e.height=this.imageData.height,a.putImageData(this.imageData,0,0),e=o(e,t||0),r(e.toDataURL("image/png"))},e.exports=a.default},{"./CPBlend":4,"./CPColorBmp":9}],12:[function(t,e,a){"use strict";function n(){this.table=new Uint8Array(256),this.loadIdentity=function(){for(var t=0;t<256;t++)this.table[t]=t},this.loadBrightnessContrast=function(t,e){for(var a=e>0?1/(1.0001-e):1+e,n=.5-.5*a+t,i=0;i<256;i++){var o=i/255,r=o*a+n;this.table[i]=Math.min(255,Math.max(~~(255*r),0))}},this.invert=function(){for(var t=0;t<256;t++)this.table[t]=255-this.table[t]}}Object.defineProperty(a,"__esModule",{value:!0}),a.default=n,e.exports=a.default},{}],13:[function(t,e,a){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function i(t){function e(t,e){return new Promise(function(a,n){switch(t.name){case"flat":var i=new Blob([e],{type:"image/png"}),o=window.URL.createObjectURL(i);if(o){var s=new Image;s.onload=function(){var t=new l.default(this.width,this.height),e=new c.default(this.width,this.height,"Layer 1");e.loadFromImage(s),t.addLayerObject(e),s=null,window.URL.revokeObjectURL(o),a(t)},s.src=o}else a(null);break;case"swatches":var d=new h.default,u=d.read(e);a(u);break;case"layers":var d=new r.default,f=d.read(e);a(f);break;default:a(null)}})}function a(t,e){null===e?o.emitEvent("loadingProgress",[1,"Loading your "+t.friendly+"..."]):o.emitEvent("loadingProgress",[e,"Loading your "+t.friendly+" ("+Math.round(100*e)+"%)..."])}var n=[],i={},o=this;t.loadChibiFileUrl&&(""+t.loadChibiFileUrl).length>0?n.push({url:t.loadChibiFileUrl,friendly:"drawing layers",name:"layers",required:!0}):t.loadImageUrl&&(""+t.loadImageUrl).length>0&&n.push({url:t.loadImageUrl,friendly:"drawing",name:"flat",required:!0}),t.loadSwatchesUrl&&n.push({url:t.loadSwatchesUrl,friendly:"color swatches",name:"swatches",required:!1,noProgress:!0}),this.load=function(){function t(){r.required?o.emitEvent("loadingFailure",["Failed to load your "+r.friendly+", please try again later."]):o.load()}if(0==n.length)return void o.emitEvent("loadingComplete",[i]);var r=n.shift(),s=new XMLHttpRequest;s.addEventListener("progress",function(t){var e;e=t.lengthComputable&&!r.noProgress?t.loaded/t.total:null,a(r,e)},!1),s.addEventListener("load",function(a){if(200==this.status){var n=this.response;o.emitEvent("loadingProgress",[1,"Starting ChickenPaint..."]),setTimeout(function(){e(r,n).then(function(t){t?(i[r.name]=t,o.load()):o.emitEvent("loadingFailure",["Failed to read your "+r.friendly])})},0)}else t()},!1),s.addEventListener("error",t),a(r,r.noProgress?null:0),s.open("GET",r.url,!0),s.responseType="arraybuffer",s.send()}}Object.defineProperty(a,"__esModule",{value:!0}),a.default=i;var o=t("./CPChibiFile"),r=n(o),s=t("./CPArtwork"),l=n(s),d=t("./CPLayer"),c=n(d),u=t("../util/AdobeColorTable"),h=n(u);i.prototype=Object.create(EventEmitter.prototype),i.prototype.constructor=i,e.exports=a.default},{"../util/AdobeColorTable":44,"./CPArtwork":2,"./CPChibiFile":7,"./CPLayer":11}],14:[function(t,e,a){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function i(t){for(var e=new Uint8Array(t.length),a=0;a<t.length;a++)e[a]=t.charCodeAt(a);return e}function o(t){function e(t){null===t?o.emitEvent("savingProgress",[1,"Saving your drawing to the server..."]):o.emitEvent("savingProgress",[t,"Saving your drawing to the server...  ("+Math.round(100*t)+"%)"])}function a(t){o.emitEvent("savingFailure",[t])}function n(n){var i=new XMLHttpRequest;i.upload.addEventListener("progress",function(t){var a;a=t.lengthComputable?t.loaded/t.total:null,e(a)},!1),i.addEventListener("load",function(t){e(1),200==this.status&&/^CHIBIOK/.test(this.response)?o.emitEvent("savingComplete"):a(this.response)},!1),i.addEventListener("error",function(){a(this.response)},!1),e(0),i.open("POST",t.url,!0),i.responseType="text",i.send(n)}var o=this,r=!1;t.rotation=t.rotation||0,this.save=function(){var e,a,l;e=i(t.artwork.getFlatPNG(t.rotation)),a=new Blob([e],{type:"image/png"}),e=null;var d;d=t.artwork.isSimpleDrawing()?Promise.resolve(null):(new s.default).serialize(t.artwork),d.then(function(e){if(r)return void o.emitEvent("savingFailure");if(t.swatches){var i=new c.default;l=new Blob([i.write(t.swatches)],{type:"application/octet-stream"})}else l=null;if(t.url){var s="This marker ensures the upload wasn't truncated",d=new FormData;d.append("beginMarker",s),d.append("painter","ChickenPaint v1.0"),d.append("picture",a),a=null,e?(d.append("chibifileFormat","ChickenPaint v0.0"),d.append("chibifile",e),e=null,d.append("rotation",""+t.rotation)):d.append("rotation","0"),l&&(d.append("swatches",l),l=null),d.append("endMarker",s),n(d)}else window.saveAs(a,"oekaki.png"),e&&window.saveAs(e,"oekaki.chi"),l&&window.saveAs(l,"oekaki.aco")})},this.cancel=function(){r=!0}}Object.defineProperty(a,"__esModule",{value:!0}),a.binaryStringToByteArray=i,a.default=o;var r=t("./CPChibiFile"),s=n(r),l=t("./CPArtwork"),d=(n(l),t("../util/AdobeColorTable")),c=n(d);o.prototype=Object.create(EventEmitter.prototype),o.prototype.constructor=o},{"../util/AdobeColorTable":44,"./CPArtwork":2,"./CPChibiFile":7}],15:[function(t,e,a){"use strict";function n(){}Object.defineProperty(a,"__esModule",{value:!0}),a.default=n,n.prototype.merge=function(t){return!1},n.prototype.noChange=function(){return!1},n.prototype.getMemoryUsed=function(t,e){return 0},n.prototype.compact=function(){},e.exports=a.default},{}],16:[function(t,e,a){"use strict";function n(t){var e=$('<div class="modal fade chickenpaint-about-dialog" tabindex="-1" role="dialog">\n                <div class="modal-dialog">\n                    <div class="modal-content">\n                        <div class="modal-header">\n                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">\n                                <span aria-hidden="true">&times;</span>\n                            </button>\n                            <h4 class="modal-title">About ChickenPaint</h4>\n                        </div>\n                        <div class="modal-body">\n                            <a class="chickenpaint-on-github" target="_blank" href="https://github.com/thenickdude/chickenpaint"><span class="fa fa-github"></span> ChickenPaint on GitHub</a>\n                            \n                            <p>\n                                ChickenPaint is a translation of <a href="http://www.chibipaint.com/" target="_blank">ChibiPaint</a>\n                                from Java to JavaScript by Nicholas Sherlock / Chicken Smoothie\n                            </p>\n                            <p>\n                                ChibiPaint is Copyright (c) 2006-2008 Marc Schefer. All Rights Reserved\n                            </p>\n                            <p>\n                                ChickenPaint is free software: you can redistribute it and/or modify\n                                it under the terms of the GNU General Public License as published by\n                                the Free Software Foundation, either version 3 of the License, or\n                                (at your option) any later version.\n                            </p>\n        \n                            <p>\n                                ChickenPaint is distributed in the hope that it will be useful,\n                                but WITHOUT ANY WARRANTY; without even the implied warranty of\n                                MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n                                <a target="_blank" href="http://www.gnu.org/licenses/">GNU General Public License</a> for more details.\n                            </p>\n        \n                            <pre class="pre-scrollable chickenpaint-third-party-licenses">Includes icons from the <a href="http://tango.freedesktop.org/" target="_blank">Tango Desktop Project</a>\n\nIncludes these MIT-licensed libraries:\n\n    Includes the <a target="_blank" href="https://github.com/eligrey/FileSaver.js">FileSaver.js library</a>\n    FileSaver.js Copyright © 2015 <a target="_blank" href="http://eligrey.com/">Eli Grey</a>\n\n    Includes the <a target="_blank" href="https://github.com/nodeca/pako">Pako zlib compression library</a>\n    Copyright (C) 2014-2015 by Vitaly Puzrin\n    \n    Includes the <a target="_blank" href="https://github.com/madrobby/keymaster">keymaster.js</a> keyboard library\n    Copyright (c) 2011-2013 Thomas Fuchs\n\n    Includes the <a target="_blank" href="https://github.com/stefanpenner/es6-promise">es6-promise</a> library\n    Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors\n\n    Includes the <a target="_blank" href="http://benalman.com/projects/jquery-throttle-debounce-plugin/">jQuery throttle-debounce</a> library\n    Copyright (c) 2010 "Cowboy" Ben Alman\n\n    Permission is hereby granted, free of charge, to any person\n    obtaining a copy of this software and associated documentation\n    files (the "Software"), to deal in the Software without\n    restriction, including without limitation the rights to use,\n    copy, modify, merge, publish, distribute, sublicense, and/or\n    sell copies of the Software, and to permit persons to whom the\n    Software is furnished to do so, subject to the following\n    conditions:\n\n    The above copyright notice and this permission notice shall be\n    included in all copies or substantial portions of the Software.\n\n    THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,\n    EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n    OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n    NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT \n    HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n    WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n    FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n    OTHER DEALINGS IN THE SOFTWARE.\n\nIncludes the <a href="http://www.jquery.com/" target="_blank">JQuery library</a>\nCopyright <a href="https://jquery.org/" target="_blank">jQuery Foundation and other contributors</a>\n    \n    This software consists of voluntary contributions made by many\n    individuals. For exact contribution history, see the revision \n    history available at https://github.com/jquery/jquery\n    \n    The following license applies to all parts of this software \n    except as documented below:\n    \n    Permission is hereby granted, free of charge, to any person \n    obtaining a copy of this software and associated documentation\n    files (the "Software"), to deal in the Software without\n    restriction, including without limitation the rights to use, \n    copy, modify, merge, publish, distribute, sublicense, and/or\n    sell copies of the Software, and to permit persons to whom the\n    Software is furnished to do so, subject to the following\n    conditions:\n    \n    The above copyright notice and this permission notice shall be\n    included in all copies or substantial portions of the Software.\n    \n    THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,\n    EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n    OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n    NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n    HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n    WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n    FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n    OTHER DEALINGS IN THE SOFTWARE.\n                    </pre>\n                </div>\n            </div>\n        </div>\n    ');e.on("hidden.bs.modal",function(t){e.remove()}),e.modal({show:!1}),e.data("bs.modal").$body=$(t),t.appendChild(e[0]),this.show=function(){e.modal("show")}}Object.defineProperty(a,"__esModule",{value:!0}),a.default=n,e.exports=a.default},{}],17:[function(t,e,a){"use strict";function n(t,e){var a=$('<div class="modal fade" tabindex="-1" role="dialog">\n                <div class="modal-dialog">\n                    <div class="modal-content">\n                        <div class="modal-header">\n                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">\n                                <span aria-hidden="true">&times;</span>\n                            </button>\n                            <h4 class="modal-title">Box blur</h4>\n                        </div>\n                        <div class="modal-body">\n                            <form>\n                                <div class="form-group">\n                                    <label>Blur amount (pixels)</label>\n                                    <input type="text" class="form-control chickenpaint-blur-amount" value="3">\n                                </div>\n                                <div class="form-group">\n                                    <label>Iterations (1-8, larger gives smoother blur)</label>\n                                    <input type="text" class="form-control chickenpaint-blur-iterations" value="1">\n                                </div>\n                            </form>\n                        </div>\n                        <div class="modal-footer">\n                            <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>\n                            <button type="button" class="btn btn-primary chickenpaint-apply-box-blur" data-dismiss="modal">Ok</button>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        '),n=$(".chickenpaint-blur-amount",a),i=$(".chickenpaint-blur-iterations",a),o=$(".chickenpaint-apply-box-blur",a);this.show=function(){a.modal("show")},o.click(function(t){var a=Math.max(parseInt(n.val(),10),1),o=Math.min(Math.max(parseInt(i.val(),10),1),8);e.getArtwork().boxBlur(a,a,o)}),a.modal({show:!1}).on("shown.bs.modal",function(){n.focus()}).on("keypress",function(t){13==t.keyCode&&o.click()}),a.data("bs.modal").$body=$(t),t.appendChild(a[0])}Object.defineProperty(a,"__esModule",{value:!0}),a.default=n,e.exports=a.default},{}],18:[function(t,e,a){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function i(t,e){var a=document.createElement("div");return a.className="chickenpaint-checkbox-slider-group",a.appendChild(t.getElement()),a.appendChild(e.getElement()),a}function o(t,e){for(var a in e){var n=document.createElement("option");n.appendChild(document.createTextNode(e[a])),n.value=a,t.appendChild(n)}}function r(t){function e(){s.gradient(s.getBounds(),0,0,s.width,0,c,!0),d.putImageData(s.imageData,0,0,0,0,a,n),o.fillRect(0,0,i.width,i.height),o.drawImage(l,0,0)}var a=150,n=32,i=document.createElement("canvas"),o=i.getContext("2d"),r=(0,P.createCheckerboardPattern)(o),s=new C.default(a,n,""),l=document.createElement("canvas"),d=l.getContext("2d"),c=t.getCurGradient();this.getElement=function(){return i},t.on("gradientChange",function(t){c=t,e()}),i.width=l.width=a,i.height=l.height=n,i.className="chickenpaint-gradient-preview",o.fillStyle=r,e()}function s(t){p.default.call(this,t,"brush","Tool options");var e=new l(t),a=new d(t),n=new c(t),i=this.getBodyElement();i.appendChild(e.getElement()),i.appendChild(a.getElement()),i.appendChild(n.getElement()),t.on("modeChange",function(t){switch(e.getElement().style.display="none",a.getElement().style.display="none",n.getElement().style.display="none",t){case h.default.M_GRADIENTFILL:a.getElement().style.display="block";break;case h.default.M_TRANSFORM:n.getElement().style.display="block";break;default:e.getElement().style.display="block"}})}function l(t){function e(){d.setValue(t.getBrushInfo().pressureAlpha),c.setValue(t.getAlpha()),u.setValue(t.getBrushInfo().pressureSize),h.setValue(t.getBrushSize()),f.setValue(t.getBrushInfo().pressureScattering),p.setValue(~~(100*t.getBrushInfo().scattering)),l.value=t.getBrushInfo().type,m.setValue(~~(100*t.getBrushInfo().resat)),v.setValue(~~(100*t.getBrushInfo().bleed)),y.setValue(~~(100*t.getBrushInfo().spacing)),E.setValue(~~(100*t.getBrushInfo().smoothing))}var a=["Round Pixelated","Round Hard Edge","Round Soft","Square Pixelated","Square Hard Edge"],n=[1,2,3,4,5,6,7,8,9,10,15,20,25,30,35,40,45,50,60,70,80,90,100,125,150,175,200],r=document.createElement("div"),l=document.createElement("select"),d=new g.default((!1),"Control brush opacity with pen pressure"),c=new w.default(1,255),u=new g.default((!0),"Control brush size with pen pressure"),h=new w.default(1,200,(!1),(!0)),f=new g.default((!1),"Control brush scattering with pen pressure"),p=new w.default(0,1e3,(!1),(!0)),m=new w.default(0,100,(!1),(!0)),v=new w.default(0,100,(!1),(!0)),y=new w.default(0,100,(!1),(!0)),E=new w.default(0,100,(!1),(!0)),P=new s.CPBrushPreview(t);this.getElement=function(){return r},c.title=function(t){return"Opacity: "+t},c.on("valueChange",function(e){t.setAlpha(e)}),h.title=function(t){return"Brush size: "+t},h.on("valueChange",function(e){t.setBrushSize(e)}),m.title=function(t){return"Color: "+t+"%"},m.on("valueChange",function(e){t.getBrushInfo().resat=e/100,t.callToolListeners()}),v.title=function(t){return"Blend: "+t+"%"},v.on("valueChange",function(e){t.getBrushInfo().bleed=e/100,t.callToolListeners()}),y.title=function(t){return"Spacing: "+t+"%"},y.on("valueChange",function(e){t.getBrushInfo().spacing=e/100,t.callToolListeners()}),p.title=function(t){return"Scattering: "+t+"%"},p.on("valueChange",function(e){t.getBrushInfo().scattering=e/100,t.callToolListeners()}),E.title=function(t){return"Smoothing: "+t+"%"},E.on("valueChange",function(e){t.getBrushInfo().smoothing=e/100,t.callToolListeners()}),f.on("valueChange",function(e){t.getBrushInfo().pressureScattering=e,t.callToolListeners()}),d.on("valueChange",function(e){t.getBrushInfo().pressureAlpha=e,t.callToolListeners()}),u.on("valueChange",function(e){t.getBrushInfo().pressureSize=e,t.callToolListeners()}),l.addEventListener("change",function(e){t.getBrushInfo().type=parseInt(l.value,10);
}),l.className="form-control",o(l,a),r.appendChild(l),r.appendChild(P.getElement()),r.appendChild(i(u,h)),r.appendChild(i(d,c)),r.appendChild(m.getElement()),r.appendChild(v.getElement()),r.appendChild(y.getElement()),r.appendChild(i(f,p)),r.appendChild(E.getElement()),e(),t.on("toolChange",function(t,e){c.setValue(e.alpha),h.setValue(e.size),u.setValue(e.pressureSize),d.setValue(e.pressureAlpha),l.value=e.type,f.setValue(e.pressureScattering),~~(100*e.resat)!=m.value&&m.setValue(~~(100*e.resat)),~~(100*e.bleed)!=v.value&&v.setValue(~~(100*e.bleed)),~~(100*e.spacing)!=y.value&&y.setValue(~~(100*e.spacing)),~~(100*e.scattering)!=p.value&&p.setValue(~~(100*e.scattering)),~~(100*e.smoothing)!=E.value&&E.setValue(~~(100*e.smoothing))}),key("1,2,3,4,5,6,7,8,9,0",function(e,a){var n=parseInt(a.shortcut,10);0==n&&(n=10),t.setAlpha(Math.round(n/10*255))}),key("{,[",function(){for(var e=t.getBrushSize(),a=n.length-1;a>=0;a--)if(e>n[a]){t.setBrushSize(n[a]);break}}),key("},]",function(){for(var e=t.getBrushSize(),a=0;a<n.length;a++)if(e<n[a]){t.setBrushSize(n[a]);break}})}function d(t){function e(){var e=new Array(2);e[0]=i.getAlpha()<<24|i.getColorRgb(),e[1]=o.getAlpha()<<24|o.getColorRgb(),t.setCurGradient(e)}var a=document.createElement("div"),n=new r(t),i=new y.default(new _.default(16777215&t.getCurGradient()[0])),o=new y.default(new _.default(16777215&t.getCurGradient()[1]));this.getElement=function(){return a},a.className="chickenpaint-gradient-panel",a.style.display="none",i.on("colorChange",e),i.on("alphaChange",e),o.on("colorChange",e),o.on("alphaChange",e);var s,l,d;s=document.createElement("p"),s.innerHTML="Gradient",a.appendChild(s),a.appendChild(n.getElement()),l=document.createElement("div"),l.className="chickenpaint-gradient-colors",d=document.createElement("div"),d.className="chickenpaint-gradient-start-color",d.appendChild(i.getElement()),l.appendChild(d),d=document.createElement("div"),d.className="chickenpaint-gradient-end-color",d.appendChild(o.getElement()),l.appendChild(d),a.appendChild(l)}function c(t){var e={smooth:"Smooth",sharp:"Sharp"},a=document.createElement("div"),n=document.createElement("button"),i=document.createElement("button"),r=document.createElement("select");if(this.getElement=function(){return a},a.className="chickenpaint-transform-panel",a.style.display="none",n.type="button",i.type="button",n.className="btn btn-primary btn-block",i.className="btn btn-default btn-block",n.innerHTML="Apply transform",i.innerHTML="Cancel",r.addEventListener("change",function(e){t.setTransformInterpolation(this.value)}),r.className="form-control chickenpaint-transform-interpolation",o(r,e),(0,x.isCanvasInterpolationSupported)()){var s=document.createElement("div"),l=document.createElement("label");l.innerHTML="Transform style",s.className="form-group",s.appendChild(l),s.appendChild(r),a.appendChild(s)}var d=document.createElement("div");d.appendChild(n),d.appendChild(i),d.className="form-group",a.appendChild(d),n.addEventListener("click",function(e){t.actionPerformed({action:"CPTransformAccept"}),e.preventDefault()}),i.addEventListener("click",function(e){t.actionPerformed({action:"CPTransformReject"}),e.preventDefault()})}Object.defineProperty(a,"__esModule",{value:!0}),a.default=s;var u=t("../ChickenPaint"),h=n(u),f=t("./CPPalette"),p=n(f),m=t("./CPCheckbox"),g=n(m),v=t("./CPColorSwatch"),y=n(v),E=t("./CPSlider"),w=n(E),P=t("./CPGUIUtils"),b=t("../engine/CPLayer"),C=n(b),T=t("../util/CPColor"),_=n(T),x=t("../util/CPPolyfill");s.prototype=Object.create(p.default.prototype),s.prototype.constructor=s,s.CPBrushPreview=function(t){function e(){r.clearRect(0,0,o.width,o.height),r.beginPath(),r.arc(o.width/2,o.height/2,i/2*window.devicePixelRatio,0,2*Math.PI),r.stroke()}function a(a){var n=$(o).offset(),r={x:a.pageX-n.left,y:a.pageY-n.top},s=r.x-$(o).width()/2,l=r.y-$(o).height()/2,d=Math.round(2*Math.sqrt(s*s+l*l));i=Math.max(1,Math.min(200,d)),e(),t.setBrushSize(i)}function n(t){s&&(s=!1,window.removeEventListener("mouseup",n),window.removeEventListener("mousemove",a))}var i=16,o=document.createElement("canvas"),r=o.getContext("2d"),s=!1;this.getElement=function(){return o},o.addEventListener("mousedown",function(t){s||(s=!0,window.addEventListener("mouseup",n),window.addEventListener("mousemove",a),a(t))}),t.on("toolChange",function(t,a){a.size!=i&&(i=a.size,e())}),o.width=64,o.height=64,window.devicePixelRatio>1&&(o.style.width=o.width+"px",o.style.height=o.height+"px",o.width=o.width*window.devicePixelRatio,o.height=o.height*window.devicePixelRatio),o.className="chickenpaint-brush-preview",r.strokeStyle="black",r.lineWidth=1*window.devicePixelRatio,e()},e.exports=a.default},{"../ChickenPaint":1,"../engine/CPLayer":11,"../util/CPColor":47,"../util/CPPolyfill":49,"./CPCheckbox":20,"./CPColorSwatch":24,"./CPGUIUtils":26,"./CPPalette":32,"./CPSlider":37}],19:[function(t,e,a){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function i(){this.modes=[]}function o(t){function e(){}function a(){}function n(){this.shouldPaintBrushPreview=!1,this.oldPreviewRect=null}function o(){n.call(this),this.smoothMouse={x:0,y:0}}function r(){var t,e,a=1;this.mouseDown=function(a,n,i){if(!this.capture&&n==ht&&!a.altKey&&!key.isPressed("space")&&O())return this.capture=!0,t=e={x:zt+.5,y:jt+.5},this.eraseBrushPreview(),!0},this.mouseDrag=function(n){if(this.capture){var i=new s.default(Math.min(t.x,e.x)-a-1,Math.min(t.y,e.y)-a-1,Math.max(t.x,e.x)+a+1+1,Math.max(t.y,e.y)+a+1+1);if(e={x:zt+.5,y:jt+.5},n.shiftKey){var o=Math.PI/4,r=Math.round(Math.atan2(e.y-t.y,e.x-t.x)/o);switch(r){case 0:case 4:e.y=t.y;break;case 2:case 6:e.x=t.x;break;default:r*=o;var l=Math.sqrt((e.y-t.y)*(e.y-t.y)+(e.x-t.x)*(e.x-t.x));e.x=t.x+l*Math.cos(r),e.y=t.y+l*Math.sin(r)}}return i.union(new s.default(Math.min(t.x,e.x)-a-1,Math.min(t.y,e.y)-a-1,Math.max(t.x,e.x)+a+1+1,Math.max(t.y,e.y)+a+1+1)),tt(i),!0}this.mouseMove.call(this,n)},this.mouseUp=function(n,i,o){if(this.capture&&i==ht){var r=B(t),l=B(e);this.capture=!1,this.drawLine(r,l);var d=new s.default(Math.min(t.x,e.x)-a-1,Math.min(t.y,e.y)-a-1,Math.max(t.x,e.x)+a+1+1,Math.max(t.y,e.y)+a+1+1);return tt(d),!0}},this.paint=function(){this.capture?(kt.lineWidth=a,kt.beginPath(),kt.moveTo(t.x,t.y),kt.lineTo(e.x,e.y),kt.stroke()):n.prototype.paint.call(this)},n.call(this)}function l(){var t,e,a,i,o=500,r=100,s=0;this.mouseDown=function(n,o,r){if(!this.capture&&o==ht&&!n.altKey&&!key.isPressed("space")&&O()){var l=B({x:zt,y:jt});return s=0,t=e=a=i=l,this.capture=!0,this.eraseBrushPreview(),!0}},this.mouseDrag=function(t){if(this.capture&&0==s){var e=B({x:zt,y:jt});return a=i=e,xt.repaintAll(),!0}this.mouseMove.call(this,t)},this.mouseUp=function(n,r,l){if(this.capture&&r==ht){if(0==s)s=1;else if(1==s)s=2;else if(2==s){this.capture=!1;var d=t,c=e,u=a,h=i,p=new f.default;p.x0=d.x,p.y0=d.y,p.x1=c.x,p.y1=c.y,p.x2=u.x,p.y2=u.y,p.x3=h.x,p.y3=h.y;var m=new Array(o),g=new Array(o);p.compute(m,g,o),It.beginStroke(m[0],g[0],1);for(var v=1;v<o;v++)It.continueStroke(m[v],g[v],1);It.endStroke(),xt.repaintAll()}return!0}},this.mouseMove=function(t,i){if(this.capture){var o=B({x:zt,y:jt});return 1==s?e=o:2==s&&(a=o),xt.repaintAll(),!0}n.prototype.mouseMove.call(this,t,i)},this.paint=function(){if(this.capture){var o=new f.default,s=F(t),l=F(e),d=F(a),c=F(i);o.x0=s.x,o.y0=s.y,o.x1=l.x,o.y1=l.y,o.x2=d.x,o.y2=d.y,o.x3=c.x,o.y3=c.y;var u=new Array(r),h=new Array(r);o.compute(u,h,r),kt.beginPath(),kt.moveTo(u[0],h[0]);for(var p=1;p<r;p++)kt.lineTo(u[p],h[p]);kt.moveTo(~~s.x,~~s.y),kt.lineTo(~~l.x,~~l.y),kt.moveTo(~~d.x,~~d.y),kt.lineTo(~~c.x,~~c.y),kt.stroke()}else n.prototype.paint.call(this)},n.call(this)}function c(){var a;this.mouseDown=function(t,e,n){return!!this.capture||(key.isPressed("space")||(e!=ht||this.transient&&!t.altKey)&&e!=pt?void(this.transient&&Jt.pop()):(a=e,this.capture=!0,L(wt),this.mouseDrag(t),!0))},this.mouseDrag=function(e){if(this.capture){var a=B({x:zt,y:jt});return It.isPointWithin(a.x,a.y)&&t.setCurColorRgb(It.colorPicker(a.x,a.y)),!0}},this.mouseUp=function(t,e,n){if(this.capture&&e==a)return a=-1,this.capture=!1,L(vt),this.transient&&Jt.pop(),!0},this.enter=function(){e.prototype.enter.call(this),a=-1}}function h(){var t,e,a,n;this.keyDown=function(t){if(32==t.keyCode)return this.capture||L(yt),!0},this.keyUp=function(t){if(this.transient&&n!=ft&&32==t.keyCode)return L(vt),Jt.pop(),!0},this.mouseDown=function(i,o,r){return!!this.capture||(o==ft||key.isPressed("space")&&o==ht?(this.capture=!0,n=o,t=i.pageX,e=i.pageY,a=xt.getOffset(),L(Et),!0):void(this.transient&&Jt.pop()))},this.mouseDrag=function(n){if(this.capture)return xt.setOffset(a.x+n.pageX-t,a.y+n.pageY-e),!0},this.mouseUp=function(t,e,a){if(this.capture&&e==n)return n=-1,this.capture=!1,this.transient&&!key.isPressed("space")&&(L(vt),Jt.pop()),!0},this.enter=function(){L(yt)}}function m(){}function y(){var t,e=new s.default(0,0,0,0),a=-1;this.mouseDown=function(n,i,o){if(!this.capture&&i==ht&&!n.altKey&&!key.isPressed("space")){var r=R({x:zt,y:jt});return a=i,e.makeEmpty(),t=r,xt.repaintAll(),this.capture=!0,!0}},this.mouseDrag=function(a){if(!this.capture)return!1;var n=R({x:zt,y:jt}),i=a.shiftKey,o=~~Math.max(Math.abs(n.x-t.x),Math.abs(n.y-t.y));return n.x>=t.x?(e.left=t.x,e.right=(i?t.x+o:n.x)+1):(e.left=i?t.x-o:n.x,e.right=t.x+1),n.y>=t.y?(e.top=t.y,e.bottom=(i?t.y+o:n.y)+1):(e.top=i?t.y-o:n.y,e.bottom=t.y+1),xt.repaintAll(),!0},this.mouseUp=function(t,n,i){if(this.capture&&n==a)return It.rectangleSelection(e),e.makeEmpty(),xt.repaintAll(),this.capture=!1,a=-1,!0},this.paint=function(){e.isEmpty()||(kt.lineWidth=1,U(kt,e))}}function w(){var t,e,a=!1;this.mouseDown=function(n,i,o){if(!this.capture&&i==ht&&!key.isPressed("space")&&O())return t=B({x:zt,y:jt}),e=n.altKey,a=!0,this.capture=!0,!0},this.mouseDrag=(0,p.throttle)(25,function(n){if(this.capture){var i=B({x:zt,y:jt}),o={x:i.x-t.x,y:i.y-t.y},r={x:~~o.x,y:~~o.y};return It.move(r.x,r.y,e&&a),a=!1,t.x=i.x-(o.x-r.x),t.y=i.y-(o.y-r.y),!0}}),this.mouseUp=function(t,e,a){if(this.capture&&e==ht)return this.capture=!1,this.transient&&Jt.pop(),!0}}function C(){function a(){return h.getTransformed(Ut)}function n(t,e){return{x:(t.x+e.x)/2,y:(t.y+e.y)/2}}function i(t){return{x:Math.round(t.x),y:Math.round(t.y)}}function o(t,e){for(var a=7,n=a*a,i=a,o=i*i,r=0;r<t.points.length;r++)if((e.x-t.points[r].x)*(e.x-t.points[r].x)+(e.y-t.points[r].y)*(e.y-t.points[r].y)<=n)return 2*r;for(var r=0;r<t.points.length;r++){var s=t.points[r],l=t.points[(r+1)%t.points.length],d=new x.default(l.x-s.x,l.y-s.y),c=new x.default(e.x-s.x,e.y-s.y),u=d.getLength(),h=d.getScaled(1/u),f=c.getScaled(1/u),p=h.getDotProduct(f);if(p>=0&&p<=1&&(d.scale(p),(d.x-c.x)*(d.x-c.x)+(d.y-c.y)*(d.y-c.y)<=o))return 2*r+1}return t.containsPoint(e)?P:w}function r(){var t=a(),e={x:zt,y:jt},n=o(t,e);switch(n){case b:case T:case S:case M:var i=~~(n/2),r=t.points[(i+3)%4],l=t.points[i],d=t.points[(i+1)%4],c=x.default.subtractPoints(r,l).normalize().add(x.default.subtractPoints(d,l).normalize());s(c);break;case C:case _:case O:case k:var u=t.points[~~(n/2)],h=t.points[(~~(n/2)+1)%4],f=x.default.subtractPoints(h,u).getPerpendicular();s(f);break;case P:L(Pt);break;case w:L(vt);break;default:L(vt)}}function s(t){var e=Math.atan2(-t.y,t.x),a=Math.floor(e/(Math.PI/4)+.5),n=void 0;switch(a<0&&(a+=4),a){case 0:default:n=_t;break;case 1:n=bt;break;case 2:n=Tt;break;case 3:n=Ct}L(n)}var l,c,u,h,f,m,v,y=3,E=-1,w=-2,P=-3,b=0,C=1,T=2,_=3,S=4,O=5,M=6,k=7,A=E;this.mouseDown=function(t,e,n){if(!this.capture&&e==ht&&!t.altKey&&!key.isPressed("space")){var i=a();return A=o(i,{x:zt,y:jt}),f={x:zt,y:jt},m=B(f),this.capture=!0,r(),!0}},this.mouseDrag=(0,p.throttle)(40,function(t){var e=.001;if(this.capture){var a={x:zt,y:jt};switch(A){case P:var o=i(B(a)),r=x.default.subtractPoints(o,m),s=r.getTruncated(),c=r.subtract(s),p=new d.default;p.translate(s.x,s.y),l.preMultiply(p),m=x.default.subtractPoints(o,c);break;case w:var g=Math.PI/4,y=h.getCenter(),E=F(y),L=Math.atan2(f.y-E.y,f.x-E.x),R=Math.atan2(a.y-E.y,a.x-E.x),I=R-L,N=void 0,D=new d.default;v+=I,N=t.shiftKey?-l.decompose().rotate+Math.round(v/g)*g:I,D.rotateAroundPoint(N,y.x,y.y),l.preMultiply(D),f=a;break;case b:case T:case S:case M:var Y=~~(A/2),U=u.points[Y],H=l.getInverted().getTransformedPoint(i(B(a))),W=u.points[(Y+2)%4],X=(H.x-W.x)/(U.x-W.x),z=(H.y-W.y)/(U.y-W.y);if(Math.abs(X)<e||Math.abs(z)<e||isNaN(X)||isNaN(z))return!0;if(t.shiftKey){var j=Math.max(X,z);X=j,z=j}l.scaleAroundPoint(X,z,W.x,W.y);break;case C:case O:case _:case k:var $=~~(A/2),G=n(u.points[$],u.points[($+1)%4]),q=l.getInverted().getTransformedPoint(i(B(a))),V=n(u.points[($+2)%4],u.points[($+3)%4]),Z=void 0,K=void 0,Q=x.default.subtractPoints(G,V),J=x.default.subtractPoints(q,V),tt=Q.getLength(),et=Q.getDotProduct(J)/tt,at=et/tt;if(Math.abs(at)<e||isNaN(at))return!0;A==C||A==O?(Z=1,K=at):(Z=at,K=1),l.scaleAroundPoint(Z,K,V.x,V.y)}return h=u.getTransformed(l),It.transformAffineAmend(l),xt.repaintAll(),!0}}),this.mouseUp=function(t,e,a){if(this.capture&&e==ht)return this.capture=!1,A=E,!0},this.mouseMove=function(){this.capture||r()},this.paint=function(){for(var t=a().points,e=new Array(2*t.length),n=0;n<t.length;n++)e[n]=t[n];for(var n=0;n<t.length;n++){var i=t[n],o=t[(n+1)%t.length],r={x:(i.x+o.x)/2,y:(i.y+o.y)/2};e[n+t.length]=r}et(kt,"fill");for(var n=0;n<e.length;n++)kt.fillRect(e[n].x-y,e[n].y-y,2*y+1,2*y+1);Y(kt,t)},this.keyDown=function(e){return 13==e.keyCode?(t.actionPerformed({action:"CPTransformAccept"}),!0):27==e.keyCode?(t.actionPerformed({action:"CPTransformReject"}),!0):void 0},this.enter=function(){e.prototype.enter.call(this);var t,a=It.transformAffineBegin();l=a.transform,c=a.rect,t=a.selection,t.isEmpty()&&(t=a.rect.clone()),u=new g.default(t.toPoints()),h=u.getTransformed(l),A=-1,v=0,xt.repaintAll()},this.leave=function(){e.prototype.leave.call(this),xt.repaintAll()}}function _(){function t(){var t=5,e=Math.round(Yt/(Math.PI/2))*Math.PI/2;if(Math.abs(Yt-e)<t/180*Math.PI){var i=e-n,o={x:Mt.width/2,y:Mt.height/2},r=new d.default;r.rotateAroundPoint(i,o.x,o.y),r.multiply(a),xt.setRotation(n+i),xt.setOffset(~~r.getTranslateX(),~~r.getTranslateY()),xt.repaintAll()}}var e,a,n=0,i=!1,o=-1;this.mouseDown=function(t,r,s){return!!this.capture||(!this.transient&&r==ht&&!t.altKey&&!key.isPressed("space")||t.altKey&&(r==ft||r==ht&&key.isPressed("space"))?(e={x:zt,y:jt},n=xt.getRotation(),a=Ut.clone(),i=!1,this.capture=!0,o=r,!0):void(this.transient&&Jt.pop()))},this.mouseDrag=function(t){if(this.capture){var o={x:zt,y:jt},r={x:$(Mt).width()/2,y:$(Mt).height()/2},s={x:Mt.width/2,y:Mt.height/2},l=Math.atan2(o.y-r.y,o.x-r.x)-Math.atan2(e.y-r.y,e.x-r.x),c=new d.default;return c.rotateAroundPoint(l,s.x,s.y),c.multiply(a),xt.setRotation(n+l),xt.setOffset(~~c.getTranslateX(),~~c.getTranslateY()),i=!0,!0}},this.mouseUp=function(e,a,n){if(this.capture&&a==o)return i?t():xt.resetRotation(),this.capture=!1,!this.transient||key.isPressed("space")&&key.alt||Jt.pop(),!0},this.keyUp=function(t){if(this.transient&&o!=ft&&32==t.keyCode)return L(vt),Jt.pop(),!0},this.keyDown=function(t){if(32==t.keyCode&&t.altKey)return!0}}function S(){r.call(this)}function L(t){Mt.getAttribute("data-cursor")!=t&&Mt.setAttribute("data-cursor",t)}function O(){var e=It.getActiveLayer();return e.visible?0!=e.alpha||(t.showLayerNotification(It.getActiveLayerIndex(),"Whoops! This layer's opacity is currently 0%","opacity"),!1):(t.showLayerNotification(It.getActiveLayerIndex(),"Whoops! This layer is currently hidden","layer"),!1)}function M(t,e,a,n,i){var o=e-n-i+a/4,r=e+a-i-a/4;t.setValues(-i,n,o,r),t.setBlockIncrement(Math.max(1,~~(.66*n))),t.setUnitIncrement(Math.max(1,~~(.05*n)))}function k(){if(null!=te&&null!=ee&&!te.getValueIsAdjusting()&&!ee.getValueIsAdjusting()){var t=H(new s.default(0,0,At.width,At.height));M(te,t.left,t.getWidth(),$(Mt).width(),xt.getOffset().x),M(ee,t.top,t.getHeight(),$(Mt).height(),xt.getOffset().y)}}function A(){Ut.setToIdentity(),Ut.translate(Nt,Dt),Ut.scale(Ft,Ft),Ut.rotate(Yt),k(),xt.repaintAll()}function B(t){return Ut.getInverted().getTransformedPoint(t)}function R(t){var e=B(t);return e.x=Math.floor(e.x),e.y=Math.floor(e.y),e}function I(t){var e=Mt.getBoundingClientRect();return{x:t.x-e.left-window.pageXOffset,y:t.y-e.top-window.pageYOffset}}function F(t){return Ut.getTransformedPoint(t)}function N(t){var e=F(t);return e.x=Math.round(e.x),e.y=Math.round(e.y),e}function D(t){for(var e=F({x:(t.left+t.right)/2,y:(t.top+t.bottom)/2}),a=t.toPoints(),n=0;n<a.length;n++)a[n]=N(a[n]),a[n].x+=.5*Math.sign(e.x-a[n].x),a[n].y+=.5*Math.sign(e.y-a[n].y);return a}function Y(t,e){t.beginPath(),t.moveTo(e[0].x,e[0].y);for(var a=1;a<e.length;a++)t.lineTo(e[a].x,e[a].y);t.lineTo(e[0].x,e[0].y),t.stroke()}function U(t,e){Y(t,D(e))}function H(t){var e=N({x:t.left-1,y:t.top-1}),a=N({x:t.left-1,y:t.bottom}),n=N({x:t.right,y:t.top-1}),i=N({x:t.right,y:t.bottom}),o=new s.default(Math.min(Math.min(e.x,a.x),Math.min(n.x,i.x)),Math.min(Math.min(e.y,a.y),Math.min(n.y,i.y)),Math.max(Math.max(e.x,a.x),Math.max(n.x,i.x))+1,Math.max(Math.max(e.y,a.y),Math.max(n.y,i.y))+1);return o.grow(2,2),o}function W(){var t=Mt.width,e=Mt.height,a=F({x:It.width/2,y:It.height/2});xt.setOffset(Math.round(Nt+t/2-a.x),Math.round(Dt+e/2-a.y))}function X(t,e,a){if(t=Math.max(mt,Math.min(gt,t)),xt.getZoom()!=t){var n=xt.getOffset();xt.setOffset(n.x+~~((e-n.x)*(1-t/xt.getZoom())),n.y+~~((a-n.y)*(1-t/xt.getZoom()))),xt.setZoom(t),xt.repaintAll()}}function z(t){var e=$(Mt).width(),a=$(Mt).height();X(t,e/2,a/2)}function j(t){return qt?ae.getPressure():2*t.pressure}function G(t){if(0!=t.deltaY){if(!ie||Math.abs(t.deltaY)>20){var e;e=t.deltaY>0?1/1.15:1.15;var a=I({x:t.pageX,y:t.pageY}),n=B(a);It.isPointWithin(n.x,n.y)?X(xt.getZoom()*e,a.x,a.y):X(xt.getZoom()*e,Nt+~~(It.width*Ft/2),Dt+~~(It.height*Ft/2)),ie=ie||setTimeout(function(){ie=!1},50)}t.preventDefault()}}function q(t){ne||(ne=Mt.getBoundingClientRect()),zt=t.clientX-ne.left,jt=t.clientY-ne.top;var e=1,a=2,n=4,i=0!=t.buttons,o=j(t);if(0!=(t.buttons&e)!=Gt[ht]){if(.5===t.mozPressure)return;Gt[ht]=!Gt[ht],Gt[ht]?Jt.mouseDown(t,ht,o):Jt.mouseUp(t,ht,o)}0!=(t.buttons&a)!=Gt[pt]&&(Gt[pt]=!Gt[pt],Gt[pt]?Jt.mouseDown(t,pt,o):Jt.mouseUp(t,pt,o)),0!=(t.buttons&n)!=Gt[ft]&&(Gt[ft]=!Gt[ft],Gt[ft]?Jt.mouseDown(t,ft,o):Jt.mouseUp(t,ft,o)),i?Jt.mouseDrag(t,o):Jt.mouseMove(t,o)}function V(t){Gt[ht]=!1,Gt[pt]=!1,Gt[ft]=!1,qt=!1,Jt.mouseUp(t,t.button,0),Mt.releasePointerCapture(t.pointerId)}function Z(t){Mt.setPointerCapture(t.pointerId),ne=Mt.getBoundingClientRect(),zt=t.clientX-ne.left,jt=t.clientY-ne.top,qt=ae.isPen(),Gt[ht]=!1,Gt[pt]=!1,Gt[ft]=!1,Gt[t.button]=!0,Jt.mouseDown(t,t.button,j(t))}function K(t){Jt.keyDown(t)}function Q(t){Jt.keyUp(t)}function J(){Kt||(Kt=!0,window.requestAnimationFrame(function(){xt.paint()}))}function tt(t){Zt.union(t),J()}function et(t,e){e+="Style",t.globalCompositeOperation="exclusion","exclusion"==t.globalCompositeOperation?t[e]="white":(t.globalCompositeOperation="difference",t[e]="#888","difference"!=t.globalCompositeOperation&&(t[e]="black"))}var at,nt,it,ot,rt,st,lt,dt,ct,ut,ht=0,ft=1,pt=2,mt=.1,gt=16,vt="default",yt="grab",Et="grabbing",wt="crosshair",Pt="move",bt="nesw-resize",Ct="nwse-resize",Tt="ns-resize",_t="ew-resize",xt=this,St=document.createElement("div"),Lt=document.createElement("div"),Ot=document.createElement("div"),Mt=document.createElement("canvas"),kt=Mt.getContext("2d"),At=document.createElement("canvas"),Bt=At.getContext("2d"),Rt=(0,b.createCheckerboardPattern)(kt),It=t.getArtwork(),Ft=1,Nt=0,Dt=0,Yt=0,Ut=new d.default,Ht=!1,Wt=!1,Xt=32,zt=0,jt=0,$t=!1,Gt=[!1,!1,!1],qt=!1,Vt=new s.default(0,0,It.width,It.height),Zt=new s.default(0,0,0,0),Kt=!1,Qt=[],Jt=new i,te=new T.default((!1)),ee=new T.default((!0)),ae=u.default.getRef();Math.sign=Math.sign||function(t){return t=+t,0===t||isNaN(t)?t:t>0?1:-1},e.prototype.transient=!1,e.prototype.capture=!1,e.prototype.enter=function(){L(vt)},e.prototype.leave=function(){this.capture=!1},e.prototype.mouseMove=e.prototype.paint=e.prototype.mouseDown=e.prototype.mouseDrag=e.prototype.mouseUp=e.prototype.keyDown=e.prototype.suspend=e.prototype.resume=e.prototype.keyUp=function(){},a.prototype=Object.create(e.prototype),a.prototype.constructor=a,a.prototype.mouseDown=function(t,e,a){var n=key.isPressed("space");!n&&(e==pt||e==ht&&t.altKey)?(Jt.push(nt,!0),Jt.peek().mouseDown(t,e,a)):(e==ft||n&&e==ht)&&(t.altKey?(Jt.push(ot,!0),Jt.peek().mouseDown(t,e,a)):(Jt.push(it,!0),Jt.peek().mouseDown(t,e,a)))},a.prototype.keyDown=function(t){if(32==t.keyCode)return t.altKey?(Jt.push(ot,!0),Jt.peek().keyDown(t)):(Jt.push(it,!0),Jt.peek().keyDown(t)),!0},n.prototype=Object.create(e.prototype),n.prototype.constructor=n,n.prototype.getBrushPreviewOval=function(){var e=t.getBrushSize()*Ft;return new s.default(zt-e/2,jt-e/2,zt+e/2,jt+e/2)},n.prototype.queueBrushPreview=function(){if(Jt.peek()==this){this.shouldPaintBrushPreview=!0;var t=this.getBrushPreviewOval();t.grow(2,2),null!=this.oldPreviewRect&&(t.union(this.oldPreviewRect),this.oldPreviewRect=null),tt(t)}},n.prototype.eraseBrushPreview=function(){this.shouldPaintBrushPreview=!1,null!=this.oldPreviewRect&&(tt(this.oldPreviewRect),this.oldPreviewRect=null)},n.prototype.mouseMove=function(t,e){this.queueBrushPreview()},n.prototype.enter=function(){e.prototype.enter.call(this),$t&&this.queueBrushPreview()},n.prototype.leave=function(){e.prototype.leave.call(this),this.eraseBrushPreview()},n.prototype.suspend=n.prototype.leave,n.prototype.resume=n.prototype.enter,n.prototype.paint=function(){if(this.shouldPaintBrushPreview){this.shouldPaintBrushPreview=!1;var t=this.getBrushPreviewOval();kt.beginPath(),kt.arc((t.left+t.right)/2,(t.top+t.bottom)/2,t.getWidth()/2,0,2*Math.PI),kt.stroke(),t.grow(2,2),null==this.oldPreviewRect?this.oldPreviewRect=t:this.oldPreviewRect.union(t)}},o.prototype=Object.create(n.prototype),o.prototype.constructor=o,o.prototype.mouseDown=function(t,e,a){if(!this.capture&&e==ht&&!t.altKey&&!key.isPressed("space")&&O()){var n=B({x:zt,y:jt});return this.eraseBrushPreview(),this.capture=!0,It.beginStroke(n.x,n.y,a),this.smoothMouse=n,!0}},o.prototype.mouseDrag=function(e,a){if(this.capture){var n=B({x:zt,y:jt}),i=Math.min(.999,Math.pow(t.getBrushInfo().smoothing,.3));return this.smoothMouse.x=(1-i)*n.x+i*this.smoothMouse.x,this.smoothMouse.y=(1-i)*n.y+i*this.smoothMouse.y,It.continueStroke(this.smoothMouse.x,this.smoothMouse.y,a),!0}this.mouseMove(e)},o.prototype.mouseUp=function(t,e,a){if(this.capture)return e==ht&&(this.capture=!1,It.endStroke()),!0},r.prototype=Object.create(n.prototype),r.prototype.constructor=r,r.prototype.drawLine=function(t,e){It.beginStroke(t.x,t.y,1),It.continueStroke(e.x,e.y,1),It.endStroke()},l.prototype=Object.create(n.prototype),l.prototype.constructor=l,c.prototype=Object.create(e.prototype),c.prototype.constructor=c,h.prototype=Object.create(e.prototype),h.prototype.constructor=m,m.prototype=Object.create(e.prototype),m.prototype.constructor=m,m.prototype.mouseDown=function(t,e,a){if(e==ht&&!t.altKey&&!key.isPressed("space")&&O()){var n=B({x:zt,y:jt});return It.isPointWithin(n.x,n.y)&&(It.floodFill(n.x,n.y),xt.repaintAll()),!0}},y.prototype=Object.create(e.prototype),y.prototype.constructor=y,w.prototype=Object.create(e.prototype),w.prototype.constructor=w,w.prototype.mouseMove=function(t){if(!key.isPressed("space")&&!t.altKey)return L(Pt),!0},w.prototype.enter=function(){L(Pt)},C.prototype=Object.create(e.prototype),C.prototype.constructor=C,_.prototype=Object.create(e.prototype),_.prototype.constructor=_,S.prototype=Object.create(r.prototype),S.prototype.constructor=S,S.prototype.drawLine=function(e,a){It.gradientFill(Math.round(e.x),Math.round(e.y),Math.round(a.x),Math.round(a.y),t.getCurGradient())},S.prototype.queueBrushPreview=function(){},this.setZoom=function(t){Ft=t,A()},this.getZoom=function(){return Ft},this.setGridSize=function(t){Xt=Math.max(Math.round(t),1),this.repaintAll()},this.getGridSize=function(){return Xt},this.setOffset=function(t,e){isNaN(t)||isNaN(e)?console.log("Bad offset"):(Nt=t,Dt=e,A())},this.getOffset=function(){return{x:Nt,y:Dt}},this.setInterpolation=function(t){Ht=t,(0,v.setCanvasInterpolation)(kt,t),this.repaintAll()},this.setRotation=function(t){Yt=t%(2*Math.PI),A()},this.getRotation=function(){return Yt},this.getRotation90=function(){var t=Math.round(this.getRotation()/Math.PI*2);return t%=4,t<0&&(t+=4),t},this.zoomIn=function(){z(2*this.getZoom())},this.zoomOut=function(){z(.5*this.getZoom())},this.zoom100=function(){z(1),W()},this.resetRotation=function(){var t={x:Mt.width/2,y:Mt.height/2},e=new d.default;e.rotateAroundPoint(-this.getRotation(),t.x,t.y),e.multiply(Ut),this.setOffset(~~e.getTranslateX(),~~e.getTranslateY()),this.setRotation(0)};var ne,ie=!1;this.getElement=function(){return St},this.repaintAll=function(){Zt.left=0,Zt.top=0,Zt.right=Mt.width,Zt.bottom=Mt.height,J()},this.paint=function(){var t=!1;if(Kt=!1,Zt.isEmpty()||(kt.save(),kt.clip&&(kt.beginPath(),Zt.left=0|Zt.left,Zt.top=0|Zt.top,kt.rect(Zt.left,Zt.top,Math.ceil(Zt.getWidth()),Math.ceil(Zt.getHeight())),kt.clip()),t=!0),!Vt.isEmpty()){var e=It.fusionLayers();Bt.putImageData(e,0,0,Vt.left,Vt.top,Vt.getWidth(),Vt.getHeight()),Vt.makeEmpty()}if(kt.fillStyle="#606060",kt.fillRect(0,0,Mt.width,Mt.height),kt.save(),kt.setTransform(Ut.m[0],Ut.m[1],Ut.m[2],Ut.m[3],Ut.m[4],Ut.m[5]),kt.fillStyle=Rt,kt.fillRect(0,0,It.width,It.height),kt.drawImage(At,0,0,At.width,At.height),kt.restore(),et(kt,"stroke"),kt.lineWidth=1,It.getSelection().isEmpty()||Jt.peek()instanceof y&&Jt.peek().capture||(kt.setLineDash([3,2]),U(kt,It.getSelection()),kt.setLineDash([])),Wt){var a=It.getBounds(),n=Ft*Xt;if(n>2){kt.beginPath();for(var i=Xt-1;i<a.right;i+=Xt){var o=F({x:i,y:a.top}),r=F({x:i,y:a.bottom});kt.moveTo(o.x+.5,o.y+.5),kt.lineTo(r.x+.5,r.y+.5)}for(var i=Xt-1;i<a.bottom;i+=Xt){var o=F({x:0,y:i}),r=F({x:a.right,y:i});kt.moveTo(o.x+.5,o.y+.5),kt.lineTo(r.x+.5,r.y+.5)}kt.stroke()}}Jt.paint(kt),kt.globalCompositeOperation="source-over",t&&(Zt.makeEmpty(),kt.restore())},this.showGrid=function(t){Wt=t,this.repaintAll()},this.resize=function(t,e){t-=$(Ot).outerHeight(),$(Mt).css("height",t+"px"),Mt.width=$(Mt).width(),Mt.height=t,ne=null,e||W(),this.setInterpolation(Ht),this.repaintAll()},t.on("toolChange",function(t,e){for(var a=Qt[e.strokeMode],i=0;i<Jt.modes.length;i++)if(Jt.modes[i]instanceof n){Jt.modes[i].leave(),Jt.modes[i]=a,Jt.modes[i].enter();break}ut=a}),t.on("modeChange",function(t){var e;switch(t){case E.default.M_DRAW:e=ut;break;case E.default.M_FLOODFILL:e=rt;break;case E.default.M_GRADIENTFILL:e=st;break;case E.default.M_RECT_SELECTION:e=lt;break;case E.default.M_MOVE_TOOL:e=dt;break;case E.default.M_ROTATE_CANVAS:e=ot;break;case E.default.M_COLOR_PICKER:e=nt;break;case E.default.M_TRANSFORM:e=ct}Jt.setUserMode(e)}),at=new a,nt=new c,it=new h,ot=new _,rt=new m,st=new S,lt=new y,dt=new w,ct=new C,Qt=[new o,new r,new l],ut=Qt[P.default.SM_FREEHAND],Jt.setDefaultMode(at),Jt.setUserMode(ut),At.width=It.width,At.height=It.height,Mt.width=800,Mt.height=900,Mt.className="chickenpaint-canvas",Mt.setAttribute("touch-action","none"),kt.setLineDash||(kt.setLineDash=function(){}),Mt.addEventListener("contextmenu",function(t){t.preventDefault()}),Mt.addEventListener("mouseenter",function(){$t=!0}),Mt.addEventListener("mouseleave",function(){$t=!1,Gt[ht]||Gt[pt]||Gt[ft]||xt.repaintAll()}),Mt.addEventListener("pointerdown",Z),Mt.addEventListener("pointermove",q),Mt.addEventListener("pointerup",V),Mt.addEventListener("wheel",G),document.addEventListener("keydown",K),document.addEventListener("keyup",Q),document.addEventListener("visibilitychange",function(){var t=Mt.height+$(Ot).outerHeight();Mt.width=1,Mt.height=1,xt.resize(t,!0)},!1),window.addEventListener("scroll",function(){ne=null}),Mt.addEventListener("mousedown",function(t){t.button==ft&&t.preventDefault()}),It.on("changeSelection",function(){xt.repaintAll()}),It.on("updateRegion",function(t){Vt.union(t),tt(H(Vt))}),te.on("valueChanged",function(t){var e=xt.getOffset();xt.setOffset(-t,e.y)}),ee.on("valueChanged",function(t){var e=xt.getOffset();xt.setOffset(e.x,-t)}),this.setInterpolation(!1);var oe=document.createElement("div");oe.className="chickenpaint-canvas-container-wrapper",oe.appendChild(Mt),Lt.className="chickenpaint-canvas-container-top",Lt.appendChild(oe),Lt.appendChild(ee.getElement()),Ot.className="chickenpaint-canvas-container-bottom",Ot.appendChild(te.getElement()),St.appendChild(Lt),St.appendChild(Ot),t.setCanvas(this)}Object.defineProperty(a,"__esModule",{value:!0}),a.default=o;var r=t("../util/CPRect"),s=n(r),l=t("../util/CPTransform"),d=n(l),c=t("../util/CPWacomTablet"),u=n(c),h=t("../util/CPBezier"),f=n(h),p=t("../util/throttle-debounce"),m=t("../util/CPPolygon"),g=n(m),v=t("../util/CPPolyfill"),y=t("../ChickenPaint"),E=n(y),w=t("../engine/CPBrushInfo"),P=n(w),b=t("./CPGUIUtils"),C=t("./CPScrollbar"),T=n(C),_=t("../util/CPVector"),x=n(_);i.MODE_INDEX_DEFAULT=0,i.MODE_INDEX_USER=1,i.prototype.setMode=function(t,e){var a=this.modes[t];a!=e&&(a&&a.leave(),this.modes[t]=e,e.enter())},i.prototype.setDefaultMode=function(t){t.transient=!1,t.capture=!1,this.setMode(i.MODE_INDEX_DEFAULT,t)},i.prototype.setUserMode=function(t){for(var e=this.modes.length-1;e>i.MODE_INDEX_USER;e--)this.modes[e].leave(),this.modes.splice(e,1);t.transient=!1,t.capture=!1,this.setMode(i.MODE_INDEX_USER,t)},i.prototype.deliverEvent=function(t,e){for(var a=this.modes.length-1;a>=0;a--){var n=this.modes[a];if(n[t].apply(n,e)||n.capture&&"paint"!=t)return!0}return!1};for(var S=["mouseDown","mouseUp"],L=function(){var t=S[O];i.prototype[t]=function(e,a,n){this.deliverEvent(t,[e,a,n])}},O=0;O<S.length;O++)L();for(var M=["mouseDrag","mouseMove"],k=function(){var t=M[A];i.prototype[t]=function(e,a){this.deliverEvent(t,[e,a])}},A=0;A<M.length;A++)k();for(var B=["keyDown","keyUp"],R=function(){var t=B[I];i.prototype[t]=function(e){this.deliverEvent(t,[e])&&e.preventDefault()}},I=0;I<B.length;I++)R();i.prototype.paint=function(t){this.deliverEvent("paint",[t])},i.prototype.push=function(t,e){var a=this.peek();a&&a.suspend(),t.transient=e,t.capture=!1,t.enter(),this.modes.push(t)},i.prototype.peek=function(){return this.modes.length>0?this.modes[this.modes.length-1]:null},i.prototype.pop=function(){var t=this.modes.pop(),e=this.peek();return t&&t.leave(),e&&e.resume(),e},e.exports=a.default},{"../ChickenPaint":1,"../engine/CPBrushInfo":5,"../util/CPBezier":46,"../util/CPPolyfill":49,"../util/CPPolygon":50,"../util/CPRect":52,"../util/CPTransform":53,"../util/CPVector":54,"../util/CPWacomTablet":55,"../util/throttle-debounce":56,"./CPGUIUtils":26,"./CPScrollbar":34}],20:[function(t,e,a){"use strict";function n(t,e){function a(){var t=n.width,e=n.height;i.clearRect(0,0,t,e),i.beginPath(),i.arc(t/2+1,t/2+1,Math.max(t/2,1)-2,0,2*Math.PI),o.state?i.fill():i.stroke()}var n=document.createElement("canvas"),i=n.getContext("2d"),o=this;this.state=t||!1,this.setValue=function(t){this.state!=t&&(this.state=t,this.emitEvent("valueChange",[t]),a())},this.getElement=function(){return n},n.addEventListener("mousedown",function(t){o.setValue(!o.state)}),n.title=e||"",n.className="chickenpaint-checkbox",n.width=20,n.height=20,n.fillStyle="black",n.strokeStyle="black",a()}Object.defineProperty(a,"__esModule",{value:!0}),a.default=n,n.prototype=Object.create(EventEmitter.prototype),n.prototype.constructor=n,e.exports=a.default},{}],21:[function(t,e,a){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function i(t){s.default.call(this,t,"color","Color");var e=new d.default(t),a=new u.default(t,e),n=new o(t),i=this.getBodyElement(),r=document.createElement("div");r.className="chickenpaint-colorpicker-top",r.appendChild(e.getElement()),r.appendChild(a.getElement()),i.appendChild(r),i.appendChild(n.getElement())}function o(t){function e(t,e,a){for(;t.length<a;)t=e+t;return t}function a(){o.style.backgroundColor="#"+e(Number(i).toString(16),"0",6)}function n(a){a.preventDefault();var n="#"+e(Number(i).toString(16),"0",6);
if(n=window.prompt("Please enter a color in hex format",n),null!=n)try{(n.match(/^#/)||n.match(/^$/))&&(n=n.substring(1));var o=parseInt(n,16);t.setCurColor(new f.default(o))}catch(t){}}var i=0,o=document.createElement("div");this.getElement=function(){return o},t.on("colorChange",function(t){i=t.getRgb(),a()}),o.className="chickenpaint-colorpicker-show",o.addEventListener("click",n),a()}Object.defineProperty(a,"__esModule",{value:!0}),a.default=i;var r=t("./CPPalette"),s=n(r),l=t("./CPColorSelect"),d=n(l),c=t("./CPColorSlider"),u=n(c),h=t("../util/CPColor"),f=n(h);i.prototype=Object.create(s.default.prototype),i.prototype.constructor=i,e.exports=a.default},{"../util/CPColor":47,"./CPColorSelect":22,"./CPColorSlider":23,"./CPPalette":32}],22:[function(t,e,a){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function i(t,e){function a(){for(var t=g.clone(),e=0,a=0;a<u;a++){t.setValue(255-255*a/u);for(var n=0;n<c;n++)t.setSaturation(255*n/c),m[e+l.default.RED_BYTE_OFFSET]=t.rgb>>16&255,m[e+l.default.GREEN_BYTE_OFFSET]=t.rgb>>8&255,m[e+l.default.BLUE_BYTE_OFFSET]=255&t.rgb,m[e+l.default.ALPHA_BYTE_OFFSET]=255,e+=l.default.BYTES_PER_PIXEL}v=!1}function n(){v&&a(),f.putImageData(p,0,0,0,0,c,u);var t=g.getSaturation()*c/255,e=(255-g.getValue())*u/255;f.globalCompositeOperation="exclusion",f.strokeStyle="white",f.lineWidth=1.5,f.beginPath(),f.arc(t,e,5,0,2*Math.PI),f.stroke(),f.globalCompositeOperation="source-over"}function i(e){var a=e.pageX-$(h).offset().left,i=e.pageY-$(h).offset().top,o=255*a/c,r=255-255*i/u;g.setSaturation(Math.max(0,Math.min(255,o))),g.setValue(Math.max(0,Math.min(255,r))),n(),t.setCurColor(g)}function o(t){i(t)}function s(t){h.releasePointerCapture(t.pointerId),y=!1,h.removeEventListener("pointerup",s),h.removeEventListener("pointermove",o)}function d(t){y||(y=!0,h.setPointerCapture(t.pointerId),h.addEventListener("pointerup",s),h.addEventListener("pointermove",o)),i(t)}var c=128,u=128,h=document.createElement("canvas"),f=h.getContext("2d"),p=f.createImageData(c,u),m=p.data,g=new r.default,v=!0,y=!1;this.setHue=function(e){g.getHue()!=e&&(g.setHue(e),t.setCurColor(g))},this.getElement=function(){return h},t.on("colorChange",function(t){g.copyFrom(t),v=!0,n()}),h.addEventListener("pointerdown",d),h.className="chickenpaint-colorpicker-select",h.setAttribute("touch-action","none"),h.width=c,h.height=u,e&&g.copyFrom(e),n()}Object.defineProperty(a,"__esModule",{value:!0}),a.default=i;var o=t("../util/CPColor"),r=n(o),s=t("../engine/CPColorBmp"),l=n(s);e.exports=a.default},{"../engine/CPColorBmp":9,"../util/CPColor":47}],23:[function(t,e,a){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function i(t,e,a){function n(){var t=new r.default,e=0;t.setRgbComponents(0,255,255);for(var a=0;a<f;a++){t.setHue(359*a/f);for(var n=0;n<h;n++)v[e+l.default.RED_BYTE_OFFSET]=t.rgb>>16&255,v[e+l.default.GREEN_BYTE_OFFSET]=t.rgb>>8&255,v[e+l.default.BLUE_BYTE_OFFSET]=255&t.rgb,v[e+l.default.ALPHA_BYTE_OFFSET]=255,e+=l.default.BYTES_PER_PIXEL}}function i(){m.putImageData(g,0,0,0,0,h,f);var t=E*f/360;m.globalCompositeOperation="exclusion",m.strokeStyle="white",m.lineWidth=1.5,m.beginPath(),m.moveTo(0,t),m.lineTo(h,t),m.stroke(),m.globalCompositeOperation="source-over"}function o(t){var a=t.pageY-$(p).offset().top,n=~~(360*a/f);E=Math.max(0,Math.min(359,n)),i(),null!=e&&e.setHue(E)}function s(t){o(t)}function d(t){p.releasePointerCapture(t.pointerId),y=!1,p.removeEventListener("pointerup",d),p.removeEventListener("pointermove",s)}function c(t){y||(y=!0,p.setPointerCapture(t.pointerId),p.addEventListener("pointerup",d),p.addEventListener("pointermove",s)),o(t)}var u=this,h=24,f=128,p=document.createElement("canvas"),m=p.getContext("2d"),g=m.createImageData(h,f),v=g.data,y=!1,E=a||0;this.getElement=function(){return p},this.setHue=function(t){E=t,i()},t.on("colorChange",function(t){u.setHue(t.getHue())}),p.setAttribute("touch-action","none"),p.addEventListener("pointerdown",c),p.width=h,p.height=f,p.className="chickenpaint-colorpicker-slider",n(),i()}Object.defineProperty(a,"__esModule",{value:!0}),a.default=i;var o=t("../util/CPColor"),r=n(o),s=t("../engine/CPColorBmp"),l=n(s);e.exports=a.default},{"../engine/CPColorBmp":9,"../util/CPColor":47}],24:[function(t,e,a){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function i(t,e){function a(t,e,a){for(;t.length<a;)t=e+t;return t}function n(){p.style.backgroundColor="#"+a(Number(u.getRgb()).toString(16),"0",6)}function i(t){t.preventDefault()}function o(){var t=document.createElement("div"),e=document.createElement("div"),a=new c.default(d,u),n=new h.default(d,a,u.getHue()),i=new l.default(0,255);return t.className="chickenpaint-color-pick-panel",e.className="chickenpaint-colorpicker-top",e.appendChild(a.getElement()),e.appendChild(n.getElement()),t.appendChild(e),i.value=f,i.title=function(t){return"Opacity: "+t},i.on("valueChange",function(t){d.setAlpha(t)}),t.appendChild(i.getElement()),setTimeout(function(){i.resize()},0),t}function s(t){0==$(t.target).closest(".popover").length&&$(t.target).closest(".chickenpaint-color-pick-swatch")[0]!=p&&$(p).popover("hide")}var d=this,u=new r.default(0),f=255,p=document.createElement("div");this.getElement=function(){return p},this.setColor=function(t){u.isEqual(t)||(u.copyFrom(t),n(),this.emitEvent("colorChange",[u]))},this.setAlpha=function(t){t!=f&&(f=t,n(),this.emitEvent("alphaChange",[f]))},this.getColorRgb=function(){return u.getRgb()},this.getAlpha=function(){return f},this.setCurColor=this.setColor,p.className="chickenpaint-color-pick-swatch",p.addEventListener("click",i),t&&u.copyFrom(t),e&&(f=e),$(p).popover({html:!0,content:function(){return window.addEventListener("mousedown",s),o()},trigger:"manual",placement:"bottom"}).on("click",function(){$(this).popover("toggle")}).on("hidden.bs.popover",function(){window.removeEventListener("mousedown",s)}),n()}Object.defineProperty(a,"__esModule",{value:!0}),a.default=i;var o=t("../util/CPColor"),r=n(o),s=t("./CPSlider"),l=n(s),d=t("./CPColorSelect"),c=n(d),u=t("./CPColorSlider"),h=n(u);i.prototype=Object.create(EventEmitter.prototype),i.prototype.constructor=i,e.exports=a.default},{"../util/CPColor":47,"./CPColorSelect":22,"./CPColorSlider":23,"./CPSlider":37}],25:[function(t,e,a){"use strict";function n(t,e){var a=$('<div class="modal fade" tabindex="-1" role="dialog">\n\t            <div class="modal-dialog">\n\t                <div class="modal-content">\n\t                    <div class="modal-header">\n\t                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">\n\t                            <span aria-hidden="true">&times;</span>\n\t                        </button>\n\t                        <h4 class="modal-title">Complete transform</h4>\n\t                    </div>\n\t                    <div class="modal-body">\n\t                        <p>\n\t                            You need to finish transforming this layer before you can do that. What would you like to do with the transform?\n\t\t\t\t\t\t\t</p>\n\t                    </div>\n\t                    <div class="modal-footer">\n\t                        <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>\n\t                        <button type="button" class="btn btn-default chickenpaint-reject-transform" data-dismiss="modal">Undo transform</button>\n\t                        <button type="button" class="btn btn-primary chickenpaint-accept-transform" data-dismiss="modal">Apply transform</button>\n\t                    </div>\n\t                </div>\n\t            </div>\n\t        </div>\n\t    '),n=this,i=$(".chickenpaint-accept-transform",a),o=$(".chickenpaint-reject-transform",a);i.click(function(t){e.actionPerformed({action:"CPTransformAccept"}),n.emitEvent("accept")}),o.click(function(t){e.actionPerformed({action:"CPTransformReject"}),n.emitEvent("reject")}),a.modal({show:!1}).on("shown.bs.modal",function(){i.focus()}).on("hidden.bs.modal",function(t){a.remove()}).on("keypress",function(t){13==t.keyCode&&i.click()}),a.data("bs.modal").$body=$(t),t.appendChild(a[0]),this.show=function(){a.modal("show")}}Object.defineProperty(a,"__esModule",{value:!0}),a.default=n,n.prototype=Object.create(EventEmitter.prototype),n.prototype.constructor=n,e.exports=a.default},{}],26:[function(t,e,a){"use strict";function n(t){for(var e=document.createElement("canvas"),a=e.getContext("2d"),n=a.createImageData(64,64),i=n.data,o=0,r=0;r<64;r++)for(var s=0;s<64;s++)0!=(8&s)^0!=(8&r)?(i[o++]=255,i[o++]=255,i[o++]=255,i[o++]=255):(i[o++]=204,i[o++]=204,i[o++]=204,i[o++]=255);return e.width=64,e.height=64,a.putImageData(n,0,0),t.createPattern(e,"repeat")}Object.defineProperty(a,"__esModule",{value:!0}),a.createCheckerboardPattern=n},{}],27:[function(t,e,a){"use strict";function n(t,e){var a=$('<div class="modal fade" tabindex="-1" role="dialog">\n                <div class="modal-dialog">\n                    <div class="modal-content">\n                        <div class="modal-header">\n                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">\n                                <span aria-hidden="true">&times;</span>\n                            </button>\n                            <h4 class="modal-title">Grid options</h4>\n                        </div>\n                        <div class="modal-body">\n                            <form>\n                                <div class="form-group">\n                                    <label>Grid size</label>\n                                    <input type="text" class="form-control chickenpaint-grid-size" value="" autofocus>\n                                </div>\n                            </form>\n                        </div>\n                        <div class="modal-footer">\n                            <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>\n                            <button type="button" class="btn btn-primary chickenpaint-apply-grid-settings" data-dismiss="modal">Ok</button>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        '),n=$(".chickenpaint-grid-size",a),i=$(".chickenpaint-apply-grid-settings",a);n.val(e.getGridSize()),$(".chickenpaint-apply-grid-settings",a).click(function(t){var a=parseInt(n.val(),10);e.setGridSize(a)}),a.modal({show:!1}).on("shown.bs.modal",function(){n.focus()}).on("keypress",function(t){13==t.keyCode&&i.click()}),a.data("bs.modal").$body=$(t),t.appendChild(a[0]),this.show=function(){a.modal("show")}}Object.defineProperty(a,"__esModule",{value:!0}),a.default=n,e.exports=a.default},{}],28:[function(t,e,a){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function i(t){function e(t,e){for(var a=0;a<e.length;a++){var n=document.createElement("option");n.appendChild(document.createTextNode(e[a])),n.value=a,t.appendChild(n)}}function a(t,e){var a=document.createElement("div"),n=document.createElement("label");return a.className="checkbox",n.appendChild(t),n.appendChild(document.createTextNode(e)),a.appendChild(n),a}function n(e){var a=f.getCSSSize(),n=t.getArtwork(),i=n.getLayer(e);g.show(u/window.devicePixelRatio,a.height-(e+1)*c/window.devicePixelRatio,e,i.name)}function i(){function e(t){return Math.floor((b.height-t.y/$(b).height()*b.height)/c)}function a(t,e){var a={width:b.width,height:b.height};e?C.fillStyle="#B0B0C0":C.fillStyle="white",C.fillRect(0,0,a.width,c),C.beginPath(),C.moveTo(0,0),C.lineTo(a.width,0),C.moveTo(u,0),C.lineTo(u,c),C.moveTo(u+6*window.devicePixelRatio,c/2),C.lineTo(a.width-6*window.devicePixelRatio,c/2),C.stroke(),C.fillStyle="black",C.fillText(t.name,u+6*window.devicePixelRatio,12*window.devicePixelRatio),C.fillText(s[t.blendMode]+": "+t.alpha+"%",u+6*window.devicePixelRatio,c-5*window.devicePixelRatio),C.beginPath(),t.visible?(C.arc(u/2,c/2,9*window.devicePixelRatio,0,2*Math.PI),C.fill()):(C.arc(u/2,c/2,9*window.devicePixelRatio,0,2*Math.PI),C.stroke())}function i(a){if(0==a.button){var n=$(b).offset(),r=t.getArtwork(),s=r.getLayers(),l={x:a.pageX-n.left,y:a.pageY-n.top},d=e(l);d>=0&&d<=s.length&&d!=m&&d!=m+1&&t.actionPerformed({action:"CPMoveLayer",fromIndex:m,toIndex:d}),f&&(f=!1,O.paint()),h=!1,window.removeEventListener("mousemove",o),window.removeEventListener("mouseup",i)}}function o(t){h&&(f=!0,v=t.pageY-$(b).offset().top,O.paint())}function r(t){var e=b.getBoundingClientRect(),a=P.getBoundingClientRect(),n=a.bottom-a.top,i=c/window.devicePixelRatio,o=e.bottom-i*(t+1),r=o+i;P.scrollTop=Math.max(Math.min(Math.max(P.scrollTop,r-e.top-n),o-e.top),0)}function l(t,e){y.call(this,t,e);var a=this.tip(),n=this.arrow(),i=b.getBoundingClientRect(),o=P.getBoundingClientRect();switch(S){case"layer":var r=i.bottom-c/window.devicePixelRatio*(x+.5);r=Math.min(Math.max(r,o.top),o.bottom),a.offset({top:r+document.body.scrollTop-a.height()/2,left:i.left-a.outerWidth()-n.outerWidth()});break;case"opacity":var s=p.getElement().getBoundingClientRect();a.offset({top:(s.top+s.bottom-a.height())/2+document.body.scrollTop,left:s.left-a.outerWidth()-n.outerWidth()})}n.css("top","50%")}var h,f,m,v,y,E=70,w=3e3,P=document.createElement("div"),b=document.createElement("canvas"),C=b.getContext("2d"),_="",x=-1,S="",L=!1,O=this;this.getCSSSize=function(){return{width:$(b).width(),height:$(b).height()}},this.paintLayer=function(t){var e=T.getLayer(t),n=b.height-c*(t+1);C.save(),C.fillStyle="#606060",C.fillRect(0,n,b.width,c),C.strokeStyle="black",C.translate(0,n),a(e,t==T.getActiveLayerIndex()),C.restore()},this.paint=function(){var n=t.getArtwork(),i=n.getLayers(),o={width:b.width,height:b.height},r=b.height/$(b).height();C.save(),C.fillStyle="#606060",C.fillRect(0,0,o.width,o.height-i.length*c),C.strokeStyle="black",C.translate(0,o.height-c);for(var s=0;s<i.length;s++)a(i[s],s==n.getActiveLayerIndex()),C.translate(0,-c);if(f){C.translate(0,i.length*c-(o.height-c)),C.strokeRect(0,v*r-c/2,o.width,c);var l=e({x:0,y:v});l<=i.length&&l!=m&&l!=m+1&&C.fillRect(0,o.height-l*c-2,o.width,4*window.devicePixelRatio)}C.restore()},this.resize=function(){var e,a,n=t.getArtwork(),i=$(b).parent(),o=i.height(),r=i.width();c=34*window.devicePixelRatio,u=24*window.devicePixelRatio,e=r*window.devicePixelRatio,a=Math.max(c*n.getLayerCount(),o*window.devicePixelRatio),a>o*window.devicePixelRatio?(e-=15*window.devicePixelRatio,i[0].style.overflowY="scroll"):i[0].style.overflowY="hidden",b.width=e,b.height=a,b.style.width=e/window.devicePixelRatio+"px",b.style.height=a/window.devicePixelRatio+"px",C.font=.25*c+"pt sans-serif",this.paint(),this.dismissNotification()},this.getElement=function(){return P},b.addEventListener("click",function(t){g.isVisible()&&g.renameAndHide()}),b.addEventListener("dblclick",function(t){var a=$(b).offset(),i={x:t.pageX-a.left,y:t.pageY-a.top},o=e(i);i.x*window.devicePixelRatio>u&&o>=0&&o<T.getLayerCount()&&n(o)}),b.addEventListener("mousedown",function(a){var n=$(b).offset(),r={x:a.pageX-n.left,y:a.pageY-n.top};if(0==a.button){var s=t.getArtwork(),l=s.getLayers(),d=e(r);if(d>=0&&d<s.getLayerCount()){var c=s.getLayer(d);r.x/$(b).width()*b.width<u?t.actionPerformed({action:"CPSetLayerVisibility",layerIndex:d,visible:!c.visible}):s.getActiveLayerIndex()!=d&&t.actionPerformed({action:"CPSetActiveLayerIndex",layerIndex:d})}d<l.length&&(h=!0,v=r.y,m=d,window.addEventListener("mousemove",o),window.addEventListener("mouseup",i))}}),this.dismissNotification=function(){$(b).popover("hide")},this.showNotification=function(t,e,a){_=e,x=t,T.getActiveLayerIndex()==t&&"opacity"==a?S="opacity":(S="layer",r(t)),$(b).popover("show"),L&&clearTimeout(L),L=setTimeout(function(){L=!1,O.dismissNotification()},Math.max(Math.round(_.length*E),w))},t.on("layerNotification",this.showNotification.bind(this)),$(b).popover({html:!1,content:function(){return _},placement:"left",trigger:"manual",container:d.getElement()});var M=$(b).data("bs.popover");y=M.applyPlacement,M.applyPlacement=l,window.devicePixelRatio||(window.devicePixelRatio=1),C.strokeStyle="black",P.className="chickenpaint-layers-widget",P.appendChild(b)}function o(){var e=-1,a=document.createElement("input"),n=this;this.hide=function(){e=-1,a.style.display="none"},this.renameAndHide=function(){T.getLayer(e).name!=a.value&&t.actionPerformed({action:"CPSetLayerName",layerIndex:e,name:a.value}),this.hide()},this.isVisible=function(){return"none"!=a.style.display},this.setLocation=function(t,e){a.style.left=t+"px",a.style.top=e+"px"},this.show=function(t,n,i,o){e=i,a.value=o,this.setLocation(t,n),a.style.display="block",a.select()},this.getElement=function(){return a},a.type="text",a.className="chickenpaint-layer-new-name form-control input-sm",a.style.display="none",a.addEventListener("keydown",function(t){t.stopPropagation()}),a.addEventListener("keypress",function(t){13==t.keyCode&&n.renameAndHide(),t.stopPropagation()}),a.addEventListener("keyup",function(t){27==t.keyCode&&n.hide(),t.stopPropagation()}),a.addEventListener("blur",function(t){e!=-1&&n.renameAndHide()})}r.default.call(this,t,"layers","Layers",!0);var s=["Normal","Multiply","Add","Screen","Lighten","Darken","Subtract","Dodge","Burn","Overlay","Hard Light","Soft Light","Vivid Light","Linear Light","Pin Light"],d=this,c=32,u=24,h=this.getBodyElement(),f=new i,p=new l.default(0,100),m=document.createElement("select"),g=new o,v=document.createElement("input"),y=document.createElement("input"),E=document.createElement("li"),w=document.createElement("li"),P=this.setSize,b=this.setHeight;this.setSize=function(t,e){P.call(this,t,e),f.resize(),p.resize()},this.setHeight=function(t){b.call(this,t),f.resize()},m.className="form-control",m.title="Layer blending mode",m.addEventListener("change",function(e){t.actionPerformed({action:"CPSetLayerBlendMode",layerIndex:T.getActiveLayerIndex(),blendMode:parseInt(m.value,10)})}),e(m,s),h.appendChild(m),p.title=function(t){return"Opacity: "+t+"%"},p.on("valueChange",function(e){t.actionPerformed({action:"CPSetLayerAlpha",layerIndex:T.getActiveLayerIndex(),alpha:e})}),h.appendChild(p.getElement()),v.type="checkbox",v.addEventListener("click",function(e){var a=t.getArtwork();a.setSampleAllLayers(v.checked)}),h.appendChild(a(v,"Sample all layers")),y.type="checkbox",y.addEventListener("click",function(e){var a=t.getArtwork();a.setLockAlpha(y.checked)}),h.appendChild(a(y,"Lock alpha")),f.getElement().appendChild(g.getElement()),h.appendChild(f.getElement());var C=document.createElement("ul");C.className="chickenpaint-layer-add-remove list-unstyled",E.className="chickenpaint-small-toolbar-button chickenpaint-add-layer",E.title="Add layer",E.addEventListener("click",function(){t.actionPerformed({action:"CPAddLayer"})}),w.className="chickenpaint-small-toolbar-button chickenpaint-remove-layer",w.title="Delete layer",w.addEventListener("click",function(){t.actionPerformed({action:"CPRemoveLayer"})}),C.appendChild(E),C.appendChild(w),h.appendChild(C);var T=t.getArtwork();p.setValue(T.getActiveLayer().getAlpha()),m.value=T.getActiveLayer().getBlendMode(),T.on("changeLayer",function(t){var e=this;e.getActiveLayer().getAlpha()!=p.value&&p.setValue(e.getActiveLayer().getAlpha()),e.getActiveLayer().getBlendMode()!=parseInt(m.value,10)&&(m.value=e.getActiveLayer().getBlendMode()),void 0!==t?f.paintLayer(t):f.resize(),f.dismissNotification()})}Object.defineProperty(a,"__esModule",{value:!0}),a.default=i;var o=t("./CPPalette"),r=n(o),s=t("./CPSlider"),l=n(s);i.prototype=Object.create(r.default.prototype),i.prototype.constructor=i,e.exports=a.default},{"./CPPalette":32,"./CPSlider":37}],29:[function(t,e,a){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function i(t,e){var a,n=document.createElement("div"),i=new r.default(t),o=new l.default(t),s=!1,d=this;this.togglePalettes=function(){o.togglePalettes()},this.arrangePalettes=function(){setTimeout(o.arrangePalettes.bind(o),0)},this.constrainPalettes=function(){o.constrainPalettes()},this.showPalette=function(t,e){o.showPaletteByName(t,e)},this.getSwatches=function(){return o.palettes.swatches.getSwatches()},this.setSwatches=function(t){o.palettes.swatches.setSwatches(t)},this.getPaletteManager=function(){return o},this.setRotation=function(t){i.setRotation(t)},this.setFullScreenMode=function(t){s=t,d.resize(),d.arrangePalettes()},this.resize=function(){var t;t=s?$(window).height()-$(a.getElement()).height():Math.min(Math.max($(window).height()-$(a.getElement()).height()-65,500),750),i.resize(t),d.constrainPalettes()},a=new c.default(t,this),e.appendChild(a.getElement()),n.className="chickenpaint-main-section",n.appendChild(i.getElement()),n.appendChild(o.getElement()),e.appendChild(n),window.addEventListener("resize",this.resize.bind(this)),setTimeout(this.resize.bind(this),0)}Object.defineProperty(a,"__esModule",{value:!0}),a.default=i;var o=t("./CPCanvas"),r=n(o),s=t("./CPPaletteManager"),l=n(s),d=t("./CPMainMenu"),c=n(d);i.prototype=Object.create(EventEmitter.prototype),i.prototype.constructor=i,e.exports=a.default},{"./CPCanvas":19,"./CPMainMenu":30,"./CPPaletteManager":33}],30:[function(t,e,a){"use strict";function n(t,e){function a(e){var a,n=e.data("action"),i=e.data("checkbox");i?(e.toggleClass("selected"),a=e.hasClass("selected")):a=!1,t.actionPerformed({action:n,checkbox:i,selected:a})}function n(t){return t=t.toUpperCase(),t=t.replace(/(,.+)$/,""),t=t.replace("ctrl+=","ctrl++"),t=t.replace("⌘+=","⌘++"),t=l?t.replace(/([^+])\+/g,"$1"):t.replace(/([^+])\+/g,"$1 ")}function o(e,i){e.append(i.map(function(e){var i;if(!e.action||t.isActionSupported(e.action)){if("CPSend"!=e.action||t.isActionSupported("CPContinue")||(e.name="Post Oekaki",e.shortcut="ctrl+p"),e.children?(i=$('<li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">'+e.name+' <span class="caret"></span></a><ul class="dropdown-menu"></ul></li>'),$(".dropdown-toggle",i).dropdown(),i.on("show.bs.dropdown",function(){$(document).one("click",function(){i.hasClass("open")&&$(".dropdown-toggle",i).dropdown("toggle")})}),o($(".dropdown-menu",i),e.children)):"-"==e.name?i=$('<li role="separator" class="divider"></li>'):(i=$('<li><a href="#" data-action="'+e.action+'"><span>'+e.name+"</span></a></li>"),e.checkbox&&$("a",i).data("checkbox",!0).toggleClass("selected",!!e.checked)),e.title&&i.attr("title",e.title),e.shortcut){var r=$("> a",i),s=document.createElement("small");l&&(e.shortcut=e.shortcut.replace(/SHIFT/im,"⇧"),e.shortcut=e.shortcut.replace(/ALT/im,"⌥"),e.shortcut=e.shortcut.replace(/CTRL/im,"⌘")),s.className="chickenpaint-shortcut",s.innerHTML=n(e.shortcut),r.append(s),key(e.shortcut,function(t){return a(r),t.preventDefault(),t.stopPropagation(),!1})}return i}}))}function r(t,e){var a=$('[data-action="CPPal'+t.substring(0,1).toUpperCase()+t.substring(1)+'"]',s);a.toggleClass("selected",e)}var s=$('<nav class="navbar navbar-default"><div class="container-fluid"><div class="navbar-header"><a class="navbar-brand" href="#">ChickenPaint</a></div><ul class="nav navbar-nav"></ul></div></nav>'),l=/^Mac/i.test(navigator.platform);this.getElement=function(){return s[0]},o($(".navbar-nav",s),i),$(s).on("click","a:not(.dropdown-toggle)",function(t){a($(this)),t.preventDefault()}),e.getPaletteManager().on("paletteVisChange",r)}Object.defineProperty(a,"__esModule",{value:!0}),a.default=n;var i=[{name:"File",mnemonic:"F",children:[{name:"Save to my computer",action:"CPSave",mnemonic:"S",shortcut:"ctrl+s"},{name:"Save Oekaki",action:"CPSend",mnemonic:"S",shortcut:"ctrl+s"}]},{name:"Edit",mnemonic:"E",children:[{name:"Undo",action:"CPUndo",mnemonic:"U",shortcut:"ctrl+z",title:"Undoes the most recent action"},{name:"Redo",action:"CPRedo",mnemonic:"R",shortcut:"shift+ctrl+z",title:"Redoes a previously undone action"},{name:"Clear history",action:"CPClearHistory",mnemonic:"H",title:"Removes all undo/redo information to regain memory"},{name:"-"},{name:"Cut",action:"CPCut",mnemonic:"T",shortcut:"ctrl+x"},{name:"Copy",action:"CPCopy",mnemonic:"C",shortcut:"ctrl+c"},{name:"Copy merged",action:"CPCopyMerged",mnemonic:"Y",shortcut:"shift+ctrl+c"},{name:"Paste",action:"CPPaste",mnemonic:"P",shortcut:"ctrl+v"},{name:"-"},{name:"Select all",action:"CPSelectAll",mnemonic:"A",shortcut:"ctrl+a"},{name:"Deselect",action:"CPDeselectAll",mnemonic:"D",shortcut:"ctrl+d"},{name:"-"},{name:"Transform",action:"CPTransform",mnemonic:"T",shortcut:"ctrl+y"}]},{name:"Layers",mnemonic:"L",children:[{name:"Duplicate",action:"CPLayerDuplicate",mnemonic:"D",shortcut:"shift+ctrl+d",title:"Creates a copy of the currently selected layer"},{name:"-"},{name:"Merge down",action:"CPLayerMergeDown",mnemonic:"E",shortcut:"ctrl+e",title:"Merges the currently selected layer with the one directly below it"},{name:"Merge all layers",action:"CPLayerMergeAll",mnemonic:"A",title:"Merges all the layers"}]},{name:"Effects",mnemonic:"E",children:[{name:"Clear",action:"CPClear",mnemonic:"D",shortcut:"del,backspace",title:"Clears the selected area"},{name:"Fill",action:"CPFill",mnemonic:"F",shortcut:"ctrl+f",title:"Fills the selected area with the current color"},{name:"Flip horizontal",action:"CPHFlip",mnemonic:"H",title:"Flips the current selected area horizontally"},{name:"Flip vertical",action:"CPVFlip",mnemonic:"V",title:"Flips the current selected area vertically"},{name:"Invert",action:"CPFXInvert",mnemonic:"I",title:"Invert the image colors"},{name:"-"},{name:"Box blur...",action:"CPFXBoxBlur",mnemonic:"B",title:"Blur effect"},{name:"-"},{name:"Monochromatic noise",action:"CPMNoise",mnemonic:"M",title:"Fills the selection with noise"},{name:"Color noise",action:"CPCNoise",mnemonic:"C",title:"Fills the selection with colored noise"}]},{name:"View",mnemonic:"V",children:[{name:"Full-screen mode",action:"CPFullScreen",mnemonic:"F",checkbox:!0,checked:!1},{name:"-"},{name:"Zoom in",action:"CPZoomIn",mnemonic:"I",shortcut:"ctrl+=",title:"Zooms in"},{name:"Zoom out",action:"CPZoomOut",mnemonic:"O",shortcut:"ctrl+-",title:"Zooms out"},{name:"Zoom 100%",action:"CPZoom100",mnemonic:"1",shortcut:"ctrl+0",title:"Resets the zoom factor to 100%"},{action:"CPLinearInterpolation",name:"-"},{name:"Smooth-out zoomed canvas",action:"CPLinearInterpolation",mnemonic:"L",title:"Linear interpolation is used to give a smoothed looked to the picture when zoomed in",checkbox:!0},{name:"-"},{name:"Show grid",action:"CPToggleGrid",mnemonic:"G",shortcut:"ctrl+g",title:"Displays a grid over the image",checkbox:!0,checked:!1},{name:"Grid options...",action:"CPGridOptions",mnemonic:"D",title:"Shows the grid options dialog box"}]},{name:"Palettes",mnemonic:"P",children:[{name:"Rearrange",action:"CPArrangePalettes",title:"Rearrange the palette windows"},{name:"Toggle palettes",action:"CPTogglePalettes",mnemonic:"P",shortcut:"tab",title:"Hides or shows all palettes"},{name:"-"},{name:"Show tool options",action:"CPPalBrush",mnemonic:"B",checkbox:!0,checked:!0},{name:"Show color",action:"CPPalColor",mnemonic:"C",checkbox:!0,checked:!0},{name:"Show layers",action:"CPPalLayers",mnemonic:"Y",checkbox:!0,checked:!0},{name:"Show misc",action:"CPPalMisc",mnemonic:"M",checkbox:!0,checked:!0},{name:"Show stroke",action:"CPPalStroke",mnemonic:"S",checkbox:!0,checked:!0},{name:"Show swatches",action:"CPPalSwatches",mnemonic:"W",checkbox:!0,checked:!0},{name:"Show textures",action:"CPPalTextures",mnemonic:"X",checkbox:!0,checked:!0},{name:"Show tools",action:"CPPalTool",mnemonic:"T",checkbox:!0,checked:!0}]},{name:"Help",mnemonic:"H",children:[{name:"Tablet support",mnemonic:"T",action:"CPTabletSupport",title:"Help with getting a drawing tablet working"},{name:"Shortcuts",mnemonic:"S",action:"CPShortcuts",title:"List of keyboard and mouse shortcuts"},{name:"-"},{name:"About",mnemonic:"A",action:"CPAbout",title:"Displays some information about ChickenPaint"}]}];e.exports=a.default},{}],31:[function(t,e,a){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function i(t){function e(){var e=a.getBodyElement(),i=document.createElement("ul");i.className="chickenpaint-misc-tools list-unstyled";for(var o in n){var r=n[o],s=document.createElement("li");"CPSend"!=r.command||t.isActionSupported("CPContinue")||(r.toolTip="Send picture to server",r.className="chickenpaint-tool-send-and-end"),s.className="chickenpaint-toolbar-button "+r.className,s.setAttribute("data-buttonIndex",o),i.appendChild(s)}i.addEventListener("mousedown",function(t){t.target&&"LI"==t.target.nodeName&&$(t.target).addClass("selected")}),i.addEventListener("mouseup",function(t){t.target&&"LI"==t.target.nodeName&&$(t.target).removeClass("selected")}),i.addEventListener("click",function(e){if(e.target&&"LI"==e.target.nodeName){var a=n[parseInt(e.target.getAttribute("data-buttonIndex"),10)];t.actionPerformed({action:a.command})}}),e.appendChild(i)}r.default.call(this,t,"misc","Misc");var a=this,n=[{className:"chickenpaint-tool-zoom-in",command:"CPZoomIn",toolTip:"Zoom in"},{className:"chickenpaint-tool-zoom-out",command:"CPZoomOut",toolTip:"Zoom out"},{className:"chickenpaint-tool-zoom-100",command:"CPZoom100",toolTip:"Zoom 100%"},{className:"chickenpaint-tool-undo",command:"CPUndo",toolTip:"Undo"},{className:"chickenpaint-tool-redo",command:"CPRedo",toolTip:"Redo"},{className:"chickenpaint-tool-send",command:"CPSend",toolTip:"Save pic"}];e()}Object.defineProperty(a,"__esModule",{value:!0}),a.default=i;var o=t("./CPPalette"),r=n(o);i.prototype=Object.create(r.default.prototype),i.prototype.constructor=i,e.exports=a.default},{"./CPPalette":32}],32:[function(t,e,a){"use strict";function n(t,e,a,n){function i(t){g.setLocation(t.pageX-c.x,t.pageY-c.y)}function o(t){window.removeEventListener("mousemove",i),window.removeEventListener("mouseup",o)}function r(t){g.setHeight(t.pageY-$(u).offset().top)}function s(t){window.removeEventListener("mousemove",r),window.removeEventListener("mouseup",s)}function l(t){window.addEventListener("mousemove",r),window.addEventListener("mouseup",s)}function d(){m=document.createElement("div"),m.className="chickenpaint-resize-handle-vert",m.addEventListener("mousedown",l),u.appendChild(m)}this.title=a,this.name=e,this.resizeVert=n||!1;var c,u=document.createElement("div"),h=document.createElement("div"),f=document.createElement("button"),p=document.createElement("div"),m=null,g=this;this.getElement=function(){return u},this.getBodyElement=function(){return p},this.getWidth=function(){return $(u).outerWidth()},this.getHeight=function(){return $(u).outerHeight()},this.getX=function(){return parseInt(u.style.left,10)||0},this.getY=function(){return parseInt(u.style.top,10)||0},this.setLocation=function(t,e){u.style.left=t+"px",u.style.top=e+"px"},this.setWidth=function(t){u.style.width=t+"px"},this.setHeight=function(t){u.style.height=t+"px"},this.setSize=function(t,e){this.setWidth(t),this.setHeight(e)},f.type="button",f.className="close",f.innerHTML="&times;",u.className="chickenpaint-palette chickenpaint-palette-"+e,h.className="chickenpaint-palette-head";var v=document.createElement("h4");v.className="modal-title",v.appendChild(document.createTextNode(this.title)),h.appendChild(f),h.appendChild(v),p.className="chickenpaint-palette-body",u.appendChild(h),u.appendChild(p),this.resizeVert&&d(),h.addEventListener("mousedown",function(t){0==t.button&&("BUTTON"==t.target.nodeName?g.emitEvent("paletteVisChange",[g,!1]):(window.addEventListener("mousemove",i),window.addEventListener("mouseup",o),c={x:t.pageX-$(u).position().left,y:t.pageY-$(u).position().top}))})}Object.defineProperty(a,"__esModule",{value:!0}),a.default=n,n.prototype=Object.create(EventEmitter.prototype),n.prototype.constructor=EventEmitter,e.exports=a.default},{}],33:[function(t,e,a){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function i(t){function e(t,e){var a=t.getElement();e?o.appendChild(a):o.removeChild(a),s.emitEvent("paletteVisChange",[t.name,e])}var a={tool:new r.default(t),misc:new l.default(t),stroke:new c.default(t),
color:new h.default(t),brush:new p.default(t),layers:new g.default(t),textures:new y.default(t),swatches:new w.default(t)},n=[],i=[],o=document.createElement("div"),s=this;this.palettes=a,this.showPaletteByName=function(t,n){var i=a[t];i&&e(i,n)},this.togglePalettes=function(){if(0==i.length)$("> .chickenpaint-palette",o).each(function(){s.showPaletteByName(this.getAttribute("data-paletteName"),!1),i.push(this)});else{for(var t=0;t<i.length;t++){var e=i[t];s.showPaletteByName(e.getAttribute("data-paletteName"),!0)}i=[]}},this.constrainPalettes=function(){var t=$(o).parents(".chickenpaint-main-section").width(),e=$(o).parents(".chickenpaint-main-section").height();for(var n in a){var i=a[n];i.getX()+i.getWidth()/2>t&&i.setLocation(t-i.getWidth(),i.getY()),i.getY()+i.getHeight()/2>e&&i.setLocation(i.getX(),e-i.getHeight())}var r=t-a.tool.getWidth()-a.misc.getWidth()-a.stroke.getWidth()-a.color.getWidth()-a.brush.getWidth()-15>0;a.swatches.getX()+a.swatches.getWidth()==a.brush.getX()+a.brush.getWidth()&&Math.abs(a.swatches.getY()-a.brush.getY())<20&&a.swatches.setLocation(a.brush.getX()-a.swatches.getWidth()-(r?5:1),0),a.layers.getY()+a.layers.getHeight()>e&&a.layers.setHeight(Math.max(e-a.layers.getY(),200))},this.arrangePalettes=function(){var t=$(o).parents(".chickenpaint-main-section").width(),e=$(o).parents(".chickenpaint-main-section").height(),n=t-a.tool.getWidth()-a.misc.getWidth()-a.stroke.getWidth()-a.color.getWidth()-a.brush.getWidth()-15>0;a.brush.setLocation(t-a.brush.getWidth()-15,0);var i=a.brush.getY()+a.brush.getHeight();a.layers.setLocation(a.brush.getX(),e-i>300?i+2:i),a.layers.setSize(a.brush.getWidth(),e-a.layers.getY()),a.tool.setLocation(0,0),a.misc.setLocation(a.tool.getX()+a.tool.getWidth()+(n?5:1),0),n?a.stroke.setLocation(a.misc.getX()+a.misc.getWidth()+(n?5:1),0):a.stroke.setLocation(a.misc.getX(),a.misc.getY()+a.misc.getHeight()+1),a.swatches.setLocation(a.brush.getX()-a.swatches.getWidth()-(n?5:1),0),a.textures.setWidth(Math.min(a.layers.getX()-a.textures.getX(),490)),a.textures.setLocation(a.color.getX()+a.color.getWidth()+4,e-a.textures.getHeight()),a.color.setLocation(0,Math.max(a.tool.getY()+a.tool.getHeight(),e-a.color.getHeight()))},this.getElement=function(){return o},o.className="chickenpaint-palettes";for(var d in a){var u=a[d],f=u.getElement();u.on("paletteVisChange",function(){e(this,!1)}),f.setAttribute("data-paletteName",d),n.push(f)}for(var d in a){var f=a[d].getElement();o.appendChild(f)}}Object.defineProperty(a,"__esModule",{value:!0}),a.default=i;var o=t("./CPToolPalette"),r=n(o),s=t("./CPMiscPalette"),l=n(s),d=t("./CPStrokePalette"),c=n(d),u=t("./CPColorPalette"),h=n(u),f=t("./CPBrushPalette"),p=n(f),m=t("./CPLayersPalette"),g=n(m),v=t("./CPTexturePalette"),y=n(v),E=t("./CPSwatchesPalette"),w=n(E);i.prototype=Object.create(EventEmitter.prototype),i.prototype.constructor=i,e.exports=a.default},{"./CPBrushPalette":18,"./CPColorPalette":21,"./CPLayersPalette":28,"./CPMiscPalette":31,"./CPStrokePalette":39,"./CPSwatchesPalette":40,"./CPTexturePalette":42,"./CPToolPalette":43}],34:[function(t,e,a){"use strict";function n(t){function e(){var e=t?$(l).height():$(l).width();y=p/(h-u)*e;var a=(f-u)/(h-u)*(e-y);c.style[t?"height":"width"]=y+"px",d.style[t?"height":"width"]=y+"px",d.style[t?"top":"left"]=a+"px"}function a(a){if(this==l){var n=t?a.pageY-$(l).offset().top:a.pageX-$(l).offset().left,i=parseInt(d.style[t?"top":"left"],10);n<i?f-=m:f+=m,E.emitEvent("valueChanged",[f]),e()}}function n(e){e.stopPropagation(),s=t?e.pageY-$(l).offset().top:e.pageX-$(l).offset().left,$(d).addClass("dragging"),window.addEventListener("mouseup",r),window.addEventListener("mousemove",o)}function i(t){t.stopPropagation()}function o(a){v=!0;var n=t?$(l).height():$(l).width(),i=t?a.pageY-$(l).offset().top:a.pageX-$(l).offset().left;f+=(i-s)*(h-u)/(n-y),f=Math.min(Math.max(f,u),h),s=i,E.emitEvent("valueChanged",[f]),e(),v=!1}function r(t){t.stopPropagation(),$(d).removeClass("dragging"),window.removeEventListener("mouseup",r),window.removeEventListener("mousemove",o)}var s,l=document.createElement("div"),d=document.createElement("div"),c=document.createElement("div"),u=0,h=1,f=0,p=1,m=10,g=1,v=!1,y=1,E=this;this.setValues=function(t,a,n,i){f=t,p=a,u=n,h=i,e()},this.setBlockIncrement=function(t){m=t},this.setUnitIncrement=function(t){g=t},this.getElement=function(){return l},this.getValueIsAdjusting=function(){return v},l.className="chickenpaint-scrollbar "+(t?"chickenpaint-scrollbar-vertical":"chickenpaint-scrollbar-horizontal"),d.className="chickenpaint-scrollbar-handle",c.className="chickenpaint-scrollbar-handle-inner",d.appendChild(c),l.appendChild(d),d.addEventListener("mousedown",n),d.addEventListener("click",i),l.addEventListener("click",a)}Object.defineProperty(a,"__esModule",{value:!0}),a.default=n,n.prototype=Object.create(EventEmitter.prototype),n.prototype.constructor=n,e.exports=a.default},{}],35:[function(t,e,a){"use strict";function n(t,e,a){var n=$('<div class="modal fade" tabindex="-1" role="dialog">\n                <div class="modal-dialog">\n                \n                    <div class="modal-content" data-stage="saving">\n                        <div class="modal-header">\n                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">\n                                <span aria-hidden="true">&times;</span>\n                            </button>\n                            <h4 class="modal-title">Saving drawing...</h4>\n                        </div>\n                        <div class="modal-body">\n                            <p class="chickenpaint-saving-progress-message">Preparing your drawing to be saved, please wait...</p>\n                            <pre class="chickenpaint-saving-error-message pre-scrollable"></pre>\n                            <div class="progress">\n                                <div class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%;"></div>\n                            </div>\n                        </div>\n                        <div class="modal-footer">\n                            <button type="button" class="btn btn-default chickenpaint-send-cancel" data-dismiss="modal">Cancel</button>\n                        </div>\n                    </div>\n                    <div class="modal-content" data-stage="success-not-previously-posted" style="display:none">\n                        <div class="modal-header">\n                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">\n                                <span aria-hidden="true">&times;</span>\n                            </button>\n                            <h4 class="modal-title">Drawing saved!</h4>\n                        </div>\n                        <div class="modal-body">\n                            <p>Your drawing has been saved, would you like to post it to the forum now?</p>\n                        </div>\n                        <div class="modal-footer">\n                            <button type="button" class="btn btn-primary chickenpaint-post-drawing" data-dismiss="modal">Yes, post it now</button>\n                            <button type="button" class="btn btn-default chickenpaint-continue-drawing" data-dismiss="modal">No, keep drawing</button>\n                            <button type="button" class="btn btn-default chickenpaint-exit" data-dismiss="modal">No, quit and I\'ll finish it later</button>\n                        </div>\n                    </div>\n                    <div class="modal-content" data-stage="success-already-posted" style="display:none">\n                        <div class="modal-header">\n                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">\n                                <span aria-hidden="true">&times;</span>\n                            </button>\n                            <h4 class="modal-title">Drawing saved!</h4>\n                        </div>\n                        <div class="modal-body">\n                            <p>Your drawing has been saved, would you like to view it on the forum now?</p>\n                        </div>\n                        <div class="modal-footer">\n                            <button type="button" class="btn btn-primary chickenpaint-post-drawing" data-dismiss="modal">Yes, view the post</button>\n                            <button type="button" class="btn btn-default chickenpaint-continue-drawing" data-dismiss="modal">No, keep drawing</button>\n                        </div>\n                    </div>\n                    <div class="modal-content" data-stage="success-redirect" style="display:none">\n                        <div class="modal-header">\n                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">\n                                <span aria-hidden="true">&times;</span>\n                            </button>\n                            <h4 class="modal-title">Drawing saved!</h4>\n                        </div>\n                        <div class="modal-body">\n                            <p>Your drawing has been saved, redirecting you to view your new post now...</p>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        '),i=$(".chickenpaint-saving-progress-message",n),o=$(".chickenpaint-saving-error-message",n),r=$(".progress-bar",n),s=this;a.on("savingProgress",function(t,e){t*=100,i.text(e),$(r).attr("aria-valuenow",t).css("width",t+"%")}),a.on("savingComplete",function(){$(".modal-content[data-stage='saving']",n).hide(),t.isActionSupported("CPContinue")?t.isActionSupported("CPExit")?$(".modal-content[data-stage='success-not-previously-posted']",n).show():$(".modal-content[data-stage='success-already-posted']",n).show():$(".modal-content[data-stage='success-redirect']",n).show()}),a.on("savingFailure",function(t){r.addClass("progress-bar-danger");var e="Sorry, your drawing could not be saved, please try again later.";t&&(t=t.replace(/^CHIBIERROR\s*/,""),t.length>0&&(e+="<br><br>The error returned from the server was:",o.text(t).show()),i.html(e))}),$(".chickenpaint-post-drawing",n).click(function(){t.actionPerformed({action:"CPPost"})}),$(".chickenpaint-exit",n).toggle(t.isActionSupported("CPExit")).click(function(){alert("When you want to come back and finish your drawing, just click the 'new drawing' button again and you can choose to continue this drawing."),t.actionPerformed({action:"CPExit"})}),$(".chickenpaint-send-cancel",n).click(function(){a.cancel()}),n.on("hidden.bs.modal",function(t){n.remove()}),n.modal({show:!1}),n.on("shown.bs.modal",function(){s.emitEvent("shown")}),n.data("bs.modal").$body=$(e),e.appendChild(n[0]),this.show=function(){n.modal("show")}}Object.defineProperty(a,"__esModule",{value:!0}),a.default=n,n.prototype=Object.create(EventEmitter.prototype),n.prototype.contructor=n,e.exports=a.default},{}],36:[function(t,e,a){"use strict";function n(t){var e=$('<div class="modal fade chickenpaint-shortcuts-dialog" tabindex="-1" role="dialog">\n                <div class="modal-dialog modal-lg">\n                    <div class="modal-content">\n                        <div class="modal-header">\n                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">\n                                <span aria-hidden="true">&times;</span>\n                            </button>\n                            <h4 class="modal-title">Shortcuts</h4>\n                        </div>\n                        <div class="modal-body">\n                            <p>\n                                Many of the menu options and painting tools have keyboard shortcuts which are\n                                written next to them or appear when you hover.\n                            </p>\n                            <p>\n                                Here are some other shortcuts which are not as obvious!\n                            </p>\n                            <div class="chickenpaint-shortcuts-sections">\n                                <div class="chickenpaint-shortcuts-section">\n                                    <h5>Color swatches palette</h5>\n                                    <ul class="chickenpaint-shortcuts-list list-unstyled">\n                                        <li>\n                                            <dl>\n                                                <dt>\n                                                    <span class="chickenpaint-shortcut"><span class="fa fa-mouse-pointer"></span> Left</span>\n                                                </dt>\n                                                <dd>\n                                                    Use as the drawing color\n                                                </dd>\n                                                <dt>\n                                                    <span class="chickenpaint-shortcut"><span class="fa fa-mouse-pointer"></span> Right</span>\n                                                </dt>\n                                                <dd>\n                                                    Remove or replace a color swatch\n                                                </dd>\n                                             </dl>\n                                        </li>\n                                    </ul>\n                                </div>\n                                <div class="chickenpaint-shortcuts-section">\n                                    <h5>Line drawing mode</h5>\n                                    <ul class="chickenpaint-shortcuts-list list-unstyled">\n                                        <li>\n                                            <dl>\n                                                <dt>\n                                                    <span class="chickenpaint-shortcut"><span class="chickenpaint-shortcut-key">Shift</span> + <span class="fa fa-mouse-pointer"></span> Left</span>\n                                                </dt>\n                                                <dd>\n                                                    Snap line to nearest 45 degrees\n                                                </dd>\n                                             </dl>\n                                        </li>\n                                    </ul>\n                                </div>\n                                <div class="chickenpaint-shortcuts-section">\n                                    <h5>Painting tools</h5>\n                                    <ul class="chickenpaint-shortcuts-list list-unstyled">\n                                        <li>\n                                            <dl>\n                                                <dt>\n                                                    <span class="chickenpaint-shortcut"><span class="chickenpaint-shortcut-key">1</span> - <span class="chickenpaint-shortcut-key">9</span> , <span class="chickenpaint-shortcut-key">0</span></span>\n                                                </dt>\n                                                <dd>\n                                                    Change brush opacity\n                                                </dd>\n                                                <dt>\n                                                    <span class="chickenpaint-shortcut"><span class="chickenpaint-shortcut-key">[</span> , <span class="chickenpaint-shortcut-key">]</span></span>\n                                                </dt>\n                                                <dd>\n                                                    Change brush size\n                                                </dd>\n                                            </dl>\n                                        </li>\n                                    </ul>\n                                </div>\n                                <div class="chickenpaint-shortcuts-section">\n                                    <h5>Brush palette</h5>\n                                    <ul class="chickenpaint-shortcuts-list list-unstyled">\n                                        <li>\n                                            <dl>\n                                                <dt>\n                                                    <span class="chickenpaint-shortcut"><span class="fa fa-mouse-pointer"></span> Right drag</span>\n                                                </dt>\n                                                <dd>\n                                                    Adjust brush sliders more precisely\n                                                </dd>\n                                            </dl>\n                                        </li>\n                                    </ul>\n                                </div>\n                                <div class="chickenpaint-shortcuts-section">\n                                    <h5>Drawing canvas</h5>\n                                    <ul class="chickenpaint-shortcuts-list list-unstyled">\n                                        <li>\n                                            <dl>\n                                                <dt>\n                                                    <span class="chickenpaint-shortcut"><span class="fa fa-mouse-pointer"></span> Middle</span> <span class="chickenpaint-shortcut-alternate">or</span> <span class="chickenpaint-shortcut"><span class="chickenpaint-shortcut-key">Space</span> + <span class="fa fa-mouse-pointer"></span> Left</span>\n                                                </dt>\n                                                <dd>\n                                                    Move the canvas around\n                                                </dd>\n                                                <dt>\n                                                    <span class="chickenpaint-shortcut"><span class="chickenpaint-shortcut-key">Alt</span> + <span class="fa fa-mouse-pointer"></span> Middle</span> <span class="chickenpaint-shortcut-alternate">or</span> <span class="chickenpaint-shortcut"><span class="chickenpaint-shortcut-key">Alt</span> + <span class="chickenpaint-shortcut-key">Space</span> + <span class="fa fa-mouse-pointer"></span> Left</span>\n                                                </dt>\n                                                <dd>\n                                                    Rotate the canvas\n                                                </dd>\n                                                <dt>\n                                                    <span class="chickenpaint-shortcut"><span class="fa fa-mouse-pointer"></span> Right</span> <span class="chickenpaint-shortcut-alternate">or</span> <span class="chickenpaint-shortcut"><span class="chickenpaint-shortcut-key">Alt</span> + <span class="fa fa-mouse-pointer"></span> Left</span>\n                                                </dt>\n                                                <dd>\n                                                    Sample the color under the cursor\n                                                </dd>\n                                             </dl>\n                                        </li>\n                                    </ul>\n                                </div>\n                                <div class="chickenpaint-shortcuts-section">\n                                    <h5>Layers palette</h5>\n                                    <ul class="chickenpaint-shortcuts-list list-unstyled">\n                                        <li>\n                                            <dl>\n                                                <dt>\n                                                    <span class="chickenpaint-shortcut"><span class="fa fa-mouse-pointer"></span> Double click</span>\n                                                </dt>\n                                                <dd>\n                                                    Rename layer\n                                                </dd>\n                                             </dl>\n                                        </li>\n                                    </ul>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            ');e.on("hidden.bs.modal",function(t){e.remove()}),e.modal({show:!1}),e.data("bs.modal").$body=$(t),t.appendChild(e[0]),this.show=function(){e.modal("show")}}Object.defineProperty(a,"__esModule",{value:!0}),a.default=n,e.exports=a.default},{}],37:[function(t,e,a){"use strict";function n(t,e,a,n){function i(){var e=u.width,i=u.height,o="string"==typeof v.title?v.title:v.title(v.value),r=2*window.devicePixelRatio,s=.75*u.height;if(a)h.save(),h.fillStyle="white",h.fillRect(0,0,e,i),h.fillStyle="black",h.fillText(o,r,s),h.beginPath(),v.value>=f/2?h.rect(e/2,0,(v.value-f/2)*e/f,i):h.rect(v.value*e/f,0,(f/2-v.value)*e/f,i),h.fill(),h.clip(),h.fillStyle="white",h.fillText(o,r,s),h.restore();else{var l,d=(v.value-t)/f;n&&(d=Math.pow(d,1/c)),l=d*e,h.save(),h.save(),h.fillStyle="black",h.beginPath(),h.rect(0,0,l,i),h.fill(),h.clip(),h.fillStyle="white",h.fillText(o,r,s),h.restore(),h.fillStyle="white",h.beginPath(),h.rect(l,0,e,i),h.fill(),h.clip(),h.fillStyle="black",h.fillText(o,r,s),h.restore()}}function o(e){var a=$(u).width(),i=$(u).offset().left,o=(e.pageX-i)/a;n&&(o=Math.pow(Math.max(o,0),c)),v.setValue(o*f+t)}function r(t){if(p)o(t);else if(m){var e=(t.pageX-l)/d;if(0!=e){var a=v.value+e,n=0|a;v.setValue(n),l=t.pageX-(a-n)*d}}}function s(t){if(p&&0==t.button)p=!1;else{if(!m||2!=t.button)return;m=!1}u.releasePointerCapture(t.pointerId),u.removeEventListener("pointerup",s),u.removeEventListener("pointermove",r)}var l,d=4,c=1.5,u=document.createElement("canvas"),h=u.getContext("2d"),f=e-t,p=!1,m=!1,g=!1,v=this;this.value=void 0,this.title="",a=a||!1,this.setValue=function(a){a=~~Math.max(t,Math.min(e,a)),this.value!=a&&(this.value=a,this.emitEvent("valueChange",[this.value]),g?i():(g=!0,this.resize()))},this.getElement=function(){return u},this.resize=function(){u.width=$(u).width()||150,u.height=$(u).height()||20,window.devicePixelRatio>1&&(u.style.height=u.height+"px",u.width=u.width*window.devicePixelRatio,u.height=u.height*window.devicePixelRatio),h.font=.47*u.height+"pt sans-serif",i()},u.addEventListener("pointerdown",function(t){var e=p||m;if(!e){switch(u.setPointerCapture(t.pointerId),t.button){case 0:p=!0,o(t);break;case 2:m=!0,l=t.pageX;break;default:return}u.addEventListener("pointerup",s),u.addEventListener("pointermove",r)}}),u.addEventListener("contextmenu",function(t){t.preventDefault()}),u.setAttribute("touch-action","none"),u.className="chickenpaint-slider",window.devicePixelRatio||(window.devicePixelRatio=1)}Object.defineProperty(a,"__esModule",{value:!0}),a.default=n,n.prototype=Object.create(EventEmitter.prototype),n.prototype.constructor=n,e.exports=a.default},{}],38:[function(t,e,a){"use strict";function n(t,e,a){function n(t,e,a){l||(l=document.createElement("canvas"),l.width=t,l.height=e,c=l.getContext("2d")),c.globalCompositeOperation="copy",c.drawImage(w,0,0),c.globalCompositeOperation="source-in",c.drawImage(w,0,Math.round(a*u))}function i(t,e,a){return s||(s=document.createElement("canvas"),s.width=t,s.height=e,d=s.getContext("2d")),d.globalCompositeOperation="copy",d.drawImage(p,0,0),n(t,e,a),d.globalCompositeOperation="source-over",d.drawImage(l,0,0),d.drawImage(m,0,0),d.globalCompositeOperation="screen",d.drawImage(E,0,0),d.globalCompositeOperation="multiply",d.drawImage(y,0,0),s}function o(){var t=h.width/2,e=h.height/2;if(f.fillStyle="white",f.fillRect(0,0,h.width,h.height),b==P.length){var a=v.width,n=v.height,o=Math.round(t-a/2),r=Math.round(e-n/2);f.drawImage(v,o,r),i(a,n,C),f.globalAlpha=.88,f.drawImage(s,o,r),f.globalAlpha=1,f.drawImage(g,o,r),e=Math.round(e+n/2+2)}if(""!=T){f.fillStyle="black";for(var l=T.split("\n"),d=0;d<l.length;d++){var c=l[d],u=f.measureText(c).width;e+=2*_,f.fillText(c,t-u/2,e)}}}function r(){h.width=h.clientWidth,h.height=h.clientHeight,f.font=_+"pt sans-serif",o()}for(var s,l,d,c,u=170,h=document.createElement("canvas"),f=h.getContext("2d"),p=new Image,m=new Image,g=new Image,v=new Image,y=new Image,E=new Image,w=new Image,P=[p,m,g,v,y,E,w],b=0,C=0,T="",_=14,x=a+"splash/",S=0;S<P.length;S++)P[S].onload=function(){b++,b==P.length&&o()};p.src=x+"cup.png",E.src=x+"highlights.png",m.src=x+"lid.png",g.src=x+"lines.png",y.src=x+"shading.png",w.src=x+"smoothie.png",v.src=x+"text.png",e.on("loadingProgress",function(t,e){C=t,T=e,o()}),e.on("loadingFailure",function(t){C=0,T=t,o()}),e.on("loadingComplete",function(){window.removeEventListener("resize",r),t.removeChild(h)}),window.addEventListener("resize",r),h.className="chickenpaint-splash-screen",t.appendChild(h),r()}Object.defineProperty(a,"__esModule",{value:!0}),a.default=n,e.exports=a.default},{}],39:[function(t,e,a){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function i(t){function e(){var e=document.createElement("ul");e.className="chickenpaint-stroke-tools list-unstyled";for(var a in n){var o=n[a],r=document.createElement("li");r.className="chickenpaint-toolbar-button "+o.className,r.setAttribute("data-buttonIndex",a),o.selected&&(r.className=r.className+" selected"),e.appendChild(r)}e.addEventListener("click",function(a){if(a.target&&"LI"==a.target.nodeName){var i=n[parseInt(a.target.getAttribute("data-buttonIndex"),10)];$("li",e).removeClass("selected"),$(a.target).addClass("selected"),t.actionPerformed({action:i.command})}}),i.appendChild(e)}r.default.call(this,t,"stroke","Stroke");var a=this,n=[{className:"chickenpaint-tool-freehand",command:"CPFreeHand",toolTip:"Free-hand",selected:!0},{className:"chickenpaint-tool-line",command:"CPLine",toolTip:"Straight line"},{className:"chickenpaint-tool-bezier",command:"CPBezier",toolTip:"Bezier curve"}],i=a.getBodyElement();e(),t.on("toolChange",function(t,e){$(".chickenpaint-tool-freehand",i).toggleClass("selected",e.strokeMode==l.default.SM_FREEHAND),$(".chickenpaint-tool-line",i).toggleClass("selected",e.strokeMode==l.default.SM_LINE),$(".chickenpaint-tool-bezier",i).toggleClass("selected",e.strokeMode==l.default.SM_BEZIER)})}Object.defineProperty(a,"__esModule",{value:!0}),a.default=i;var o=t("./CPPalette"),r=n(o),s=t("../engine/CPBrushInfo"),l=n(s);i.prototype=Object.create(r.default.prototype),i.prototype.constructor=i,e.exports=a.default},{"../engine/CPBrushInfo":5,"./CPPalette":32}],40:[function(t,e,a){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function i(t,e,a){for(;t.length<a;)t=e+t;return t}function o(t,e){var a=document.createElement(e);return a.appendChild(t),a}function r(){return window.File&&window.FileReader&&window.FileList&&window.Blob}function s(t){function e(e){var a=document.createElement("div"),n=document.createElement("a"),r=document.createElement("ul"),s=document.createElement("a"),l=document.createElement("a"),d=this;this.getElement=function(){return a},this.setColor=function(t){n.setAttribute("data-color",t),n.style.backgroundColor="#"+i(""+Number(t).toString(16),"0",6)},this.setColor(e),n.href="#",n.className="chickenpaint-color-swatch dropdown-toggle",n.setAttribute("data-toggle","dropdown"),s.href="#",s.innerHTML="Remove",s.addEventListener("click",function(t){t.preventDefault(),$(a).remove(),g=!0}),l.href="#",l.innerHTML="Replace with current color",l.addEventListener("click",function(e){e.preventDefault(),d.setColor(t.getCurColor().getRgb()),g=!0}),r.className="dropdown-menu",r.appendChild(o(s,"li")),r.appendChild(o(l,"li")),a.className="chickenpaint-color-swatch-wrapper",a.appendChild(n),a.appendChild(r),$(a).on("show.bs.dropdown",function(){var t=$(this).find(".dropdown-toggle"),e=$(this).find(".dropdown-menu");e.css({top:t.position().top+t.outerHeight(!0)+"px",left:t.position().left+"px"})})}function a(){for(;v.lastChild;)v.removeChild(v.lastChild)}function n(t){var a=new e(t);v.appendChild(a.getElement())}function s(){p.onchange=function(){var t=this.files;if(!(t.length<1)){var e=t[0],a=new FileReader;a.onload=function(){var t=(new f.default).read(this.result);null!=t&&t.length>0?E.setSwatches(t):alert("The swatches could not be read, did you select an .aco file?")},a.readAsArrayBuffer(e)}},p.click()}function l(){var t=(new f.default).write(E.getSwatches()),e=new Blob([t],{type:"application/octet-stream"});window.saveAs(e,"oekakiswatches.aco")}function c(){v.className="chickenpaint-color-swatches list-unstyled";for(var a=0;a<m.length;a++)v.appendChild(new e(m[a]).getElement());v.addEventListener("click",function(e){var a=e.target;/chickenpaint-color-swatch/.test(a.className)&&0==e.button&&void 0!==a.getAttribute("data-color")&&(t.setCurColor(new u.default(parseInt(a.getAttribute("data-color"),10))),e.stopPropagation(),e.preventDefault())}),v.addEventListener("contextmenu",function(t){var e=t.target;/chickenpaint-color-swatch/.test(e.className)&&(t.preventDefault(),$(e).dropdown("toggle").off("click.bs.dropdown"))})}function h(){var e=document.createElement("div"),a=document.createElement("div"),i=document.createElement("ul"),d=document.createElement("a"),c=document.createElement("a");a.title="Add the current brush color as a new swatch",a.className="chickenpaint-small-toolbar-button chickenpaint-color-swatch-add",e.className="chickenpaint-small-toolbar-button chickenpaint-color-swatch-settings",e.setAttribute("data-toggle","dropdown"),$(e).dropdown(),d.href="#",d.innerHTML="Save swatches to your computer...",d.addEventListener("click",function(t){t.preventDefault(),l()}),c.href="#",c.innerHTML="Load swatches from your computer...",c.addEventListener("click",function(t){t.preventDefault(),s()}),i.className="dropdown-menu dropdown-menu-right",i.appendChild(o(d,"li")),i.appendChild(o(c,"li"));var u=document.createElement("div");u.className="dropdown",u.appendChild(e),u.appendChild(i),$(u).on("show.bs.dropdown",function(){$(document).one("click",function(){$(u).hasClass("open")&&$(e).dropdown("toggle")})}),a.addEventListener("click",function(e){n(t.getCurColor().getRgb()),g=!0}),y.className="chickenpaint-color-swatches-buttons",r()&&(p=document.createElement("input"),p.type="file",p.multiple=!1,p.style.display="none",y.appendChild(u),y.appendChild(p)),y.appendChild(a)}d.default.call(this,t,"swatches","Color swatches");var p,m=[16777215,0,16711680,65280,255,16776960],g=!1,v=document.createElement("ul"),y=document.createElement("div"),E=this;this.getSwatches=function(){for(var t=$(".chickenpaint-color-swatch",v),e=new Array(t.length),a=0;a<t.length;a++)e[a]=parseInt(t.get(a).getAttribute("data-color"),10);return e},this.setSwatches=function(t){a();for(var e=0;e<t.length;e++)n(t[e]);g=!0},this.isModified=function(){return g},c(),this.getBodyElement().appendChild(v),h(),this.getBodyElement().appendChild(y)}Object.defineProperty(a,"__esModule",{value:!0}),a.default=s;var l=t("./CPPalette"),d=n(l),c=t("../util/CPColor"),u=n(c),h=t("../util/AdobeColorTable"),f=n(h);s.prototype=Object.create(d.default.prototype),s.prototype.constructor=s,e.exports=a.default},{"../util/AdobeColorTable":44,"../util/CPColor":47,"./CPPalette":32}],41:[function(t,e,a){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function i(t){var e=$('<div class="modal fade" tabindex="-1" role="dialog">\n                <div class="modal-dialog">\n                    <div class="modal-content">\n                        <div class="modal-header">\n                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">\n                                <span aria-hidden="true">&times;</span>\n                            </button>\n                            <h4 class="modal-title">Drawing tablet support</h4>\n                        </div>\n                        <div class="modal-body">\n                            <p class="chickenpaint-tablet-there-are-two-options">\n                                There are two ways you could use your tablet\'s pen pressure support with ChickenPaint.\n                            </p>\n                            <div class="chickenpaint-tablet-support chickenpaint-wacom-support">\n                                <h4>\n                                    Plugin for Wacom tablets\n                                </h4>\n                                <div class="chickenpaint-supported-browsers">\n                                    <div class="chickenpaint-supported-browser">\n                                        <span class="fa fa-internet-explorer"></span>\n                                        IE 10, 11\n                                    </div>\n                                    <div class="chickenpaint-supported-browser">\n                                        <span class="fa fa-firefox"></span>\n                                        Firefox (32-bit only)\n                                    </div>\n                                    <div class="chickenpaint-supported-browser">\n                                        <span class="fa fa-safari"></span>\n                                        Safari\n                                    </div>\n                                        <div class="chickenpaint-supported-browser">\n                                        <span class="fa fa-opera"></span>\n                                        Opera\n                                    </div>\n                                </div>\n                                <p class="chickenpaint-not-installed">\n                                    The plugin for Wacom tablets doesn\'t seem to be installed in your browser yet.\n                                </p>\n                                <p class="chickenpaint-not-installed">\n                                    Please make sure that you\'ve installed the latest drivers for your tablet from the \n                                    <a href="http://www.wacom.com/en-us/support/product-support/drivers" target="_blank">Wacom drivers page</a>,\n                                    then restart your browser.\n                                </p>\n                                <p class="chickenpaint-not-supported">\n                                    Your browser doesn\'t support the Wacom tablet plugin, please \n                                    try one of the browsers listed above instead.\n                                </p>\n                                <p class="chickenpaint-supported alert alert-success">\n                                    The Wacom tablet plugin is installed and working.\n                                </p>\n                            </div>\n                            <div class="chickenpaint-tablet-support chickenpaint-pointerevents-support">\n                                <h4>\n                                    Built-in support for most tablets <small>including Wacom tablets</small>\n                                </h4>\n                                <div class="chickenpaint-supported-browsers">\n                                    <div class="chickenpaint-supported-browser">\n                                        <span class="fa fa-internet-explorer"></span>\n                                        IE (Windows 8)\n                                    </div>\n                                        <div class="chickenpaint-supported-browser">\n                                        <span class="fa fa-edge"></span>\n                                        Edge (Windows 10)\n                                    </div>\n                                    <div class="chickenpaint-supported-browser">\n                                        <span class="fa fa-firefox"></span>\n                                        Firefox (<a href="https://github.com/thenickdude/chickenpaint/blob/master/help/Firefox pressure support.md" target="_blank">experimental <i class="glyphicon glyphicon-new-window"></i></a>)\n                                    </div>\n                                    <div class="chickenpaint-supported-browser">\n                                        <span class="fa fa-chrome"></span>\n                                        Chrome\n                                    </div>\n                                </div>\n                                <p class="chickenpaint-not-supported">\n                                    Your browser doesn\'t have built-in support for drawing tablets, please try\n                                    one of the other browsers listed above.\n                                </p>\n                                <p class="chickenpaint-supported alert alert-success">\n                                    Your browser has built-in support for drawing tablets!\n                                </p>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n       '),a=$(".chickenpaint-wacom-support",e),n=$(".chickenpaint-pointerevents-support",e),i=$(".chickenpaint-tablet-there-are-two-options",e),o=r.default.getRef().isTabletPresent(),s=!!window.hasNativePointerEvents;
a.toggleClass("supported",o),o?(n.hide(),i.hide()):((/Chrome/i.test(navigator.userAgent)&&!/OPR/.test(navigator.userAgent)||/iPad/.test(navigator.userAgent)||/iPhone/.test(navigator.userAgent))&&a.addClass("not-supported"),s&&(a.hide(),i.hide())),n.toggleClass("supported",s),n.toggleClass("not-supported",!s),e.modal({show:!1}),e.data("bs.modal").$body=$(t),t.appendChild(e[0]),this.show=function(){e.modal("show")}}Object.defineProperty(a,"__esModule",{value:!0}),a.default=i;var o=t("../util/CPWacomTablet"),r=n(o);e.exports=a.default},{"../util/CPWacomTablet":55}],42:[function(t,e,a){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function i(t,e){var a=document.createElement("div"),n=document.createElement("label");return a.className="checkbox",n.appendChild(t),n.appendChild(document.createTextNode(e)),a.appendChild(n),a}function o(t,e,a,n,i){var o=new Image,r=[];o.onload=function(){var t=document.createElement("canvas"),s=t.getContext("2d");t.width=o.width,t.height=o.height;for(var d=0;d<n;d++){s.drawImage(o,0,d*a,e,a,0,0,e,a);try{for(var c=s.getImageData(0,0,e,a),u=new l.default(e,a),h=0;h<e*a;h++)u.data[h]=c.data[4*h];r.push(u)}catch(t){console.log(t)}}i(r)},o.src=t}function r(t){function e(t){for(var e=0;e<t.length;e++){var a=t[e];P.push(a);var n=new m(a,w,w);n.on("click",function(){g=this.texture,u()}),x.appendChild(n.getElement())}}function a(){var t=[null],e=new l.default(2,2);return e.data[0]=255,e.data[3]=255,t.push(e),t.push(n(2)),t.push(n(3)),t.push(n(4)),t.push(n(6)),t.push(n(8)),t.push(s(1,2)),t.push(s(2,4)),t.push(d(1,2)),t.push(d(2,4)),t.push(r(2)),t.push(r(4)),t.push(r(8)),t.push(r(16)),t}function n(t){for(var e=new l.default(t,t),a=1;a<t*t;a++)e.data[a]=255;return e}function r(t){for(var e=2*t,a=new l.default(e,e),n=0;n<e;n++)for(var i=0;i<e;i++)a.data[n+i*e]=(~~(n/t)+~~(i/t))%2==0?0:255;return a}function s(t,e){for(var a=new l.default(e,e),n=0;n<e*e;n++)~~(n%e)>=t&&(a.data[n]=255);return a}function d(t,e){for(var a=new l.default(e,e),n=0;n<e*e;n++)n/e>=t&&(a.data[n]=255);return a}function u(){if(null!=g){v=g.clone(),b&&v.mirrorHorizontally();var e=new c.default;e.loadBrightnessContrast(T,_),C&&e.invert(),v.applyLUT(e)}else v=null;t.getArtwork().setBrushTexture(v),null!=y&&y.updateTexture()}function f(){function t(){o.checked=C,r.checked=b,s.setValue(100*T+100),l.setValue(100*_+100)}function e(){var e=document.createElement("div");o.type="checkbox",o.addEventListener("click",function(t){C=this.checked,u()}),e.appendChild(i(o,"Inverse")),r.type="checkbox",r.addEventListener("click",function(t){b=this.checked,u()}),e.appendChild(i(r,"Mirror")),s.title=function(t){return"Brightness: "+(t-100)+"%"},s.on("valueChange",function(t){T=(t-100)/100,u()}),e.appendChild(s.getElement()),l.title=function(t){return"Contrast: "+(t-100)+"%"},l.on("valueChange",function(t){_=(t-100)/100,u()}),e.appendChild(l.getElement());var a=document.createElement("button"),n=document.createElement("button");return a.innerHTML="Ok",a.className="btn btn-primary btn-sm",a.type="button",a.addEventListener("click",function(t){$(c).popover("hide")}),e.appendChild(a),e.appendChild(document.createTextNode(" ")),n.innerHTML="Reset",n.className="btn btn-default btn-sm",n.type="button",n.addEventListener("click",function(e){T=0,_=0,b=!1,C=!1,t(),u()}),e.appendChild(n),t(),e}var a,n=document.createElement("div"),o=document.createElement("input"),r=document.createElement("input"),s=new p.default(0,200,(!0)),l=new p.default(0,200,(!0)),d=new m(null,E,E),c=document.createElement("button");this.updateTexture=function(){c.disabled=null==v,d.setTexture(v)},this.getElement=function(){return n},n.className="chickenpaint-texture-options",n.appendChild(d.getElement()),c.type="button",c.className="btn btn-default btn-sm",c.innerHTML="Customize",a=e(),$(c).popover({html:!0,content:function(){return a},trigger:"manual"}).on("click",function(){$(this).popover("toggle")}),n.appendChild(c),this.updateTexture()}function m(t,e,a){var n=document.createElement("canvas"),i=n.getContext("2d"),o=this;this.setTexture=function(t){this.texture=t,this.paint()},this.getElement=function(){return n},this.paint=function(){null!=this.texture?i.fillStyle=i.createPattern(this.texture.toCanvas(),"repeat"):i.fillStyle="white",i.fillRect(0,0,n.width,n.height)},n.addEventListener("click",function(){o.emit("click")}),n.width=e,n.height=a,this.setTexture(t)}h.default.call(this,t,"textures","Textures");var g,v,y,E=64,w=32,P=[],b=!1,C=!1,T=0,_=0,x=document.createElement("div"),S=this.getBodyElement();m.prototype=Object.create(EventEmitter.prototype),m.prototype.constructor=m,y=new f,S.appendChild(y.getElement()),x.className="chickenpaint-texture-swatches",S.appendChild(x),e(a()),o(t.getResourcesRoot()+"gfx/textures32.png",32,32,2,function(t){e(t)})}Object.defineProperty(a,"__esModule",{value:!0}),a.default=r;var s=t("../engine/CPGreyBmp"),l=n(s),d=t("../engine/CPLookUpTable"),c=n(d),u=t("./CPPalette"),h=n(u),f=t("./CPSlider"),p=n(f);r.prototype=Object.create(h.default.prototype),r.prototype.constructor=r,e.exports=a.default},{"../engine/CPGreyBmp":10,"../engine/CPLookUpTable":12,"./CPPalette":32,"./CPSlider":37}],43:[function(t,e,a){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function i(t){function e(e){if("LI"==this.nodeName){var a=i[parseInt(this.getAttribute("data-buttonIndex"),10)];t.actionPerformed({action:a.command})}}function a(){var a=n.getBodyElement();o.className="chickenpaint-tools list-unstyled";for(var r in i)!function(t){var a=i[t],n=document.createElement("li");n.className="chickenpaint-toolbar-button "+a.className,n.setAttribute("data-buttonIndex",t),n.setAttribute("data-mode",a.mode),void 0!==a.tool&&n.setAttribute("data-tool",a.tool),n.title=a.toolTip,a.shortcut&&(n.title+=" ("+a.shortcut.toUpperCase()+")",key(a.shortcut,function(){return e.call(n),!1})),a.selected&&(n.className=n.className+" selected"),o.appendChild(n)}(r);$(o).on("click","li",e),o.addEventListener("dblclick",function(e){if("LI"==this.nodeName){var a=i[parseInt(this.getAttribute("data-buttonIndex"),10)];a.commandDoubleClick&&t.actionPerformed({action:a.commandDoubleClick})}}),a.appendChild(o)}r.default.call(this,t,"tool","Tools");var n=this,i=[{className:"chickenpaint-tool-rect-selection",command:"CPRectSelection",toolTip:"Marquee",shortcut:"m",mode:l.default.M_RECT_SELECTION},{className:"chickenpaint-tool-move",command:"CPMoveTool",toolTip:"Move tool",shortcut:"v",mode:l.default.M_MOVE_TOOL},{className:"chickenpaint-tool-flood-fill",command:"CPFloodFill",toolTip:"Flood fill",shortcut:"f",mode:l.default.M_FLOODFILL},{className:"chickenpaint-tool-gradient-fill",command:"CPGradientFill",toolTip:"Gradient fill",shortcut:"g",mode:l.default.M_GRADIENTFILL},{className:"chickenpaint-tool-color-picker",command:"CPColorPicker",toolTip:"Color picker",shortcut:"i",mode:l.default.M_COLOR_PICKER},{className:"chickenpaint-tool-rotate-canvas",command:"CPRotateCanvas",commandDoubleClick:"CPResetCanvasRotation",toolTip:"Rotate canvas",mode:l.default.M_ROTATE_CANVAS},{className:"chickenpaint-tool-pencil",command:"CPPencil",toolTip:"Pencil",mode:l.default.M_DRAW,tool:l.default.T_PENCIL},{className:"chickenpaint-tool-pen",command:"CPPen",toolTip:"Pen",selected:!0,mode:l.default.M_DRAW,tool:l.default.T_PEN},{className:"chickenpaint-tool-airbrush",command:"CPAirbrush",toolTip:"Airbrush",mode:l.default.M_DRAW,tool:l.default.T_AIRBRUSH},{className:"chickenpaint-tool-water",command:"CPWater",toolTip:"Waterpaint",mode:l.default.M_DRAW,tool:l.default.T_WATER},{className:"chickenpaint-tool-eraser",command:"CPEraser",toolTip:"Eraser",shortcut:"e",mode:l.default.M_DRAW,tool:l.default.T_ERASER},{className:"chickenpaint-tool-soft-eraser",command:"CPSoftEraser",toolTip:"Soft eraser",mode:l.default.M_DRAW,tool:l.default.T_SOFTERASER},{className:"chickenpaint-tool-smudge",command:"CPSmudge",toolTip:"Smudge",mode:l.default.M_DRAW,tool:l.default.T_SMUDGE},{className:"chickenpaint-tool-blender",command:"CPBlender",toolTip:"Blender",mode:l.default.M_DRAW,tool:l.default.T_BLENDER},{className:"chickenpaint-tool-dodge",command:"CPDodge",toolTip:"Dodge",shortcut:"o",mode:l.default.M_DRAW,tool:l.default.T_DODGE},{className:"chickenpaint-tool-burn",command:"CPBurn",toolTip:"Burn",shortcut:"p",mode:l.default.M_DRAW,tool:l.default.T_BURN},{className:"chickenpaint-tool-blur",command:"CPBlur",toolTip:"Blur",mode:l.default.M_DRAW,tool:l.default.T_BLUR}],o=document.createElement("ul");t.on("modeChange",function(e){var a=n.getBodyElement();$("li",a).removeClass("selected"),e==l.default.M_DRAW?$("li[data-tool="+t.getCurTool()+"]",a).addClass("selected"):$("li[data-mode="+e+"]",a).addClass("selected")}),t.on("toolChange",function(e){var a=n.getBodyElement();t.getCurMode()==l.default.M_DRAW&&($("li",a).removeClass("selected"),$("li[data-tool="+e+"]",a).addClass("selected"))}),a()}Object.defineProperty(a,"__esModule",{value:!0}),a.default=i;var o=t("./CPPalette"),r=n(o),s=t("../ChickenPaint"),l=n(s);i.prototype=Object.create(r.default.prototype),i.prototype.constructor=i,e.exports=a.default},{"../ChickenPaint":1,"./CPPalette":32}],44:[function(t,e,a){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function i(){}Object.defineProperty(a,"__esModule",{value:!0}),a.default=i;var o=t("./ArrayDataStream"),r=n(o),s=0;i.prototype.read=function(t){if(null==t)return null;var e,a,n=new r.default(new Uint8Array(t)),i=[];if(e=n.readU16BE(),1!=e)return null;a=n.readU16BE();for(var o=0;o<a;o++){var l=n.readU16BE();if(l==s){var d=255*n.readU16BE()/65535,c=255*n.readU16BE()/65535,u=255*n.readU16BE()/65535;n.readU16BE(),i.push(d<<16|c<<8|u)}}return i},i.prototype.write=function(t){var e=new Uint8Array(4+10*t.length),a=new r.default(e);a.writeU16BE(1),a.writeU16BE(t.length);for(var n=0;n<t.length;n++){var i=t[n];a.writeU16BE(s),a.writeU16BE(257*(i>>16&255)),a.writeU16BE(257*(i>>8&255)),a.writeU16BE(257*(255&i)),a.writeU16BE(0)}return a.getAsDataArray()},e.exports=a.default},{"./ArrayDataStream":45}],45:[function(t,e,a){"use strict";function n(t){return 32768&t?4294901760|t:t}function i(t){return 128&t?4294967040|t:t}function o(t,e,a){this.data=t,this.eof=!1,this.start=void 0===e?0:e,this.end=void 0===a?t.length:a,this.pos=this.start}Object.defineProperty(a,"__esModule",{value:!0}),a.default=o;var r=-1;o.prototype.readChar=function(){return this.pos<this.end?String.fromCharCode(this.data[this.pos++]):(this.eof=!0,r)},o.prototype.readByte=function(){return this.pos<this.end?this.data[this.pos++]:(this.eof=!0,r)},o.prototype.readU8=o.prototype.readByte,o.prototype.readS8=function(){return i(this.readByte())},o.prototype.unreadChar=function(t){this.pos--},o.prototype.peekChar=function(){return this.pos<this.end?String.fromCharCode(this.data[this.pos]):(this.eof=!0,r)},o.prototype.readString=function(t){var e,a=new Array(t);for(e=0;e<t;e++)a[e]=this.readChar();return a.join("")},o.prototype.readS16=function(){var t=this.readByte(),e=this.readByte();return n(t<<8|e)},o.prototype.readU16BE=function(){var t=this.readByte(),e=this.readByte();return t<<8|e},o.prototype.readU16LE=function(){var t=this.readByte(),e=this.readByte();return e<<8|t},o.prototype.readU32BE=function(){var t=this.readByte(),e=this.readByte(),a=this.readByte(),n=this.readByte();return(t<<24|e<<16|a<<8|n)>>>0},o.prototype.readU32LE=function(){var t=this.readByte(),e=this.readByte(),a=this.readByte(),n=this.readByte();return(n<<24|a<<16|e<<8|t)>>>0},o.prototype.readBytes=function(t){var e=this.data.subarray(this.pos,this.pos+t);return this.pos+=t,this.pos>this.end&&(this.eof=!0),e},o.prototype.skip=function(t){this.pos+=t,this.pos>this.end&&(this.eof=!0)},o.prototype.seek=function(t){this.pos=t},o.prototype.writeBytes=function(t){for(var e=0;e<t.length;e++)this.data[this.pos++]=t[e]},o.prototype.writeByte=function(t){this.data[this.pos++]=t},o.prototype.writeU8=o.prototype.writeByte,o.prototype.writeU16LE=function(t){this.data[this.pos++]=t,this.data[this.pos++]=t>>8},o.prototype.writeU16BE=function(t){this.data[this.pos++]=t>>8,this.data[this.pos++]=t},o.prototype.writeU32BE=function(t){this.data[this.pos++]=t>>24,this.data[this.pos++]=t>>16,this.data[this.pos++]=t>>8,this.data[this.pos++]=t},o.prototype.writeU32LE=function(t){this.data[this.pos++]=t,this.data[this.pos++]=t>>8,this.data[this.pos++]=t>>16,this.data[this.pos++]=t>>24},o.prototype.writeDoubleBE=function(t){for(var e=new Uint8Array(new Float64Array([t]).buffer),a=e.length-1;a>=0;a--)this.writeByte(e[a])},o.prototype.writeFloatBE=function(t){for(var e=new Uint8Array(new Float32Array([t]).buffer),a=e.length-1;a>=0;a--)this.writeByte(e[a])},o.prototype.writeString=function(t){for(var e=0;e<t.length;e++)this.data[this.pos++]=t.charCodeAt(e)},o.prototype.writeUnsignedIntBE=function(t,e){switch(void 0===e&&(e=this.measureUnsignedInt(t)),e){case 5:this.writeU8(Math.floor(t/4294967296));case 4:this.writeU8(t>>24);case 3:this.writeU8(t>>16);case 2:this.writeU8(t>>8);case 1:this.writeU8(t);break;default:throw new RuntimeException("Bad UINT size "+e)}},o.prototype.measureUnsignedInt=function(t){return t<256?1:t<65536?2:t<1<<24?3:t<4294967296?4:5},o.prototype.getAsDataArray=function(){if(this.pos<this.data.byteLength)return this.data.subarray(0,this.pos);if(this.pos==this.data.byteLength)return this.data;throw"ArrayDataStream's pos lies beyond end of buffer"},o.prototype.EOF=r,e.exports=a.default},{}],46:[function(t,e,a){"use strict";function n(){function t(t){var c=3*t,u=c*t,h=t*t*t,f=2*u,p=6*h,m=d.x0-2*d.x1+d.x2,g=d.y0-2*d.y1+d.y2,v=3*(d.x1-d.x2)-d.x0+d.x3,y=3*(d.y1-d.y2)-d.y0+d.y3;e=d.x0,o=d.y0,a=(d.x1-d.x0)*c+m*u+v*h,r=(d.y1-d.y0)*c+g*u+y*h,n=m*f+v*p,s=g*f+y*p,i=v*p,l=y*p}this.x0=this.y0=this.x1=this.y1=this.x2=this.y2=this.x3=this.y3=0;var e,a,n,i,o,r,s,l,d=this;this.compute=function(d,c,u){t(1/u),d[0]=~~e,c[0]=~~o;for(var h=1;h<u;h++)e+=a,o+=r,a+=n,r+=s,n+=i,s+=l,d[h]=~~e,c[h]=~~o}}Object.defineProperty(a,"__esModule",{value:!0}),a.default=n,e.exports=a.default},{}],47:[function(t,e,a){"use strict";function n(t){function e(){var t=i.rgb>>16&255,e=i.rgb>>8&255,a=255&i.rgb;i.value=Math.max(t,Math.max(e,a));var n=Math.min(t,Math.min(e,a));if(0==i.value?i.saturation=0:i.saturation=~~((i.value-n)/i.value*255),0==i.saturation)i.hue=0;else{var o=(i.value-t)/(i.value-n),r=(i.value-e)/(i.value-n),s=(i.value-a)/(i.value-n),l=0;i.value==t&&(l=s-r),i.value==e&&(l=2+o-s),i.value==a&&(l=4+r-o),l*=60,l<0&&(l+=360),i.hue=~~l}}function a(){if(0==i.saturation)i.rgb=i.value<<16|i.value<<8|i.value;else{var t=i.hue/60;t-=Math.floor(t);var e=i.saturation/255,a=~~(i.value*(1-e)),n=~~(i.value*(1-e*t)),o=~~(i.value*(1-e*(1-t)));switch(~~(i.hue/60)){case 0:i.rgb=i.value<<16|o<<8|a;break;case 1:i.rgb=n<<16|i.value<<8|a;break;case 2:i.rgb=a<<16|i.value<<8|o;break;case 3:i.rgb=a<<16|n<<8|i.value;break;case 4:i.rgb=o<<16|a<<8|i.value;break;case 5:i.rgb=i.value<<16|a<<8|n;break;default:i.rgb=0}}}var i=this;this.rgb=0,this.hue=0,this.saturation=0,this.value=0,this.getRgb=function(){return this.rgb},this.getSaturation=function(){return this.saturation},this.getHue=function(){return this.hue},this.getValue=function(){return this.value},this.setRgbComponents=function(t,e,a){this.setRgb(t<<16|e<<8|a)},this.setRgb=function(t){this.rgb=t,e()},this.setHsv=function(t,e,n){this.hue=t,this.saturation=n,this.value=e,a()},this.setHue=function(t){this.hue=t,a()},this.setSaturation=function(t){this.saturation=t,a()},this.setValue=function(t){this.value=t,a()},this.clone=function(){var t=new n;return t.copyFrom(this),t},this.copyFrom=function(t){this.rgb=t.rgb,this.hue=t.hue,this.saturation=t.saturation,this.value=t.value},this.isEqual=function(t){return this.rgb==t.rgb&&this.hue==t.hue&&this.saturation==t.saturation&&this.value==t.value},this.setRgb(t||0)}Object.defineProperty(a,"__esModule",{value:!0}),a.default=n,e.exports=a.default},{}],48:[function(t,e,a){"use strict";function n(t,e,a){this.r=t,this.g=e,this.b=a}Object.defineProperty(a,"__esModule",{value:!0}),a.default=n,n.prototype.toInt=function(){return Math.max(0,Math.min(255,Math.round(255*this.r)))<<16|Math.max(0,Math.min(255,Math.round(255*this.g)))<<8|Math.max(0,Math.min(255,Math.round(255*this.b)))},n.prototype.mixWith=function(t,e){this.r=this.r*(1-e)+t.r*e,this.g=this.g*(1-e)+t.g*e,this.b=this.b*(1-e)+t.b*e},n.prototype.clone=function(){return new n(this.r,this.g,this.b)},n.createFromInt=function(t){return new n((t>>>16&255)/255,(t>>>8&255)/255,(255&t)/255)},e.exports=a.default},{}],49:[function(t,e,a){"use strict";function n(t){for(var e=["imageSmoothingEnabled","mozImageSmoothingEnabled","webkitImageSmoothingEnabled","msImageSmoothingEnabled"],a=0;a<e.length;a++)if(e[a]in t)return e[a];return null}function i(){var t=document.createElement("canvas"),e=t.getContext("2d");return!!n(e)}function o(t,e){var a=n(t);a&&(t[a]=e)}function r(t){var e=t in window;if(!e){var a=document.createElement("div");a.setAttribute(t,"return;"),e="function"==typeof a[t]}return e}function s(){var t=document.createElement("canvas");return!(!t.getContext||!t.getContext("2d"))}Object.defineProperty(a,"__esModule",{value:!0}),a.isCanvasInterpolationSupported=i,a.setCanvasInterpolation=o,a.isEventSupported=r,a.isCanvasSupported=s},{}],50:[function(t,e,a){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function i(t){this.points=t||[]}Object.defineProperty(a,"__esModule",{value:!0}),a.default=i;var o=t("./CPTransform");n(o);i.prototype.clone=function(){for(var t=new i(new Array(this.points.length)),e=0;e<this.points.length;e++)t.points[e]={x:this.points[e].x,y:this.points[e].y};return t},i.prototype.getTransformed=function(t){for(var e=new i(new Array(this.points.length)),a=0;a<this.points.length;a++)e.points[a]=t.getTransformedPoint(this.points[a]);return e},i.prototype.getCenter=function(){for(var t=this.points[0].x,e=this.points[0].y,a=1;a<this.points.length;a++)t+=this.points[a].x,e+=this.points[a].y;return{x:t/this.points.length,y:e/this.points.length}},i.prototype.containsPoint=function(t){var e,a,n=!1;for(e=0,a=this.points.length-1;e<this.points.length;a=e++)this.points[e].y>t.y!=this.points[a].y>t.y&&t.x<(this.points[a].x-this.points[e].x)*(t.y-this.points[e].y)/(this.points[a].y-this.points[e].y)+this.points[e].x&&(n=!n);return n},e.exports=a.default},{"./CPTransform":53}],51:[function(t,e,a){"use strict";function n(){var t,e=!1;this.nextGaussian=function(){if(e)return e=!1,t;var a,n,i;do a=2*Math.random()-1,n=2*Math.random()-1,i=a*a+n*n;while(i>=1||0==i);var o=Math.sqrt(-2*Math.log(i)/i);return t=n*o,e=!0,a*o}}Object.defineProperty(a,"__esModule",{value:!0}),a.default=n,e.exports=a.default},{}],52:[function(t,e,a){"use strict";function n(t,e,a,n){this.left=t,this.top=e,this.right=a,this.bottom=n}Object.defineProperty(a,"__esModule",{value:!0}),a.default=n,n.prototype.makeEmpty=function(){this.left=0,this.top=0,this.right=0,this.bottom=0},n.prototype.union=function(t){this.isEmpty()?this.set(t):(this.left=Math.min(this.left,t.left),this.top=Math.min(this.top,t.top),this.right=Math.max(this.right,t.right),this.bottom=Math.max(this.bottom,t.bottom))},n.prototype.getUnion=function(t){var e=this.clone();return e.union(t),e},n.prototype.clip=function(t){return this.isEmpty()||(t.isEmpty()?this.makeEmpty():(this.left=Math.max(this.left,t.left),this.top=Math.max(this.top,t.top),this.right=Math.min(this.right,t.right),this.bottom=Math.min(this.bottom,t.bottom))),this},n.prototype.containsPoint=function(t){return!(t.x<this.left||t.y<this.top||t.x>=this.right||t.y>=this.bottom)},n.prototype.isInside=function(t){return this.left>=t.left&&this.top>=t.top&&this.right<=t.right&&this.bottom<=t.bottom},n.prototype.clipSourceDest=function(t,e){e.right=e.left+t.getWidth(),e.bottom=e.top+t.getHeight(),this.isEmpty()||e.left>=this.right||e.top>=this.bottom||e.right<=this.left||e.bottom<=this.top?(t.makeEmpty(),e.makeEmpty()):(e.right>this.right&&(t.right-=e.right-this.right,e.right=this.right),e.bottom>this.bottom&&(t.bottom-=e.bottom-this.bottom,e.bottom=this.bottom),e.left<this.left&&(t.left+=this.left-e.left,e.left=this.left),e.top<this.top&&(t.top+=this.top-e.top,e.top=this.top))},n.prototype.getWidth=function(){return this.right-this.left},n.prototype.getHeight=function(){return this.bottom-this.top},n.prototype.getArea=function(){return this.getWidth()*this.getHeight()},n.prototype.isEmpty=function(){return this.right<=this.left||this.bottom<=this.top},n.prototype.set=function(t){this.left=t.left,this.top=t.top,this.right=t.right,this.bottom=t.bottom},n.prototype.clone=function(){return new n(this.left,this.top,this.right,this.bottom)},n.prototype.translate=function(t,e){this.left+=t,this.right+=t,this.top+=e,this.bottom+=e},n.prototype.moveTo=function(t,e){this.translate(t-this.left,e-this.top)},n.prototype.equals=function(t){return this.left==t.left&&this.right==t.right&&this.top==t.top&&this.bottom==t.bottom},n.prototype.grow=function(t,e){this.left-=t,this.right+=t,this.top-=e,this.bottom+=e},n.prototype.toString=function(){return"("+this.left+","+this.top+","+this.right+","+this.bottom+")"},n.prototype.toPoints=function(){return[{x:this.left,y:this.top},{x:this.right,y:this.top},{x:this.right,y:this.bottom},{x:this.left,y:this.bottom}]},n.prototype.roundNearest=function(){this.left=Math.round(this.left),this.top=Math.round(this.top),this.right=Math.round(this.right),this.bottom=Math.round(this.bottom)},n.prototype.roundContain=function(){this.left=Math.floor(this.left),this.top=Math.floor(this.top),this.right=Math.ceil(this.right),this.bottom=Math.ceil(this.bottom)},n.createBoundingBox=function(t){for(var e=new n(t[0].x,t[0].y,t[0].x,t[0].y),a=1;a<t.length;a++)e.left=Math.min(e.left,t[a].x),e.top=Math.min(e.top,t[a].y),e.right=Math.max(e.right,t[a].x),e.bottom=Math.max(e.bottom,t[a].y);return e},window.cpRectGarbage=new n(1.5,2.5,3.5,4.5),e.exports=a.default},{}],53:[function(t,e,a){"use strict";function n(){this.setToIdentity()}Object.defineProperty(a,"__esModule",{value:!0}),a.default=n,n.prototype.setToIdentity=function(){this.m=[1,0,0,1,0,0]},n.prototype.multiply=function(t){var e=this.m[0]*t.m[0]+this.m[2]*t.m[1],a=this.m[1]*t.m[0]+this.m[3]*t.m[1],n=this.m[0]*t.m[2]+this.m[2]*t.m[3],i=this.m[1]*t.m[2]+this.m[3]*t.m[3],o=this.m[0]*t.m[4]+this.m[2]*t.m[5]+this.m[4],r=this.m[1]*t.m[4]+this.m[3]*t.m[5]+this.m[5];this.m[0]=e,this.m[1]=a,this.m[2]=n,this.m[3]=i,this.m[4]=o,this.m[5]=r},n.prototype.preMultiply=function(t){var e=t.m[0]*this.m[0]+t.m[2]*this.m[1],a=t.m[1]*this.m[0]+t.m[3]*this.m[1],n=t.m[0]*this.m[2]+t.m[2]*this.m[3],i=t.m[1]*this.m[2]+t.m[3]*this.m[3],o=t.m[0]*this.m[4]+t.m[2]*this.m[5]+t.m[4],r=t.m[1]*this.m[4]+t.m[3]*this.m[5]+t.m[5];this.m[0]=e,this.m[1]=a,this.m[2]=n,this.m[3]=i,this.m[4]=o,this.m[5]=r},n.prototype.invert=function(){var t=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),e=this.m[3]*t,a=-this.m[1]*t,n=-this.m[2]*t,i=this.m[0]*t,o=t*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),r=t*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);this.m[0]=e,this.m[1]=a,this.m[2]=n,this.m[3]=i,this.m[4]=o,this.m[5]=r},n.prototype.getInverted=function(){var t=new n;return t.m[0]=this.m[0],t.m[1]=this.m[1],t.m[2]=this.m[2],t.m[3]=this.m[3],t.m[4]=this.m[4],t.m[5]=this.m[5],t.invert(),t},n.prototype.rotate=function(t){var e=Math.cos(t),a=Math.sin(t),n=this.m[0]*e+this.m[2]*a,i=this.m[1]*e+this.m[3]*a,o=this.m[0]*-a+this.m[2]*e,r=this.m[1]*-a+this.m[3]*e;this.m[0]=n,this.m[1]=i,this.m[2]=o,this.m[3]=r},n.prototype.rotateAroundPoint=function(t,e,a){this.translate(e,a),this.rotate(t),this.translate(-e,-a)},n.prototype.translate=function(t,e){this.m[4]+=this.m[0]*t+this.m[2]*e,this.m[5]+=this.m[1]*t+this.m[3]*e},n.prototype.scale=function(t,e){this.m[0]*=t,this.m[1]*=t,this.m[2]*=e,this.m[3]*=e},n.prototype.scaleAroundPoint=function(t,e,a,n){this.translate(a,n),this.scale(t,e),this.translate(-a,-n)},n.prototype.shear=function(t,e){var a=this.m[0]+this.m[2]*e,n=this.m[1]+this.m[3]*e,i=this.m[2]+this.m[0]*t,o=this.m[3]+this.m[1]*t;this.m[0]=a,this.m[1]=n,this.m[2]=i,this.m[3]=o},n.prototype.getTransformedPoint=function(t){return{x:t.x*this.m[0]+t.y*this.m[2]+this.m[4],y:t.x*this.m[1]+t.y*this.m[3]+this.m[5]}},n.prototype.transformPoints=function(t){for(var e=0;e<t.length;e++)t[e]=this.getTransformedPoint(t[e])},n.prototype.getTranslateX=function(){return this.m[4]},n.prototype.getTranslateY=function(){return this.m[5]},n.prototype.clone=function(){var t=new n;return t.m[0]=this.m[0],t.m[1]=this.m[1],t.m[2]=this.m[2],t.m[3]=this.m[3],t.m[4]=this.m[4],t.m[5]=this.m[5],t},n.prototype.getDeterminant=function(){return this.m[0]*this.m[3]-this.m[1]*this.m[2]},n.prototype.decompose=function(){var t=this.getDeterminant(),e=Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]);return{translate:{x:this.m[4],y:this.m[5]},rotate:Math.sign(this.m[1])*Math.acos(this.m[0]/e),scale:{x:e,y:t/e},shear:{x:Math.atan((this.m[0]*this.m[2]+this.m[1]*this.m[3])/(e*e)),y:0}}},n.prototype.toString=function(){var t=2;return"["+this.m[0].toFixed(t)+" "+this.m[2].toFixed(t)+" "+this.m[4].toFixed(t)+"]\n["+this.m[1].toFixed(t)+" "+this.m[3].toFixed(t)+" "+this.m[5].toFixed(t)+"]\n[0.00 0.00 1.00]"},Math.sign=Math.sign||function(t){return t=+t,0===t||isNaN(t)?t:t>0?1:-1},e.exports=a.default},{}],54:[function(t,e,a){"use strict";function n(t,e){this.x=t,this.y=e}Object.defineProperty(a,"__esModule",{value:!0}),a.default=n,n.prototype.getLength=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},n.prototype.normalize=function(){var t=this.getLength();return this.x/=t,this.y/=t,this},n.prototype.getDotProduct=function(t){return this.x*t.x+this.y*t.y},n.prototype.scale=function(t){return this.x*=t,this.y*=t,this},n.prototype.getScaled=function(t){var e=new n(this.x,this.y);return e.scale(t),e},n.prototype.getRounded=function(){return new n(Math.round(this.x),Math.round(this.y))},n.prototype.getTruncated=function(){return new n((~~this.x),(~~this.y))},n.prototype.getPerpendicular=function(){return new n((-this.y),this.x)},n.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this},n.prototype.subtract=function(t){return this.x-=t.x,this.y-=t.y,this},n.prototype.getSum=function(t){return new n(this.x+t.x,this.y+t.y)},n.subtractPoints=function(t,e){return new n(t.x-e.x,t.y-e.y)},e.exports=a.default},{}],55:[function(t,e,a){"use strict";function n(){var t,e=null,a=this;this.isPen=function(){var t;return!!e&&(t=e.pointerType,1==t||3==t)},this.getPressure=function(){return e?e.pressure:1},this.pluginLoaded=function(){console.log("Wacom tablet support loaded!"),e=t.penAPI},this.isTabletPresent=function(){return!!e},this.detectTablet=function(){if(/Chrome/i.test(navigator.userAgent)&&!/OPR/.test(navigator.userAgent))return void console.log("Not attempting to load Wacom tablet plugin, since this is Chrome");if(console.log("Attempting to load Wacom tablet support..."),t=document.createElement("object"),"classid"in t)t.classid="CLSID:092dfa86-5807-5a94-bf3b-5a53ba9e5308";else{var e=document.createElement("param");e.name="onload",e.value="onWacomPluginLoaded",t.appendChild(e),t.type="application/x-wacomtabletplugin"}t.style.position="absolute",t.style.visibility="hidden",t.onload="onWacomPluginLoaded",document.body.appendChild(t),setTimeout(function(){a.isTabletPresent()||console.log("Looks like the Wacom plugin isn't installed, or failed to load.")},5e3)}}Object.defineProperty(a,"__esModule",{value:!0}),a.default=n,n.getRef=function(){return null==n.instance&&(n.instance=new n),n.instance},window.onWacomPluginLoaded=function(){n.getRef().pluginLoaded()},e.exports=a.default},{}],56:[function(t,e,a){"use strict";function n(t,e,a,n){function i(){function i(){r=+new Date,a.apply(l,c)}function s(){o=void 0}var l=this,d=+new Date-r,c=arguments;n&&!o&&i(),o&&clearTimeout(o),void 0===n&&d>t?i():e!==!0&&(o=setTimeout(n?s:i,void 0===n?t-d:t))}var o,r=0;return"boolean"!=typeof e&&(n=a,a=e,e=void 0),i}function i(t,e,a){return void 0===a?n(t,e,!1):n(t,a,e!==!1)}Object.defineProperty(a,"__esModule",{value:!0}),a.throttle=n,a.debounce=i},{}]},{},[1])(1)});
//# sourceMappingURL=chickenpaint.min.js.map